<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Community Health Toolkit – CHT Applications</title><link>https://docs.communityhealthtoolkit.org/beta/apps/</link><description>Recent content in CHT Applications on Community Health Toolkit</description><generator>Hugo -- gohugo.io</generator><atom:link href="https://docs.communityhealthtoolkit.org/beta/apps/index.xml" rel="self" type="application/rss+xml"/><item><title>Apps: Accessing CHT Apps</title><link>https://docs.communityhealthtoolkit.org/beta/apps/concepts/access/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/concepts/access/</guid><description>
&lt;p>Apps built with the Core Framework runs on most modern computers with the newest versions of Google Chrome or Mozilla Firefox.&lt;/p>
&lt;h2 id="hardware--software-requirements">Hardware &amp;amp; Software Requirements&lt;/h2>
&lt;p>Hardware procurement, ownership, and management is the responsibility of each implementing organization. We strongly urge all organizations to procure hardware locally to ensure ease of replacement, repair, sustainability, and hardware support when needed.&lt;/p>
&lt;h2 id="accessing-on-desktop">Accessing on Desktop&lt;/h2>
&lt;p>On desktop devices, there is no need to download anything. Simply go to a web browser and type in your unique URL, for example:&lt;/p>
&lt;p>&lt;code>{{projectname}}.app.medicmobile.org&lt;/code>&lt;/p>
&lt;h2 id="accessing-on-mobile">Accessing on Mobile&lt;/h2>
&lt;p>The app also runs with an app on Android phones and tablets. It works best on devices running version 5.1 or later with at least 8 GB of internal memory (16 GB for supervisors) and minimum 1 GHz RAM.&lt;/p>
&lt;h3 id="downloading">Downloading&lt;/h3>
&lt;figure class="right col-6 col-lg-3">&lt;a href="download-app-store.png">
&lt;img src="download-app-store.png"/> &lt;/a>
&lt;/figure>
&lt;p>To download your app on a mobile device, first navigate to the Google Play Store. From there, click on the search icon in the upper right, and type in the custom name of your health app or project. Make sure the app shown is the correct one and then select it. Then, click on the “Install” button to begin the download.&lt;/p>
&lt;h3 id="launching">Launching&lt;/h3>
&lt;p>Once the download is complete, you can access your app via an app icon in your applications menu. Note that the icon, as well as the app name displayed, is customizable by the organization or project.&lt;/p>
&lt;h2 id="logging-in">Logging In&lt;/h2>
&lt;figure class="right col-6 col-lg-3">&lt;a href="logging-in.png">
&lt;img src="logging-in.png"/> &lt;/a>
&lt;/figure>
&lt;p>When accessing your app for the very first time, a login page is displayed. Users enter a username and password that grant access to their customized app experience.&lt;/p>
&lt;p>On mobile devices, the app generally stays logged in after initial setup so that CHW users don’t have to type in their credentials each day.&lt;/p>
&lt;p>On desktop devices, the user must login again if they close the app tab or browser window.&lt;/p>
&lt;p>Users may log out by going to the options menu available in the top right corner of the app.&lt;/p>
&lt;p>&lt;em>See Also:&lt;/em> &lt;a href=https://docs.communityhealthtoolkit.org/beta/apps/concepts/navigation/#>Navigating CHT Apps&lt;/a>&lt;/p></description></item><item><title>Apps: Antenatal Care Reference App</title><link>https://docs.communityhealthtoolkit.org/beta/apps/examples/anc/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/examples/anc/</guid><description>
&lt;p>CHT applications are configurable by design and support an exceptional range of features and health service areas. The ANC Reference App provides organizations with a template for structuring and organizing you app, it’s configuration code, and testing framework. It includes a foundation for forms related to pregnancy and delivery, flexible data fields, and even analytics, and can be deployed as-is or customized by a developer for your unique context.&lt;/p>
&lt;p>To install the ANC Reference Application, follow the &lt;a href="https://github.com/medic/cht-core/blob/master/INSTALL.md">easy installation instructions&lt;/a>. An &lt;a href="anc-reference-app-overview.pdf">overview of the ANC Reference App&lt;/a> and its key features is also available.&lt;/p>
&lt;p>&lt;a href="anc-reference-app-overview.pdf">&lt;img src="preview-anc-ref-app-overview.png" alt="ANC Overview">&lt;/a>&lt;/p>
&lt;p>If you want to modify our ANC Reference Application for your project or context, read our &lt;a href="https://docs.communityhealthtoolkit.org/beta/design/apps/">configuration best practices&lt;/a> or learn how to &lt;a href="https://docs.communityhealthtoolkit.org/beta/apps/">develop your own community health apps&lt;/a>.&lt;/p></description></item><item><title>Apps: DHIS2</title><link>https://docs.communityhealthtoolkit.org/beta/apps/features/integrations/dhis2/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/features/integrations/dhis2/</guid><description>
&lt;p>Most health systems have regular reporting requirements for community-level activities. Health workers often carry around heavy logbooks to manually record all relevant activities. When it is time to submit their data, community health workers summarize what was recorded in their logbooks and share this information with their supervisors, who in turn create paper records of these totals across entire community units or health facilities. This paper record is often passed to yet another individual whose responsibility is to manually key in the data into a health information management system, such as DHIS2.&lt;/p>
&lt;p>In communities using digital health apps that do not integrate with DHIS2, it is highly likely that health workers are duplicating efforts by recording the same information in their app and in their logbook(s). For example, they are not only registering new pregnancies in their app, but they are also manually recording this in their logbooks, manually adding them up at the end of the month, and then someone else is manually keying this into DHIS2.&lt;/p>
&lt;p>In communities using digital health apps built with the CHT, health systems can reduce or eliminate the need to complete paper based forms for DHIS2 reporting needs. This gives health workers more time to focus on caring for the families in their community while also increasing accuracy and timeliness of their DHIS2 reporting requirements.&lt;/p>
&lt;h2 id="overview">Overview&lt;/h2>
&lt;p>CHT Core supports integrations with DHIS2 in a variety of ways:&lt;/p>
&lt;ol>
&lt;li>Sending patient data&lt;/li>
&lt;li>Sending event data&lt;/li>
&lt;li>Sending pre-aggregated &amp;ldquo;Service Reports&amp;rdquo;&lt;/li>
&lt;li>Aggregating data across multiple health workers into DHIS2 Data Values&lt;/li>
&lt;li>Exporting a file that can be imported into DHIS2 as a Data Set&lt;/li>
&lt;li>Exposing an API for DHIS2 app developers to pull aggregate data from CHT Core&lt;/li>
&lt;li>Receiving data from DHIS2&lt;/li>
&lt;/ol>
&lt;p>Sending patient, event, and pre-aggregated data can be achieved using the &lt;a href="https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/outbound/">Outbound push&lt;/a> feature. Receiving data from DHIS2 can be achieved using the &lt;a href="https://github.com/medic/cht-core/tree/master/api">CHT Core Web API&lt;/a>.&lt;/p>
&lt;p>Aggregating data across multiple health workers requires a somewhat specific workflow and was designed with three key user personas in mind. The aggregate workflow is described in more detail below.&lt;/p>
&lt;h2 id="aggregate-workflow">Aggregate Workflow&lt;/h2>
&lt;p>The aggregate workflow was designed specifically for CHWs, Supervisors, and Health Records Information Officers (HRIO) but may be adapted to other contexts.&lt;/p>
&lt;p>&lt;strong>CHW (Offline user)&lt;/strong>: Conducts home visits and records information in the app. Reviews aggregate data throughout the month and makes sure to sync at the end of the month.&lt;/p>
&lt;p>&lt;strong>Supervisor (Offline user)&lt;/strong>: Provides supervision to the CHWs, reviews and verifies aggregate data for an entire community unit.&lt;/p>
&lt;p>&lt;strong>HRIO (Online user)&lt;/strong>: Exports a file from the CHT and imports into DHIS2. Reviews data in DHIS2.&lt;/p>
&lt;h3 id="chw">CHW&lt;/h3>
&lt;p>CHWs support patients in their community by following care guides and recording responses in the CHT. The CHT calculates aggregate DHIS2 Data Values for each CHW based on rules configured in the CHT. CHWs can view these indicators on the Targets tab and should review them and sync at the end of the month.&lt;/p>
&lt;p>&lt;img src="chw.png" alt="CHWs" title="Feature Overview CHWs">&lt;/p>
&lt;p>&lt;em>See Also:&lt;/em> &lt;a href=https://docs.communityhealthtoolkit.org/beta/apps/features/targets/#>Targets&lt;/a>&lt;/p>
&lt;h3 id="supervisor">Supervisor&lt;/h3>
&lt;p>In addition to their own Targets, Supervisors can see the aggregate of each DHIS2 Data Value across &lt;em>all&lt;/em> CHWs in their area from the CHW Aggregate view on the Targets tab. By tapping on a Target, they can also see each CHW’s contribution towards that total. Supervisors can review and verify with CHWs that everyone has synced and their data is correct. The Supervisor can communicate with the HRIO when everything has been validated.&lt;/p>
&lt;p>&lt;img src="supervisor.png" alt="Supervisors" title="Feature Overview Supervisors">&lt;/p>
&lt;h3 id="hrio">HRIO&lt;/h3>
&lt;p>HRIOs access the CHT App Management tab and select the appropriate DHIS2 Data Set, Organisation Unit, and Period. They then “Export” a file that is formatted for DHIS2. HRIOs will need access to the “Import/Export” feature in DHIS2 so that they can “Import” the file. Once it has been imported into DHIS2, they review the data from the Data Entry screen in DHIS2.&lt;/p>
&lt;p>&lt;img src="data-entry-1.png" alt="Data Entry" title="Feature Overview Data Entry 1">&lt;/p>
&lt;h2 id="dhis2-apps">DHIS2 apps&lt;/h2>
&lt;p>The CHT also includes an &lt;a href="https://github.com/medic/cht-core/tree/master/api#get-apiv2exportdhis">API&lt;/a> that can be called from other applications that returns DHIS2 Data Sets. This means that you can build a &lt;a href="https://docs.dhis2.org/master/en/developer/html/apps_creating_apps.html">DHIS2 app&lt;/a> that pulls data from the CHT and imports it electronically into DHIS2. This would allow Data Entry to control the process directly from DHIS2 without having to access the CHT.&lt;/p>
&lt;p>&lt;img src="data-entry-2.png" alt="Data Entry" title="Feature Overview Data Entry 2">&lt;/p>
&lt;h2 id="version-notes">Version Notes&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Feature&lt;/th>
&lt;th>CHT Core version&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Calculate DHIS2 Data Values by aggregating data from CHT Core reports&lt;/td>
&lt;td>3.9.0&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Export file from CHT Core that can be imported into DHIS2 as a Data Set&lt;/td>
&lt;td>3.9.0&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table></description></item><item><title>Apps: CHT Local Environment Setup</title><link>https://docs.communityhealthtoolkit.org/beta/apps/tutorials/local-setup/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/tutorials/local-setup/</guid><description>
&lt;h2 id="purpose-of-the-tutorial">Purpose of the tutorial&lt;/h2>
&lt;p>This tutorial will take you through setting up a local environment to build and test CHT applications. This includes setting up the necessary tools to download and run the CHT public docker image as well as a command line interface tool to manage and build CHT apps.&lt;/p>
&lt;p>By the end of the tutorial you should be able to:&lt;/p>
&lt;ul>
&lt;li>View the login page to CHT webapp on localhost&lt;/li>
&lt;li>Upload default settings to localhost&lt;/li>
&lt;/ul>
&lt;h2 id="brief-overview-of-key-concepts">Brief overview of key concepts&lt;/h2>
&lt;p>&lt;strong>CHT Core Framework&lt;/strong> The Core Framework makes it faster to build full-featured, scalable digital health apps by providing a foundation developers can build on. These apps can support most languages, are offline-first, and work on basic phones (via SMS), smartphones, tablets, and computers.&lt;/p>
&lt;p>&lt;strong>Medic Project Configurer&lt;/strong> a.k.a &lt;em>&lt;strong>medic-conf&lt;/strong>&lt;/em> is command-line interface tool to manage and configure CHT apps.&lt;/p>
&lt;p>&lt;strong>Docker&lt;/strong> is a tool designed to make it easier to create, deploy, and run applications by using containers.&lt;/p>
&lt;p>&lt;strong>Containers&lt;/strong> allow a developer to package up an application with all of the parts it needs, such as libraries and other dependencies, and deploy it as one package.&lt;/p>
&lt;h2 id="required-resources">Required resources&lt;/h2>
&lt;p>Before you begin, you need to have some useful software and tools that are required for things to work.&lt;/p>
&lt;p>First off, install &lt;a href="https://nodejs.org/en/">nodejs&lt;/a> 8 or later and &lt;a href="https://www.npmjs.com/get-npm">npm&lt;/a>.&lt;/p>
&lt;p>You also require Docker for your operating system:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.docker.com/engine/install/ubuntu/">Docker for Ubuntu&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://hub.docker.com/editions/community/docker-ce-desktop-mac">Docker for MacOS&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://hub.docker.com/editions/community/docker-ce-desktop-windows">Docker for Windows&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="implementation-steps">Implementation steps&lt;/h2>
&lt;p>Now that you have the dependent tools and software install, you are ready to begin setting up your CHT local environment.&lt;/p>
&lt;h3 id="1-install-medic-conf">1. Install medic-conf&lt;/h3>
&lt;p>Using npm on your terminal or command line, install medic-conf globally using the following command;&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-zsh" data-lang="zsh">npm install -g medic-conf
&lt;/code>&lt;/pre>&lt;/div>&lt;p>You can confirm that the installation was successful by typing &lt;code>medic-conf&lt;/code> in your terminal or command line.&lt;/p>
&lt;p>&lt;img src="confirm-medic-conf.png" alt="confirm medic-conf" title="Confirm medic-conf">&lt;/p>
&lt;h3 id="2-install-the-core-framework">2. Install the Core Framework&lt;/h3>
&lt;p>Download the &lt;a href="https://github.com/medic/cht-core/blob/master/docker-compose.yml">docker-compose.yml&lt;/a> file to a folder of your choice. Be sure to place it in a folder that&amp;rsquo;s easy to find on terminal or command line.&lt;/p>
&lt;p>Open your terminal or command line and navigate to the folder where you have your &lt;a href="https://github.com/medic/cht-core/blob/master/docker-compose.yml">docker-compose.yml&lt;/a> file and run the command:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-zsh" data-lang="zsh">docker-compose up
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Once the command is done running, navigate to &lt;code>https://localhost&lt;/code> on a Google Chrome browser and login with the default username &lt;code>medic&lt;/code> and default password &lt;code>password&lt;/code>.&lt;/p>
&lt;p>&lt;img src="medic-login.png" alt="medic login" title="Medic login">&lt;/p>
&lt;h3 id="3-create-and-upload-a-blank-project">3. Create and upload a blank project&lt;/h3>
&lt;p>With &lt;code>medic-conf&lt;/code> you can create a blank project. This provides you a template from which you can begin working on CHT. Just run:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-zsh" data-lang="zsh">mkdir cht-app-tutorials
&lt;span style="color:#204a87">cd&lt;/span> cht-app-tutorials
medic-conf initialise-project-layout
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="init-project-layout.png" alt="initialise project layout" title="Initialise project layout">&lt;/p>
&lt;p>Then deploy the blank project onto your local test environment with the command:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-zsh" data-lang="zsh">medic-conf --url&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>https://medic:password@localhost --accept-self-signed-certs
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;code>accept-self-signed-certs&lt;/code> tells medic-conf that it’s OK that the server’s certificate isn’t signed properly, which will be the case when using docker locally.&lt;/p>
&lt;p>Once you have run the above command it should complete with the message: &lt;code>INFO All actions completed.&lt;/code>.&lt;/p>
&lt;p>&lt;img src="all-actions-completed.png" alt="all actions completed" title="All actions completed">&lt;/p>
&lt;h2 id="frequently-asked-questions">Frequently Asked Questions&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://forum.communityhealthtoolkit.org/t/cant-upgrade-to-3-8-version/608">How do I upgrade to a higher version of the webapp?&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://forum.communityhealthtoolkit.org/t/unable-to-install-core-framework-in-cloud-instance/533">How do I access the instance remotely?&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Apps: SMS message states</title><link>https://docs.communityhealthtoolkit.org/beta/apps/guides/messaging/sms-states/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/guides/messaging/sms-states/</guid><description>
&lt;h2 id="interaction-with-sms-providers">Interaction with SMS providers&lt;/h2>
&lt;p>&lt;a href="https://github.com/medic/medic">Medic&lt;/a> can use &lt;a href="https://github.com/medic/medic-gateway">medic-gateway&lt;/a> and third party aggregators to send and receive SMS messages.&lt;/p>
&lt;p>When an SMS report comes in from a user, &lt;a href="https://github.com/medic/medic-sentinel">medic-sentinel&lt;/a> adds the appropriate list of scheduled messages (to be sent at a future date) to the report doc.&lt;/p>
&lt;p>Periodically, sentinel checks for messages that need to be sent, and &lt;a href="https://github.com/medic/medic-sentinel/blob/master/schedule/due_tasks.js">sets their state to &lt;code>pending&lt;/code>&lt;/a> if their scheduled sending time has been reached or passed.&lt;/p>
&lt;p>Periodically, the aggregator checks for messages that need to be sent (i.e. that are in &lt;code>pending&lt;/code> state).&lt;/p>
&lt;p>The aggregator also reports on the status of the messages it&amp;rsquo;s sending.&lt;/p>
&lt;h2 id="message-statusesstates">Message statuses/states&lt;/h2>
&lt;p>Both webapp and the aggregator store states/statuses of the messages to keep track of the exchange. They each have their set of statuses, which sometimes are called the same but do not mean the same thing. Watch out.&lt;/p>
&lt;h3 id="message-statuses-in-medic-gateway">Message statuses in medic-gateway&lt;/h3>
&lt;p>See &lt;a href="https://github.com/medic/medic-gateway#content">https://github.com/medic/medic-gateway#content&lt;/a>&lt;/p>
&lt;h3 id="message-states-in-medic">Message states in medic&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>State&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>scheduled&lt;/td>
&lt;td>Not yet due. Messages as part of a configured schedule start in this state and are changed to &lt;code>pending&lt;/code> when due.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>pending&lt;/td>
&lt;td>Due to be sent. The SMS gateway should pick this up for sending. Auto replies and instant messages start in this state.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>forwarded-to-gateway&lt;/td>
&lt;td>Message has been sent to gateway.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>received-by-gateway&lt;/td>
&lt;td>Has been received by the gateway.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>forwarded-by-gateway&lt;/td>
&lt;td>Gateway has tried sending the message.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>sent&lt;/td>
&lt;td>Successfully delivered to the sms network.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>delivered&lt;/td>
&lt;td>Successfully received by the recipient&amp;rsquo;s device.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>failed&lt;/td>
&lt;td>The sending attempt failed. Sending will not be retried without user intervention.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>denied&lt;/td>
&lt;td>This will not be sent. The recipient phone number is configured to be denied via &lt;code>outgoing_deny_list&lt;/code>, &lt;code>outgoing_deny_with_alphas&lt;/code>, or &lt;code>outgoing_deny_shorter_than&lt;/code>.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>cleared&lt;/td>
&lt;td>This will not be sent as a report has triggered an event to stop it. This can happen if a patient visit has occurred before the visit reminder is sent.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>muted&lt;/td>
&lt;td>This will not be sent as the task has been deliberately stopped. Messages in this state can be unmuted by user action.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="timeline-of-the-medic-gateway-protocol-for-webapp-originating-message">Timeline of the medic-gateway protocol for webapp-originating message&lt;/h2>
&lt;p>Read the table below like a vertical timeline : each time an event happens, the states/statuses corresponding to the message get updated.&lt;/p>
&lt;p>Note 1 : Gateway only sends a status update for a message only if the &amp;ldquo;needs forwarding&amp;rdquo; flag for the message status is true, and then sets it back to false. So it only sends status updates once.&lt;/p>
&lt;p>Note 2 : If api sends the same WO message again, then gateway sets its needs forwarding flag to true, and so sends the status at the next poll.&lt;/p>
&lt;p>Note 3 : not all of the events below happen every time : this is assuming only one step of SMS-sending happens between each poll. If several steps happened, then some of the events below are skipped. If several status changes have happened between polls, Gateway will report the multiple new statuses at the next poll.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>number&lt;/th>
&lt;th>Event&lt;/th>
&lt;th>webapp state&lt;/th>
&lt;th>gateway status&lt;/th>
&lt;th>gateway &amp;ldquo;Needs forwarding&amp;rdquo; flag&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>1&lt;/td>
&lt;td>Due date to send the message passes&lt;/td>
&lt;td>pending&lt;/td>
&lt;td>&amp;mdash;&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>2&lt;/td>
&lt;td>Gateway polls and gets a new WO message&lt;/td>
&lt;td>forwarded-to-gateway&lt;/td>
&lt;td>&amp;mdash;&lt;/td>
&lt;td>&amp;mdash;&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>3&lt;/td>
&lt;td>Gateway saves message in its DB&lt;/td>
&lt;td>forwarded-to-gateway&lt;/td>
&lt;td>UNSENT&lt;/td>
&lt;td>true&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>4&lt;/td>
&lt;td>Gateway reports UNSENT status for the message&lt;/td>
&lt;td>received-by-gateway&lt;/td>
&lt;td>UNSENT&lt;/td>
&lt;td>false&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>5&lt;/td>
&lt;td>Gateway sends the message&lt;/td>
&lt;td>received-by-gateway&lt;/td>
&lt;td>PENDING&lt;/td>
&lt;td>true&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>6&lt;/td>
&lt;td>Gateway reports PENDING status for the message&lt;/td>
&lt;td>forwarded-by-gateway&lt;/td>
&lt;td>PENDING&lt;/td>
&lt;td>false&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>7&lt;/td>
&lt;td>Gateway gets confirmation the message left&lt;/td>
&lt;td>forwarded-by-gateway&lt;/td>
&lt;td>SENT&lt;/td>
&lt;td>true&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>8&lt;/td>
&lt;td>Gateway reports SENT status for the message&lt;/td>
&lt;td>sent&lt;/td>
&lt;td>SENT&lt;/td>
&lt;td>false&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>9&lt;/td>
&lt;td>Gateway gets confirmation the message arrived&lt;/td>
&lt;td>sent&lt;/td>
&lt;td>DELIVERED&lt;/td>
&lt;td>true&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>10&lt;/td>
&lt;td>Gateway reports DELIVERED status for the message&lt;/td>
&lt;td>delivered&lt;/td>
&lt;td>DELIVERED&lt;/td>
&lt;td>false&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table></description></item><item><title>Apps: Contact and User Management - Part 1</title><link>https://docs.communityhealthtoolkit.org/beta/apps/tutorials/contact-and-users-1/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/tutorials/contact-and-users-1/</guid><description>
&lt;h2 id="purpose-of-the-tutorial">Purpose of the tutorial&lt;/h2>
&lt;p>In this tutorial you will learn how to create and edit contacts and their associated users in the CHT application using the default contact creation forms. This will help you get familiar with the UI of the webapp as well as some features and functionality. If you are already comfortable with this, you can skip to &lt;a href="creating-and-managing-users-and-contacts-with-medic-conf.md">manipulating contacts and their associated documents using medic conf&lt;/a>.&lt;/p>
&lt;h2 id="brief-overview-of-key-concepts">Brief overview of key concepts&lt;/h2>
&lt;p>&lt;strong>Contacts&lt;/strong> are people or places that are created in the CHT application.&lt;/p>
&lt;p>&lt;strong>People&lt;/strong> are both patients in the system and users of the system, such as CHWs or Nurses.&lt;/p>
&lt;p>&lt;strong>Places&lt;/strong> represent either an actual physical location such as a health facility, clinic, or a grouping such as a household or CHW area.&lt;/p>
&lt;p>&lt;strong>Contact forms&lt;/strong> are forms in the CHT app that are used to create people or places.&lt;/p>
&lt;p>&lt;strong>CHT app hierarchy&lt;/strong> is often modeled after the health system, health program or community structure. All people who are registered in the app must be associated with a place. These places are located in a hierarchy with other places. For instance, a Family Member is part of a Household. A Household and CHWs are part of a CHW Area. A CHW Area and nurses are part of a Health Facility. Additional levels may be added as needed. The Admin level operates outside of the hierarchy and gives access to all levels and people.&lt;/p>
&lt;p>&lt;img src="app-hierarchy.jpg" alt="app hierarchy" title="Default app hierarchy">&lt;/p>
&lt;p>&lt;strong>Users&lt;/strong> represent credentials and roles / permissions for accessing the application. This can either be:&lt;/p>
&lt;ul>
&lt;li>People who can log into the application, such as CHWs or Nurses or&lt;/li>
&lt;li>Credentials granting external software restricted permissions to perform certain tasks, such as allowing an external service permission to write reports via the api.&lt;/li>
&lt;/ul>
&lt;h2 id="required-resources">Required resources&lt;/h2>
&lt;p>You should have a functioning CHT instance with contact forms configured. Read &lt;a href="setting_up_local_configuration_environment.md">How to set up a CHT local configuration environment&lt;/a>&lt;/p>
&lt;h2 id="implementation-steps">Implementation steps&lt;/h2>
&lt;p>In this tutorial, you will work with the default contact forms and the default hierachy. The default hierarchy is illustrated above as part of the overview of key concepts.&lt;/p>
&lt;p>While logged in as an admin user, you will first create the Health Facility, CHW Supervisor, CHW Area, and CHW. You will then create the users for the CHW so that they can log in and create households and household members.&lt;/p>
&lt;h3 id="1-create-the-health-facility-chw-supervisor-chw-area-and-chw">1. Create the Health Facility, CHW Supervisor, CHW Area, and CHW&lt;/h3>
&lt;h4 id="create-new-health-facility">Create new Health facility&lt;/h4>
&lt;p>While logged into the CHT application, go to the people tab and select &lt;code>New health facility&lt;/code>&lt;/p>
&lt;p>&lt;img src="new-facility/select-new-facility.png" alt="new health facility" title="New health facility">&lt;/p>
&lt;p>There are 2 options for assigning a primary contact for the new facility:&lt;/p>
&lt;ul>
&lt;li>Creating a new contact as you are creating the new facility&lt;/li>
&lt;li>Selecting a primary contact from already created contacts&lt;/li>
&lt;/ul>
&lt;p>For now we will skip creating or assigning a primary contact so that we can focus on creating the new facility.&lt;/p>
&lt;p>&lt;img src="new-facility/skip-primary-contact.png" alt="skip primary contact" title="Skip primary contact">&lt;/p>
&lt;p>Enter the details of the facility and submit the form.&lt;/p>
&lt;p>&lt;img src="new-facility/enter-facility-name.png" alt="enter facility details" title="Enter facility details">&lt;/p>
&lt;p>You should see the newly created facility appear on the left hand side and when you select it, you will see details of the facility appear on the right hand side.&lt;/p>
&lt;p>&lt;img src="new-facility/created-facility.png" alt="created facility" title="Created facility">&lt;/p>
&lt;h4 id="create-chw-area-and-chw">Create CHW Area and CHW&lt;/h4>
&lt;p>We will now create a place and the primary contact for the place within one form. We want to create a CHW area within the facility that we previously created.&lt;/p>
&lt;p>Select the Health facility on the left hand side. You will then select &lt;code>New area&lt;/code> on the right hand side.&lt;/p>
&lt;p>&lt;img src="new-chw-area/new-chw-area.png" alt="new chw area" title="New CHW area">&lt;/p>
&lt;p>Select the option that lets you create a new person within the form. This person will automatically become the primary contact for the created place.&lt;/p>
&lt;p>&lt;img src="new-chw-area/create-new-person.png" alt="create new person" title="Create a new person">&lt;/p>
&lt;p>Fill in the required fields and go to the next section.&lt;/p>
&lt;p>&lt;img src="new-chw-area/fill-required-fields.png" alt="fill fields" title="Fill required fields">&lt;/p>
&lt;p>You will get an option to name the place after the created contact person or name it yourself. If you select &lt;code>Yes&lt;/code>, the new place will be named &lt;code>&amp;lt;contact-name&amp;gt;'s Area&lt;/code>. For example &lt;code>Jane Doe's Area&lt;/code>.&lt;/p>
&lt;p>&lt;img src="new-chw-area/name-after-primary-contact.png" alt="name after contact" title="Name after contact">&lt;/p>
&lt;p>Once you submit, a new CHW area will be created. You should see on the right hand, the CHW Area name, the primary contact of the CHW Area, and the facility that the CHW area belongs to.&lt;/p>
&lt;p>&lt;img src="new-chw-area/created-chw-area.png" alt="created area" title="Created CHW Area">&lt;/p>
&lt;h4 id="create-chw-supervisor">Create CHW Supervisor&lt;/h4>
&lt;p>To create a primary contact for an existing place (in this case, for the facility that we created without a primary contact); select the place and the select the &lt;code>New person&lt;/code> action.&lt;/p>
&lt;p>&lt;img src="new-chw-supervisor/new-person.png" alt="new person" title="New person">&lt;/p>
&lt;p>A new person form will appear with an option to change the place the new person will belong to. Once you submit this form, a new contact will be created in the Facility.&lt;/p>
&lt;p>&lt;img src="new-chw-supervisor/belongs-to.png" alt="belongs to" title="Belongs to">&lt;/p>
&lt;p>Finally, we will set the newly created person as a primary contact for the Facility they belong to. To do this, select the facility and then select the &lt;code>Edit&lt;/code> action.&lt;/p>
&lt;p>&lt;img src="new-chw-supervisor/edit-facility.png" alt="edit facility" title="Edit facility">&lt;/p>
&lt;p>You should see an edit form from which you can set the primary contact of the facility and submit to apply the changes.&lt;/p>
&lt;p>&lt;img src="new-chw-supervisor/set-primary-contact.png" alt="set primary contact" title="Set primary contact">&lt;/p>
&lt;h3 id="2-create-the-chw-user">2. Create the CHW user&lt;/h3>
&lt;p>With the CHW and CHW Supervisor contacts created, you may want to log in as a CHW and perform some actions. To do this, let&amp;rsquo;s create a CHW user that&amp;rsquo;s linked to the CHW contact we created earlier.&lt;/p>
&lt;p>Go to the hamburger menu and select &lt;code>App Settings&lt;/code>.&lt;/p>
&lt;p>&lt;img src="new-chw-user/app-settings.png" alt="app settings" title="App settings">&lt;/p>
&lt;p>When you are on the &lt;code>App Settings&lt;/code> page, select &lt;code>Users&lt;/code> on the right hand side and then select &lt;code>Add user&lt;/code>.&lt;/p>
&lt;p>&lt;img src="new-chw-user/add-user.png" alt="add user" title="Add user">&lt;/p>
&lt;p>You should now see an &lt;code>Add user&lt;/code> form. Fill in the user name, the select the role as &lt;code>CHW&lt;/code> or &lt;code>Regional admin&lt;/code>. In the &lt;code>Place&lt;/code> field, select the name of the CHW area whose CHW you want to create a user for (you can search by typing the first few letters of the CHW area name). Once that is done, under the &lt;code>Associate contact&lt;/code> field select the name of the CHW whose user you are creating. Finally, input a password and hit submit.&lt;/p>
&lt;p>&lt;img src="new-chw-user/fill-user-details.png" alt="user details" title="Fill user details">&lt;/p>
&lt;p>Once this is done, you can logout and log into the app using the username and password that you just created.&lt;/p>
&lt;h2 id="frequently-asked-questions">Frequently Asked Questions&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://forum.communityhealthtoolkit.org/t/is-there-any-downside-of-creating-too-many-users/531">Is there any downside of creating too many users?&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://forum.communityhealthtoolkit.org/t/for-offline-users-how-often-does-the-app-try-to-refresh-if-there-is-an-available-internet-connection/503">For offline users, how often does the app try to refresh if there is an available internet connection?&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://forum.communityhealthtoolkit.org/t/can-one-person-belong-to-multiple-places-in-the-same-hierarchy/101">Can one person belong to multiple places in the same hierarchy?&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Apps: Navigating CHT Apps</title><link>https://docs.communityhealthtoolkit.org/beta/apps/concepts/navigation/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/concepts/navigation/</guid><description>
&lt;h2 id="summary-of-page-tabs">Summary of Page Tabs&lt;/h2>
&lt;figure class="right col-6 col-lg-3">&lt;a href="page-tabs.png">
&lt;img src="page-tabs.png"/> &lt;/a>
&lt;/figure>
&lt;p>Page tabs are the primary way to navigate apps built with the Core Framework. The number of tabs is variable depending on the user’s role and place in the hierarchy. For example, non-admin users don’t have Messages. The Reports tab is accessible to CHWs but often located inside the secondary menu drawer.&lt;/p>
&lt;ul>
&lt;li>&lt;strong>People​&lt;/strong>: This is where profiles of districts, staff, CHWs and patients live&lt;/li>
&lt;li>&lt;strong>Tasks​&lt;/strong>: This is a list of upcoming visits, follow-ups, or other required tasks&lt;/li>
&lt;li>&lt;strong>Targets&lt;/strong>: Displays real-time visualizations of key activity and impact indicators&lt;/li>
&lt;li>&lt;strong>Reports​&lt;/strong>: A detailed history of all forms submitted by CHWs and other staff&lt;/li>
&lt;li>&lt;strong>Messages​&lt;/strong>: A place for community-based staff to send and exchange messages&lt;/li>
&lt;/ul>
&lt;h2 id="the-menu-drawer">The Menu Drawer&lt;/h2>
&lt;figure class="right col-6 col-lg-3">&lt;a href="menu-drawer.png">
&lt;img src="menu-drawer.png"/> &lt;/a>
&lt;/figure>
&lt;p>Tap the menu icon in the upper right corner of the header to access other pages, edit personal settings, view sync status and more.&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Admin Console&lt;/strong>: Change advanced app settings (only admin users will see this)&lt;/li>
&lt;li>&lt;strong>Guided Tour&lt;/strong>: Review new features and important tips&lt;/li>
&lt;li>&lt;strong>About&lt;/strong>: View your app version and other detailed database information&lt;/li>
&lt;li>&lt;strong>User Settings&lt;/strong>: Update basic user information like email, phone number, and password&lt;/li>
&lt;li>&lt;strong>Report Bug&lt;/strong>: Let us know if something isn’t working or you encounter errors&lt;/li>
&lt;li>&lt;strong>Log Out&lt;/strong>: Sign out of the app&lt;/li>
&lt;/ul>
&lt;h2 id="sync-status">Sync Status&lt;/h2>
&lt;figure class="right col-6 col-lg-3">&lt;a href="sync-status.png">
&lt;img src="sync-status.png"/> &lt;/a>
&lt;/figure>
&lt;p>At the bottom of the menu is a notification which provides important about sync status. It lets you know whether reports are being submitted.&lt;/p>
&lt;p>If the sync status is green and says “All reports synced,” your reports have been sent. This means you have successfully uploaded all of your data to the server. However, it doesn’t necessarily mean you have downloaded all of the most recent data from the server.&lt;/p>
&lt;p>If the indicator is red, it means there are still reports waiting to send. This means you have not successfully uploaded all of your data to the server. You should check your internet and data connection.&lt;/p></description></item><item><title>Apps: OpenMRS</title><link>https://docs.communityhealthtoolkit.org/beta/apps/features/integrations/openmrs/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/features/integrations/openmrs/</guid><description/></item><item><title>Apps: RapidPro</title><link>https://docs.communityhealthtoolkit.org/beta/apps/features/integrations/rapidpro/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/features/integrations/rapidpro/</guid><description/></item><item><title>Apps: Contact and User Management - Part 2</title><link>https://docs.communityhealthtoolkit.org/beta/apps/tutorials/contact-and-users-2/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/tutorials/contact-and-users-2/</guid><description>
&lt;h2 id="purpose-of-the-tutorial">Purpose of the tutorial&lt;/h2>
&lt;p>In this tutorial you will learn how to create and edit contacts and their associated users in the CHT application using medic-conf. If you haven&amp;rsquo;t already, have a look at &lt;a href="creating-and-managing-users-and-contacts.md">part 1&lt;/a> of this tutorial for a useful overview of key concepts.&lt;/p>
&lt;h2 id="brief-overview-of-key-concepts">Brief overview of key concepts&lt;/h2>
&lt;p>&lt;a href="https://github.com/medic/medic-conf">&lt;strong>medic-conf&lt;/strong>&lt;/a> is a command-line interface tool to manage and configure your apps built using the Core Framework of the Community Health Toolkit.&lt;/p>
&lt;p>See more &lt;a href="creating-and-managing-users-and-contacts.md#brief-overview-of-key-concepts">key concepts&lt;/a> in part 1 of this tutorial.&lt;/p>
&lt;h2 id="required-resources">Required resources&lt;/h2>
&lt;p>You should have a functioning CHT instance and have medic-conf installed locally. Read &lt;a href="setting_up_local_configuration_environment.md">How to set up a CHT local configuration environment&lt;/a>&lt;/p>
&lt;h2 id="implementation-steps">Implementation steps&lt;/h2>
&lt;p>In these steps you are going to create a Health Facility, CHW areas, primary contacts for the CHW areas, and their associated users.&lt;/p>
&lt;h3 id="1-create-health-facilities-using-medic-confs-csv-to-docs-and-upload-docs-features">1. Create Health Facilities (using medic-conf&amp;rsquo;s csv-to-docs and upload-docs features)&lt;/h3>
&lt;p>To create contacts and their associated users with medic-conf, you will need to create a CSV file with the information of the contacts and the users that you would like to create. The name of the file determines the type of doc created for rows contained in the file.&lt;/p>
&lt;p>For example, file named &lt;code>place.district_hospital.csv&lt;/code> adds the property &lt;code>&amp;quot;type&amp;quot;:&amp;quot;district_hospital&amp;quot;&lt;/code> and a file named &lt;code>person.clinic.csv&lt;/code> add the property &lt;code>&amp;quot;type&amp;quot;:&amp;quot;person&amp;quot;&lt;/code>&lt;/p>
&lt;p>Create a CSV file named &lt;code>place.district_hospital.csv&lt;/code> and add the details of the health facilities you would like to create.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>name&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Nairobi South Facility&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Nairobi West Facility&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Nairobi East Facility&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>Save this file to a folder name &lt;code>csv&lt;/code> in your project&amp;rsquo;s base directory.&lt;/p>
&lt;p>Open terminal or command line. &lt;code>cd&lt;/code> to your project&amp;rsquo;s base directory and then run the command&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-zsh" data-lang="zsh">medic-conf csv-to-docs
&lt;/code>&lt;/pre>&lt;/div>&lt;p>This will convert rows of the CSV files from the &lt;code>csv&lt;/code> folder to JSON docs that are stored in a &lt;code>json-docs&lt;/code> folder.&lt;/p>
&lt;p>To upload the JSON docs to your local test instance, run the command&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-zsh" data-lang="zsh">medic-conf --url&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>https://&amp;lt;username&amp;gt;:&amp;lt;password&amp;gt;@localhost --accept-self-signed-certs upload-docs
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Be sure to replace the values &lt;code>&amp;lt;username&amp;gt;&lt;/code> and &lt;code>&amp;lt;password&amp;gt;&lt;/code> with the actual username and password of your test instance.&lt;/p>
&lt;h3 id="2-create-chw-areas-chw-contacts-and-users-using-medic-confs-create-users-feature">2. Create CHW Areas, CHW Contacts and Users (using medic-conf&amp;rsquo;s create-users feature)&lt;/h3>
&lt;p>Next you are going to create CHW areas for the health facilities you created in the step above along with the CHW contacts and users for these CHW areas.&lt;/p>
&lt;p>Create a CSV file named &lt;code>users.csv&lt;/code> and add the details of the Users, CHW contacts, and CHW Areas you would like to create. Save this file in the base project directory.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>username&lt;/th>
&lt;th>password&lt;/th>
&lt;th>roles&lt;/th>
&lt;th>name&lt;/th>
&lt;th>phone&lt;/th>
&lt;th>contact.name&lt;/th>
&lt;th>contact.phone&lt;/th>
&lt;th>contact.sex&lt;/th>
&lt;th>contact.age&lt;/th>
&lt;th>place.type&lt;/th>
&lt;th>place.name&lt;/th>
&lt;th>place.parent&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>mmutiso&lt;/td>
&lt;td>q3Z5-vH5&lt;/td>
&lt;td>district_admin&lt;/td>
&lt;td>Mary Mutiso&lt;/td>
&lt;td>0712345678&lt;/td>
&lt;td>Mary Mutiso&lt;/td>
&lt;td>0712345678&lt;/td>
&lt;td>Female&lt;/td>
&lt;td>36&lt;/td>
&lt;td>health_center&lt;/td>
&lt;td>Mary Mutiso&amp;rsquo;s Area&lt;/td>
&lt;td>&lt;code>&amp;lt;facility uuid&amp;gt;&lt;/code>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>The value &lt;code>place.parent&lt;/code> is the uuid of the Facility to which the CHW Area belongs to. You can get this value by selecting the Facility in the webapp and copying the last portion of the url.&lt;/p>
&lt;p>&lt;img src="facility-uuid.png" alt="facility uuid" title="Facility uuid">&lt;/p>
&lt;p>Run the command&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-zsh" data-lang="zsh">medic-conf --url&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>https://&amp;lt;username&amp;gt;:&amp;lt;password&amp;gt;@localhost --accept-self-signed-certs create-users
&lt;/code>&lt;/pre>&lt;/div>&lt;p>This will create the CHW area, the CHW contact, and the user that the CHW will use to log into the application.&lt;/p>
&lt;h2 id="frequently-asked-questions">Frequently Asked Questions&lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://forum.communityhealthtoolkit.org/t/can-one-person-belong-to-multiple-places-in-the-same-hierarchy/101">Can one person belong to multiple places in the same hierarchy?&lt;/a>&lt;/li>
&lt;/ul></description></item><item><title>Apps: Forms</title><link>https://docs.communityhealthtoolkit.org/beta/apps/concepts/forms/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/concepts/forms/</guid><description>
&lt;p>Forms are a building block of all CHT apps. They are used when creating or editing contacts, and when completing a care guide or survey within the app. Forms are also used to interpret SMS interactions with the CHT.&lt;/p>
&lt;p>There are different types of forms:&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://docs.communityhealthtoolkit.org/beta/apps/reference/forms/contact/">&lt;strong>Contact Forms&lt;/strong>&lt;/a>: used to create and edit contacts. Defined as CHT-enhanced XForms.&lt;/li>
&lt;li>&lt;a href="https://docs.communityhealthtoolkit.org/beta/apps/reference/forms/app/">&lt;strong>App Forms&lt;/strong>&lt;/a>: serve as actions within the app, such as a task or an action. Defined as CHT-enhanced XForms.&lt;/li>
&lt;li>&lt;a href="https://docs.communityhealthtoolkit.org/beta/apps/reference/forms/collect/">&lt;strong>Collect Forms&lt;/strong>&lt;/a>: used to render forms in Medic Collect. Defined as ODK XForms and need a corresponding JSON form to receive data in CHT.&lt;/li>
&lt;li>&lt;a href="https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/forms/">&lt;strong>JSON Forms&lt;/strong>&lt;/a>: used for data coming from external channels such as SMS, or via interoperability with other tools. Defined according to a JavaScript Object Notation schema.&lt;/li>
&lt;/ul>
&lt;p>Forms that can be completed in the app are built using a CHT-enhanced version of &lt;a href="https://opendatakit.github.io/xforms-spec/">ODK XForms&lt;/a> notation &amp;ndash; a XML definition of the structure and format for a set of questions. Since writing raw XML can be tedious, the &lt;a href="http://xlsform.org/">XLSForm standard&lt;/a> is commonly used to define forms. The &lt;a href="https://github.com/medic/medic-conf">medic-conf&lt;/a> command line tool can be used to convert to the XForm format and include the form in a CHT application. The instructions on this site assume some knowledge of XLSForm.&lt;/p></description></item><item><title>Apps: Care Guides</title><link>https://docs.communityhealthtoolkit.org/beta/apps/concepts/care-guides/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/concepts/care-guides/</guid><description>
&lt;h2 id="care-guides">Care Guides&lt;/h2>
&lt;figure class="right col-6 col-lg-3">&lt;a href="care-guides.png">
&lt;img src="care-guides.png"/> &lt;/a>
&lt;/figure>
&lt;p>Forms are used to build “Care Guides” that take health workers through care protocols and provide decision support for their interactions with patients. App designers can use the basic form building functionality in a variety of ways.&lt;/p>
&lt;p>Care Guides also allow CHWs to register new families and people, assess a sick child, and enroll a new pregnancy into an antenatal care schedule. Care Guides can be located in many parts of your app, including the Tasks, People, and Reports tabs.&lt;/p>
&lt;p>Care Guides provided in the CHT&amp;rsquo;s Reference Applications can be configured for your app, or a new Care Guide can be written from scratch. Some configuration is probably necessary due to different local requirements, and government protocols.&lt;/p>
&lt;h3 id="functionality">Functionality&lt;/h3>
&lt;figure class="right col-6 col-lg-3">&lt;a href="functionality.png">
&lt;img src="functionality.png"/> &lt;/a>
&lt;/figure>
&lt;p>Care Guides consists of questions grouped into pages. They are capable of presenting many different types of questions, skip logic, images, and videos. Validation rules can require certain questions to be answered or restrict answers to a specified type or range.&lt;/p>
&lt;p>It’s possible to reference previous information that was submitted about the person or household from within the care guide. The interaction can also conclude with a summary that includes assessment results, treatment recommendations, and referral info.&lt;/p>
&lt;p>Care Guides can include images for instructional purposes and can access a user’s camera to take a photo if needed.&lt;/p>
&lt;h3 id="summary">Summary&lt;/h3>
&lt;figure class="right col-6 col-lg-3">&lt;a href="summary.png">
&lt;img src="summary.png"/> &lt;/a>
&lt;/figure>
&lt;p>After all of the required questions have been answered, a summary page can be displayed.&lt;/p>
&lt;p>Here, health workers can review the information they entered, receive instructions for treatment, care, and referrals, and relay detailed education to the patient.&lt;/p>
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">Note&lt;/h4>
The form is not submitted until the user scrolls to the very end of the summary and clicks the &lt;code>Submit&lt;/code> button.
&lt;/div>
&lt;h3 id="examples">Examples&lt;/h3>
&lt;figure class="right col-6 col-lg-3">&lt;a href="examples.png">
&lt;img src="examples.png"/> &lt;/a>
&lt;/figure>
&lt;ul>
&lt;li>While a health worker is going through the form during the care visit, you can include a family planning question only if the person who the form is about is a woman and not pregnant.&lt;/li>
&lt;li>You can include on-the-spot conversational prompts and advice for the CHW based on how they answer questions in the form. For instance, if a CHW answers “yes” to the question about a woman’s interest in family planning, text can automatically appear to provide information on her options.&lt;/li>
&lt;li>An image showing how to read a rapid test can be displayed within a form, to help health workers to correctly interpret their test results.&lt;/li>
&lt;/ul></description></item><item><title>Apps: .contact_types</title><link>https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/hierarchy/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/hierarchy/</guid><description>
&lt;p>From 3.7.0 it is possible to configure what types of places and people are available by modifying the &lt;code>contact_types&lt;/code> array in the app settings. Each type has the following properties.&lt;/p>
&lt;h3 id="app_settingsjson-contact_types">&lt;code>app_settings.json .contact_types[]&lt;/code>&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Property&lt;/th>
&lt;th>Description&lt;/th>
&lt;th>Required&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>id&lt;/code>&lt;/td>
&lt;td>String identifier for the type. At times this will be used to sort the contacts in the UI so it is recommended to using a number prefix with gaps between numbers, eg: &lt;code>10-district&lt;/code>, &lt;code>20-region&lt;/code>, etc.&lt;/td>
&lt;td>Yes.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>name_key&lt;/code>&lt;/td>
&lt;td>The translation key used for the title for the contact profile.&lt;/td>
&lt;td>No, defaults to &amp;lsquo;contact.profile&amp;rsquo;.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>group_key&lt;/code>&lt;/td>
&lt;td>The translation key used for the title of a list of contacts of this type.&lt;/td>
&lt;td>Yes.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>create_key&lt;/code>&lt;/td>
&lt;td>The translation key used on the button for creating new contacts of this type.&lt;/td>
&lt;td>Yes.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>edit_key&lt;/code>&lt;/td>
&lt;td>The translation key used on the button for editing contacts of this type.&lt;/td>
&lt;td>Yes.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>primary_contact_key&lt;/code>&lt;/td>
&lt;td>The translation key used to identify a person as the primary contact of contacts of this type.&lt;/td>
&lt;td>No, defaults to &amp;lsquo;Primary contact&amp;rsquo;.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>parents&lt;/code>&lt;/td>
&lt;td>An array of strings of IDs of parent types. If more than one then this type can appear in different places in the hierarchy. If more than one type lists the same type as a parent then a user will get a dropdown of places to create. If no parents then contacts of this type will be at the top of the hierarchy and cannot be added as a child of any contact.&lt;/td>
&lt;td>No, defaults to no parents.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>icon&lt;/code>&lt;/td>
&lt;td>The string ID for the icon to show beside contacts of this type.&lt;/td>
&lt;td>Yes.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>create_form&lt;/code>&lt;/td>
&lt;td>The string ID for the xform used to create contacts of this type.&lt;/td>
&lt;td>Yes.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>edit_form&lt;/code>&lt;/td>
&lt;td>The string ID for the xform used to edit contacts of this type.&lt;/td>
&lt;td>No, defaults to the create_form.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>count_visits&lt;/code>&lt;/td>
&lt;td>Whether or not to show a count of visits for contacts of this type. Requires UHC to be enabled.&lt;/td>
&lt;td>No, defaults to &lt;code>false&lt;/code>.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>person&lt;/code>&lt;/td>
&lt;td>Whether this is a person type or a place type.&lt;/td>
&lt;td>No, defaults to &lt;code>false&lt;/code>.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="forms">Forms&lt;/h3>
&lt;p>When creating contacts the type will be automatically assigned based on the button the user clicked. However if the form also creates sibling or child contacts these nested sections must specify a &lt;code>type&lt;/code> field with a hardcoded value of &amp;ldquo;contact&amp;rdquo; and a &lt;code>contact_type&lt;/code> field with the ID of the desired contact type.&lt;/p>
&lt;h3 id="changing-the-configuration">Changing the configuration&lt;/h3>
&lt;p>You can change any contact type configuration easily except for the IDs. To change the ID of a contact type in configuration of a project which already has contact data the contact docs will also have be updated to have a &lt;code>type&lt;/code> of &amp;ldquo;contact&amp;rdquo; and a &lt;code>contact_type&lt;/code> with the new ID of the contact type.&lt;/p>
&lt;h3 id="migration">Migration&lt;/h3>
&lt;p>If you already have person and place documents, switching from using the fixed hierarchy requires that you also update all the exisitng docs. Each contact and report holds the IDs of ancestors in their hierarchy so they will all need to be updated to be consistent with the changes you&amp;rsquo;ve made. You can use the medic-conf &lt;code>move-contacts&lt;/code> command to help with this migration.&lt;/p></description></item><item><title>Apps: .dhisDataSets</title><link>https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/dhis2/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/dhis2/</guid><description>
&lt;p>From 3.9.0 it is possible to integrate with DHIS2 by modifying the &lt;code>dhisDataSets&lt;/code> property in &lt;code>app_settings.json&lt;/code>.&lt;/p>
&lt;p>&lt;em>See Also:&lt;/em> &lt;a href=https://docs.communityhealthtoolkit.org/beta/apps/features/integrations/dhis2/#>DHIS2 Integration&lt;/a>&lt;/p>
&lt;h2 id="app_settingsjs-dhisdatasets">&lt;code>app_settings.js .dhisDataSets[]&lt;/code>&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Property&lt;/th>
&lt;th>Type&lt;/th>
&lt;th>Description&lt;/th>
&lt;th>Required&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>id&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>The data set id from DHIS2 with which to integrate&lt;/td>
&lt;td>Yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>translation_key&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>The translation key of the DHIS2 data set name to be displayed&lt;/td>
&lt;td>Yes&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="code-samples">Code samples&lt;/h2>
&lt;p>Configure the &lt;code>id&lt;/code> and &lt;code>translation_key&lt;/code> of the DHIS2 data set. The &lt;code>id&lt;/code> corresponds to the &lt;code>id&lt;/code> of the data set in the DHIS2 instance you want to integrate with. The &lt;code>translation_key&lt;/code> corresponds to the name of the DHIS2 data set as it appears in the dropdown in the App Management app.&lt;/p>
&lt;h3 id="app_settingsjs">&lt;code>app_settings.js&lt;/code>&lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#4e9a06">&amp;#34;dhisDataSets&amp;#34;&lt;/span>&lt;span style="color:#a40000">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;VMuFODsyWaO&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;translation_key&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;dhis.dataset.moh515&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">]&lt;/span>&lt;span style="color:#a40000">,&lt;/span>
&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Apps: .forms</title><link>https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/forms/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/forms/</guid><description>
&lt;p>JSON Forms are used for parsing reports from formatted SMS, SIM applications, and Medic Collect. JSON form definitions are also used for interoperability with third-party systems. Each form is defined as an JSON form object according to the following schema.&lt;/p>
&lt;h2 id="app_settingsjson-forms">&lt;code>app_settings.json .forms[]&lt;/code>&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>property&lt;/th>
&lt;th>type&lt;/th>
&lt;th>description&lt;/th>
&lt;th>required&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>meta&lt;/code>&lt;/td>
&lt;td>object&lt;/td>
&lt;td>Information about the report.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>meta.code&lt;/code>&lt;/td>
&lt;td>string&lt;/td>
&lt;td>The unique form identifier, which will be sent with all reports of this form. Must be the same as the form&amp;rsquo;s key.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>meta.icon&lt;/code>&lt;/td>
&lt;td>string&lt;/td>
&lt;td>Name of the icon resource shown in the app.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>meta.translation_key&lt;/code>&lt;/td>
&lt;td>string&lt;/td>
&lt;td>Name of the form shown in the app.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields&lt;/code>&lt;/td>
&lt;td>object&lt;/td>
&lt;td>Collection of field objects included in the form.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields.${field}&lt;/code>&lt;/td>
&lt;td>object&lt;/td>
&lt;td>Field that is part of the form.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields.${field}.type&lt;/code>&lt;/td>
&lt;td>string&lt;/td>
&lt;td>Data type of field:&lt;br> - &lt;code>&amp;quot;integer&amp;quot;&lt;/code>: a whole number&lt;br> - &lt;code>&amp;quot;string&amp;quot;&lt;/code>: any collection of characters&lt;br> - &lt;code>&amp;quot;date&amp;quot;&lt;/code>: a date in the format &lt;code>YYYY-mm-dd&lt;/code>, for example &amp;ldquo;2019-01-28&amp;quot;&lt;br> - &lt;code>&amp;quot;boolean&amp;quot;&lt;/code>: true or false, represented by the digit &lt;code>1&lt;/code> and &lt;code>0&lt;/code> respectively (native JSON booleans are also supported if sending via JSON)&lt;br> - &lt;code>&amp;quot;custom&amp;quot;&lt;/code>: Only possible for JSON forms that are passed as actual JSON (not an SMS that gets parsed into JSON). Effectively any non-specific data structure, which will be taken without validation.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields.${field}.labels&lt;/code>&lt;/td>
&lt;td>object&lt;/td>
&lt;td>&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields.${field}.labels.short&lt;/code>&lt;/td>
&lt;td>string, object with &lt;code>translation_key&lt;/code> field, or translation object&lt;/td>
&lt;td>Label shown for field in the app, seen when report is viewed in Reports tab. If missing, label will default to a translation key of &lt;code>report.${form_name}.${field_name}&lt;/code> (eg &lt;code>report.f.patient_id&lt;/code>) which can be translated in the app languages.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields.${field}.labels.tiny&lt;/code>&lt;/td>
&lt;td>string&lt;/td>
&lt;td>Unique identifier within the form for this field. Used in form submission to bind values to fields. Not required for all submission formats.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields.${field}.position&lt;/code>&lt;/td>
&lt;td>integer&lt;/td>
&lt;td>Zero based order of this field for incoming reports.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields.${field}.flags&lt;/code>&lt;/td>
&lt;td>object&lt;/td>
&lt;td>Additional instructions that could be used by form renderers. For instance &lt;code>{ &amp;quot;input_digits_only&amp;quot;: true }&lt;/code> indicated to SIM applications to show the number keyboard. Obsolete.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields.${field}.length&lt;/code>&lt;/td>
&lt;td>array with two integers&lt;/td>
&lt;td>Inclusive range accepted for length of the field.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields.${field}.required&lt;/code>&lt;/td>
&lt;td>boolean&lt;/td>
&lt;td>Determines if a report without this field is considered valid.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>public_form&lt;/code>&lt;/td>
&lt;td>boolean&lt;/td>
&lt;td>Determines if reports will be accepted from phone numbers not associated to a contact. Set to false if you want to reject reports from unknown senders. Default: true.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>facility_reference&lt;/code>&lt;/td>
&lt;td>string&lt;/td>
&lt;td>The form field whose value is to be used to match the incoming report to a contact&amp;rsquo;s &lt;code>rc_code&lt;/code>. Useful when reports are sent on behalf of a facility by unknown or various phone numbers. Requires the &lt;a href="transitions.md#available-transitions">&lt;code>update_clinics&lt;/code> transition&lt;/a>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="code-sample">Code Sample&lt;/h2>
&lt;p>The following form has two fields, one for the patient ID, another for notes.&lt;/p>
&lt;h3 id="app_settingsjson">&lt;code>app_settings.json&lt;/code>&lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json"> &lt;span style="color:#4e9a06">&amp;#34;forms&amp;#34;&lt;/span>&lt;span style="color:#a40000">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;F&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;meta&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;code&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;F&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;icon&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;risk&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;translation_key&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;form.flag.title&amp;#34;&lt;/span> &lt;span style="color:#a40000">//&lt;/span> &lt;span style="color:#a40000">displayed&lt;/span> &lt;span style="color:#a40000">in&lt;/span> &lt;span style="color:#a40000">the&lt;/span> &lt;span style="color:#a40000">webapp&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;fields&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;patient_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#a40000">//&lt;/span> &lt;span style="color:#a40000">this&lt;/span> &lt;span style="color:#a40000">is&lt;/span> &lt;span style="color:#a40000">used&lt;/span> &lt;span style="color:#a40000">for&lt;/span> &lt;span style="color:#a40000">the&lt;/span> &lt;span style="color:#a40000">property&lt;/span> &lt;span style="color:#a40000">name&lt;/span> &lt;span style="color:#a40000">when&lt;/span> &lt;span style="color:#a40000">the&lt;/span> &lt;span style="color:#a40000">report&lt;/span> &lt;span style="color:#a40000">doc&lt;/span> &lt;span style="color:#a40000">is&lt;/span> &lt;span style="color:#a40000">created&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;labels&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;short&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;translation_key&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;form.flag.patient_id.short&amp;#34;&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span> &lt;span style="color:#a40000">//&lt;/span> &lt;span style="color:#a40000">displayed&lt;/span> &lt;span style="color:#a40000">in&lt;/span> &lt;span style="color:#a40000">the&lt;/span> &lt;span style="color:#a40000">webapp&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;tiny&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;pid&amp;#34;&lt;/span> &lt;span style="color:#a40000">//&lt;/span> &lt;span style="color:#a40000">used&lt;/span> &lt;span style="color:#a40000">in&lt;/span> &lt;span style="color:#a40000">form&lt;/span> &lt;span style="color:#a40000">submission&lt;/span> &lt;span style="color:#a40000">to&lt;/span> &lt;span style="color:#a40000">bind&lt;/span> &lt;span style="color:#a40000">values&lt;/span> &lt;span style="color:#a40000">to&lt;/span> &lt;span style="color:#a40000">fields&lt;/span> &lt;span style="color:#a40000">-&lt;/span> &lt;span style="color:#a40000">not&lt;/span> &lt;span style="color:#a40000">required&lt;/span> &lt;span style="color:#a40000">for&lt;/span> &lt;span style="color:#a40000">all&lt;/span> &lt;span style="color:#a40000">submission&lt;/span> &lt;span style="color:#a40000">formats&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;position&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#a40000">//&lt;/span> &lt;span style="color:#a40000">specifies&lt;/span> &lt;span style="color:#a40000">where&lt;/span> &lt;span style="color:#a40000">in&lt;/span> &lt;span style="color:#a40000">the&lt;/span> &lt;span style="color:#a40000">SMS&lt;/span> &lt;span style="color:#a40000">this&lt;/span> &lt;span style="color:#a40000">value&lt;/span> &lt;span style="color:#a40000">should&lt;/span> &lt;span style="color:#a40000">be&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;string&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;length&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">5&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">13&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;required&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">true&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;notes&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;labels&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;short&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;translation_key&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;form.flag.notes.short&amp;#34;&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;tiny&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;form.flag.notes.tiny&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;position&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;string&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;length&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">100&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;required&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">false&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;public_form&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">true&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Apps: .outbound</title><link>https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/outbound/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/outbound/</guid><description>
&lt;p>&lt;em>Outbound is only available in Medic 3.5.0 and above&lt;/em>&lt;/p>
&lt;p>Outbound push allows configurers to have the creation or editing of CouchDB documents trigger outbound REST requests using the data in that document. For example, upon receiving a referral report you could send that referral to an external facility system that will manage and process that event.&lt;/p>
&lt;p>These triggers can apply to all document types (not just common types such as reports or contacts) and as such care should be taken to only send the documents you intend (see configuration of &lt;code>relevant_to&lt;/code> below).&lt;/p>
&lt;p>This feature is experimental, and may be replaced by some third party technology over time as we discover the feature-set we&amp;rsquo;re looking for.&lt;/p>
&lt;h2 id="configuration">Configuration&lt;/h2>
&lt;p>For outbound pushes to occur, you must &lt;a href="./transitions.md#Configurations">enable the &lt;code>mark_for_outbound&lt;/code> transition in config&lt;/a>:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;transitions&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;mark_for_outbound&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">true&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>The rest of the configuration is against the &lt;code>outbound&lt;/code> configuration property, which allows you to configure as many outbound pushes as you like, keyed off a unique name:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;outbound&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;first config&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;relevant_to&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;...&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;destination&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{},&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;mapping&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{}&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;second config&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Each outbound push configuration contains the following properties: &lt;code>relevant_to&lt;/code>, &lt;code>destination&lt;/code> and &lt;code>mapping&lt;/code>.&lt;/p>
&lt;h3 id="relevant_to">relevant_to&lt;/h3>
&lt;p>An &amp;ldquo;expression&amp;rdquo; (some JS code that resolves to a truthy or falsy value) that determines whether this configuration is relevant to a document. The document is passed to the expression as &lt;code>doc&lt;/code>, and if relevant is fully hydrated before being passed (i.e. the attached contact, its parents etc are fully attached instead of just being stubs).&lt;/p>
&lt;p>Example: you want to send a referral to a facility&amp;rsquo;s EMR system when a CHW refers a patient:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;relevant_to&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;doc.type === &amp;#39;data_record&amp;#39; &amp;amp;&amp;amp; doc.form === &amp;#39;referral&amp;#39;&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>Note:&lt;/strong> all documents that Sentinel processes can be picked up by your configuration, so it&amp;rsquo;s important to correctly configure &lt;code>relevant_to&lt;/code>. Checking the document type as shown above is probably a good start.&lt;/p>
&lt;h3 id="destination">destination&lt;/h3>
&lt;p>A complex property that defines the details of the connection to the external service. It currently supports several authentication types: basic authentication, HTTP authorization request header, and a custom authentication mode for Muso SIH.&lt;/p>
&lt;p>Basic auth example:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;destination&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;base_url&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;https://example.com&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;auth&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;basic&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;username&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;admin&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;password_key&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;example.com&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;path&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;/api/v1/referral&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Here &lt;code>password_key&lt;/code> is a key used to find the password in CouchDB&amp;rsquo;s node-based configuration. See Credentials section below.&lt;/p>
&lt;p>If you don&amp;rsquo;t provide an authentication parameter then the request will be sent without authentication.&lt;/p>
&lt;p>As of 3.9, the &lt;code>header&lt;/code> type is also supported, which sends authentication credentials via a HTTP request header: &lt;code>Authorization: '&amp;lt;value&amp;gt;'&lt;/code>. The value is set in the CouchDB configuration, and referred to by the &lt;code>value_key&lt;/code>, similarly to the &lt;code>password_key&lt;/code>. The value must match the credentials needed for the third party tool, and is generally formatted as &lt;code>&amp;lt;type&amp;gt; &amp;lt;credentials&amp;gt;&lt;/code>. For instance, to send data to RapidPro, the value in the configuration would be set to the complete RapidPro API Token: eg &lt;code>Token 123456789abcdef&lt;/code>.&lt;/p>
&lt;p>Header auth example:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;destination&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;base_url&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;https://example.com&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;auth&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;header&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;name&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;Authorization&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;value_key&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;example.com&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;path&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;/api/v1/referral&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="mapping">mapping&lt;/h3>
&lt;p>A complex property that declares how the payload to be sent to the &lt;code>destination&lt;/code> should be created.&lt;/p>
&lt;p>Each key is a string &lt;a href="https://github.com/mariocasciaro/object-path#usage">object path&lt;/a> to a location in the payload, and each value is either:&lt;/p>
&lt;ul>
&lt;li>a string object path to the location of the source data in the report being processed, where the value is required to exist&lt;/li>
&lt;li>an object with either a &lt;code>path&lt;/code> property that represents a string object path as above, or an &lt;code>expr&lt;/code> property which is an expression similar to &lt;code>relevant_to&lt;/code> to determine the resulting value. If you wish for the value to be optional (that is to say it&amp;rsquo;s OK if &lt;code>path&lt;/code> or &lt;code>expr&lt;/code> evaluate to &lt;code>undefined&lt;/code>) you may also set &lt;code>optional&lt;/code> to &lt;code>true&lt;/code>&lt;/li>
&lt;/ul>
&lt;h4 id="a-mapping-example">A mapping example&lt;/h4>
&lt;p>Given the following example (incomplete) report:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;abc-1234&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;data_record&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;form&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;referral&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;reported_date&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1555069530966&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;fields&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;patient_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;12345&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;patient_temp_deg_F&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">100&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;danger_signs&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;V&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;BL&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;D&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;IG&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;contact&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;def-5678&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;name&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;Jane CHW&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;parent&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;hij-9012&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;name&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;...&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>The following mapping configuration:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;mapping&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;patient_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;doc.fields.patient_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;chw_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;doc.contact._id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;event.temp_c&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;expr&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;((doc.fields.patient_temp_deg_F - 32) * (5.0/9.0)).toFixed(2)&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;event.in_danger&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;expr&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;doc.fields.danger_signs.length &amp;gt;= 3 ? true : undefined&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;optional&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">true&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;event.additional_notes&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;path&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;doc.fields.notes&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;optional&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">true&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Would create the following JSON payload to send:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;patient_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;12345&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;chw_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;def-5678&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;event&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;temp_c&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">37.78&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;in_danger&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">true&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>This example makes a few points:&lt;/p>
&lt;ul>
&lt;li>The report that is being used to generate the outbound push is referenced as &lt;code>doc&lt;/code> in both &lt;code>path&lt;/code> and &lt;code>expr&lt;/code> properties&lt;/li>
&lt;li>To define a property that is itself an object, you can make the mapping key a JSON path.&lt;/li>
&lt;li>If you define a property as &lt;code>optional&lt;/code>, it won&amp;rsquo;t exist at all in the payload if the resulting value is &lt;code>undefined&lt;/code>, either because that is the result of executing the &lt;code>expr&lt;/code>, or the &lt;code>path&lt;/code> doesn&amp;rsquo;t exist. Note that if the &lt;code>event.in_danger&lt;/code> expression was instead &lt;code>doc.fields.danger_signs.length &amp;gt;= 3&lt;/code> the property &lt;code>in_danger&lt;/code> would always exist and would either be &lt;code>true&lt;/code> or &lt;code>false&lt;/code>&lt;/li>
&lt;/ul>
&lt;h4 id="other-notes">Other Notes&lt;/h4>
&lt;ul>
&lt;li>Your report will be hydrated before being passed to the mapper. This gives you access to the contact and its parents&lt;/li>
&lt;li>object paths that may have undefined properties need to be dealt with differently depending on if you are using a &lt;code>path&lt;/code> or an &lt;code>expr&lt;/code>. Given &lt;code>doc.foo.bar.smang&lt;/code> as a path where any of those properties may not exist in the doc:&lt;/li>
&lt;li>If you&amp;rsquo;re using &lt;code>path&lt;/code> just use the path as is, if any part of the path is &lt;code>undefined&lt;/code> the resulting value will safely be &lt;code>undefined&lt;/code>&lt;/li>
&lt;li>However, in &lt;code>expr&lt;/code> you &lt;strong>do&lt;/strong> need to handle this situation: &lt;code>doc.foo &amp;amp;&amp;amp; doc.foo.bar &amp;amp;&amp;amp; doc.foo.bar.smang&lt;/code>&lt;/li>
&lt;li>If any of your &lt;code>expr&lt;/code> expressions throw an exception (for example because you didn&amp;rsquo;t handle potentially &lt;code>undefined&lt;/code> properties as noted above) your push will fail&lt;/li>
&lt;li>If any of your &lt;code>path&lt;/code> declarations result in an &lt;code>undefined&lt;/code> value and you have not also declared that property optional your push will fail&lt;/li>
&lt;/ul>
&lt;h2 id="credentials">Credentials&lt;/h2>
&lt;p>To securely store credentials, we&amp;rsquo;ll be using CouchDB&amp;rsquo;s &lt;a href="https://docs.couchdb.org/en/stable/api/server/configuration.html">config storage&lt;/a>, as this is a convenient location that only CouchDB administrators can access.&lt;/p>
&lt;p>Passwords are stored under the &lt;code>medic-credentials&lt;/code> section, under the key declared in config.&lt;/p>
&lt;p>In the following example:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;destination&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;base_url&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;https://example.com&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;auth&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;basic&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;username&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;admin&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;password_key&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;example.com&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;path&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;/api/v1/referral&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>We have our key configured to &lt;code>example.com&lt;/code>. This means that in CouchDB&amp;rsquo;s admin config we would expect to find a password at &lt;code>medic-credentials/example.com&lt;/code>.&lt;/p>
&lt;p>To add the credential to the admin config you need to either &lt;a href="https://docs.couchdb.org/en/stable/api/server/configuration.html#put--_node-node-name-_config-section-key">PUT the value using curl&lt;/a> or similar:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">curl -X PUT https://&amp;lt;user&amp;gt;:&amp;lt;pass&amp;gt;@&amp;lt;domain&amp;gt;/_node/couchdb@127.0.0.1/_config/medic-credentials/example.com -d &lt;span style="color:#4e9a06">&amp;#39;&amp;#34;the-real-password&amp;#34;&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;em>(Note that &lt;code>couchdb@127.0.0.1&lt;/code> is the local node name, and may be different for you depending on your setup.)&lt;/em>&lt;/p>
&lt;p>You can also add it via Fauxton:&lt;/p>
&lt;ul>
&lt;li>Navigate to &lt;a href="http://localhost:5984/_utils/#/_config">the Config screen&lt;/a>&lt;/li>
&lt;li>Click &lt;code>Add Option&lt;/code>&lt;/li>
&lt;li>The &lt;code>Section&lt;/code> should be &lt;code>medic-credentials&lt;/code>, the &lt;code>Name&lt;/code> should be (in this example) &lt;code>example.com&lt;/code> and the value should be the password&lt;/li>
&lt;li>Click &lt;code>Create&lt;/code>&lt;/li>
&lt;li>You should then be able to see your credential in the list of configuration shown\&lt;/li>
&lt;/ul>
&lt;h2 id="flow">Flow&lt;/h2>
&lt;p>Outbound pushes happen in two stages:&lt;/p>
&lt;ul>
&lt;li>Sentinel picks up the report and runs transitions over it. Any outbound configuration that is relevant (via executing the &lt;code>relevant_to&lt;/code> expression) will be added to a task queue&lt;/li>
&lt;li>Every 5 minutes sentinel will check its task queue. For each outbound push that is queued, sentinel will perform the mapping and attempt to send the resulting payload (via POST) to the configured web address
&lt;ul>
&lt;li>If the push succeeds it will be taken out of the task queue&lt;/li>
&lt;li>If the push fails (i.e. the response is not 2xx) it remains in the task queue, to be tried again in 5 minutes&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;h2 id="inbound">Inbound?&lt;/h2>
&lt;p>The outbound feature is used for sending data to an external service. If you are looking to &lt;strong>receive&lt;/strong> data from an external service, take a look at &lt;a href="https://github.com/medic/medic/tree/master/api#post-apiv2records">the records api&lt;/a>.&lt;/p></description></item><item><title>Apps: .patient_reports</title><link>https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/patient_reports/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/patient_reports/</guid><description>
&lt;p>The &lt;code>patient_reports&lt;/code> key contains the actions to take when reports about people are received.&lt;/p>
&lt;h2 id="app_settingsjson-patient_reports">&lt;code>app_settings.json .patient_reports[]&lt;/code>&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>property&lt;/th>
&lt;th>description&lt;/th>
&lt;th>required&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>form&lt;/code>&lt;/td>
&lt;td>Form ID of the patient form.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>name&lt;/code>&lt;/td>
&lt;td>Descriptive name of the form. This is not currently used in the app, but can be a helpful annotation.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>format&lt;/code>&lt;/td>
&lt;td>Guide of how the form can be used. This is not currently used in the app, but can be a helpful annotation.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>silence_type&lt;/code>&lt;/td>
&lt;td>A comma separated list of schedules to mute.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>silence_for&lt;/code>&lt;/td>
&lt;td>Duration from when the report was submitted for which messages should be muted. It is structured as a string with an integer value followed by a space and the time unit. For instance &lt;code>8 weeks&lt;/code> or &lt;code>2 days&lt;/code>. The units available are &lt;code>seconds&lt;/code>, &lt;code>minutes&lt;/code>, &lt;code>hours&lt;/code>, &lt;code>days&lt;/code>, &lt;code>weeks&lt;/code>, &lt;code>months&lt;/code>, &lt;code>years&lt;/code>, and their singular forms as well. When a message is muted all messages belonging to the same group will be muted, even if it falls outside of this time period. See &lt;code>messages[].group&lt;/code> in &lt;em>Schedules&lt;/em> for related info.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields&lt;/code>&lt;/td>
&lt;td>Descriptive list of form fields. This is not currently used in the app, but can be a helpful annotation.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>validations&lt;/code>&lt;/td>
&lt;td>A set of validations to perform on incoming reports. More information about validation rules can be found &lt;a href="app-settings-validations.md">here&lt;/a>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>validations.join_responses&lt;/code>&lt;/td>
&lt;td>A boolean specifying whether validation messages should be combined into one message.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>validations.list[]&lt;/code>&lt;/td>
&lt;td>An array of validation rules a report should pass to be considered valid.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>validations.list[].property&lt;/code>&lt;/td>
&lt;td>Report field for which this validation rule will be applied.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>validations.list[].rule&lt;/code>&lt;/td>
&lt;td>Validation condition to be applied to the property field. More information about rules can be found &lt;a href="app-settings-validations.md#rules">here&lt;/a>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>validations.list[].translation_key&lt;/code>&lt;/td>
&lt;td>Translation key for the message reply to be sent if a report fails this rule.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messages&lt;/code>&lt;/td>
&lt;td>An array of automated responses to incoming reports.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messages[].translation_key&lt;/code>&lt;/td>
&lt;td>Translation key for the message text associated with this event&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messages[].event_type&lt;/code>&lt;/td>
&lt;td>An event that will trigger sending of this message. Typical values are: &lt;code>report_accepted&lt;/code> when the report has been successfully validated, &lt;code>registration_not_found&lt;/code> when the patient ID supplied in the report doesn&amp;rsquo;t match any patient ID issued by Medic. &lt;code>on_mute&lt;/code> and &lt;code>on_unmute&lt;/code> are used in the context of muting as described &lt;a href="transitions.md#muting">here&lt;/a>&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messages[].recipient&lt;/code>&lt;/td>
&lt;td>Who the message should be sent to. Use &lt;code>reporting_unit&lt;/code> for the sender of the report, &lt;code>clinic&lt;/code> for clinic contact, and &lt;code>parent&lt;/code> for the parent contact.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="code-sample">Code sample&lt;/h2>
&lt;p>This sample shows a &lt;code>V&lt;/code> report clearing schedules that have messages within 8 days of the report being received. The sample also defines the response messages if the report is accepted or if the patient is not found.&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json"> &lt;span style="color:#4e9a06">&amp;#34;patient_reports&amp;#34;&lt;/span>&lt;span style="color:#a40000">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;form&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;V&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;name&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;Visit (SMS)&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;format&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;V &amp;lt;patientid&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;silence_type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;ANC Reminders, ANC Reminders LMP, ANC Reminders LMP from App&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;silence_for&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;8 days&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;fields&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;field_name&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;title&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;validations&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;join_responses&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">true&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;list&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;property&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;patient_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;rule&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;regex(&amp;#39;^[0-9]{5,13}$&amp;#39;)&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;translation_key&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;messages.generic.validation.patient_id&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;messages&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;translation_key&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;messages.v.report_accepted&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;event_type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;report_accepted&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;recipient&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;reporting_unit&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;translation_key&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;messages.generic.registration_not_found&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;event_type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;registration_not_found&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;recipient&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;reporting_unit&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;!-- TODO
## Case Reports
### `app_settings.json .case_reports[]`
--></description></item><item><title>Apps: .permissions</title><link>https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/user-permissions/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/user-permissions/</guid><description>
&lt;h3 id="app_settingsjson-permissions">&lt;code>app_settings.json .permissions{}&lt;/code>&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Property&lt;/th>
&lt;th>Description&lt;/th>
&lt;th>Default&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>placeholder&lt;/code>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table></description></item><item><title>Apps: .registrations</title><link>https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/registrations/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/registrations/</guid><description>
&lt;p>The &lt;code>registrations&lt;/code> key contains actions that need to be performed for incoming reports of the specified form.&lt;/p>
&lt;h2 id="app_settingsjson-registrations">&lt;code>app_settings.json .registrations[]&lt;/code>&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>property&lt;/th>
&lt;th>description&lt;/th>
&lt;th>required&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>form&lt;/code>&lt;/td>
&lt;td>Form ID that should trigger the schedule.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>events&lt;/code>&lt;/td>
&lt;td>An array of event object definitions of what should happen when this form is received.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>event[].name&lt;/code>&lt;/td>
&lt;td>Name of the event that has happened. The only supported event is &lt;code>on_create&lt;/code> which happens when a form is received.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>event[].trigger&lt;/code>&lt;/td>
&lt;td>What should happen after the named event. &lt;code>assign_schedule&lt;/code> will assign the schedule named in &lt;code>params&lt;/code> to this report. Similarly &lt;code>clear_schedule&lt;/code> will permanently clear all messages for a patient that are part of schedules listed in the &lt;code>params&lt;/code> field. The full set of trigger configuration directives are described &lt;a href="https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/transitions/#triggers">here&lt;/a>.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>event[].params&lt;/code>&lt;/td>
&lt;td>Any useful information for the event. In our case, it holds the name of the schedule to be triggered.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>event[].bool_expr&lt;/code>&lt;/td>
&lt;td>A JavaScript expression that will be cast to boolean to qualify execution of the event. Leaving blank will default to always true. CouchDB document fields can be accessed using &lt;code>doc.key.subkey&lt;/code>. Regular expressions can be tested using &lt;code>pattern.test(value)&lt;/code> e.g. /^[0-9]+$/.test(doc.fields.last_menstrual_period). In our example above, we&amp;rsquo;re making sure the form has an LMP date.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>validations&lt;/code>&lt;/td>
&lt;td>A set of validations to perform on incoming reports. More information about validation rules can be found &lt;a href="app-settings-validations.md">here&lt;/a>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>validations.join_responses&lt;/code>&lt;/td>
&lt;td>A boolean specifying whether validation messages should be combined into one message.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>validations.list[]&lt;/code>&lt;/td>
&lt;td>An array of validation rules a report should pass to be considered valid.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>validations.list[].property&lt;/code>&lt;/td>
&lt;td>Report field for which this validation rule will be applied.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>validations.list[].rule&lt;/code>&lt;/td>
&lt;td>Validation condition to be applied to the property field. More information about rules can be found &lt;a href="app-settings-validations.md#rules">here&lt;/a>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>validations.list[].translation_key&lt;/code>&lt;/td>
&lt;td>Translation key for the message reply to be sent if a report fails this rule.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messages&lt;/code>&lt;/td>
&lt;td>An array of automated responses to incoming reports.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messages[].translation_key&lt;/code>&lt;/td>
&lt;td>Translation key for the message text associated with this event.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messages[].event_type&lt;/code>&lt;/td>
&lt;td>An event that will trigger sending of this message. Typical values are: &lt;code>report_accepted&lt;/code> when the report has been successfully validated and &lt;code>registration_not_found&lt;/code> when the patient ID supplied in the report doesn&amp;rsquo;t match any patient ID issued by Medic.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messages[].recipient&lt;/code>&lt;/td>
&lt;td>Who the message should be sent to. Use &lt;code>reporting_unit&lt;/code> for the sender of the report, &lt;code>clinic&lt;/code> for clinic contact, and &lt;code>parent&lt;/code> for the parent contact.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="code-sample">Code sample&lt;/h2>
&lt;p>This sample shows how a schedule would be triggered by a &lt;code>pregnancy&lt;/code> report if the &lt;code>last_mentrual_period&lt;/code> value is set.&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">
&lt;span style="color:#4e9a06">&amp;#34;registrations&amp;#34;&lt;/span>&lt;span style="color:#a40000">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;form&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;pregnancy&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;events&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;name&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;on_create&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;trigger&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;assign_schedule&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;params&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;ANC Visit Reminders&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;bool_expr&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;doc.fields.last_menstrual_period&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;validations&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{},&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;messages&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[]&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Apps: .replications</title><link>https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/replication/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/replication/</guid><description>
&lt;p>Replications are defined under the &lt;code>replications&lt;/code> key as an array of replication objects.&lt;/p>
&lt;h2 id="app_settingsjson-replications">&lt;code>app_settings.json .replications&lt;/code>&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>property&lt;/th>
&lt;th>description&lt;/th>
&lt;th>required&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>fromSuffix&lt;/code>&lt;/td>
&lt;td>The suffix of the source table(s). Regular expression may be used.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>toSuffix&lt;/code>&lt;/td>
&lt;td>The suffix of the target table.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>text_expression&lt;/code>&lt;/td>
&lt;td>Any valid text expression. For more information, see &lt;a href="https://bunkat.github.io/later/parsers.html#text">LaterJS&lt;/a>&lt;/td>
&lt;td>no if &lt;code>cron&lt;/code> provided&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>cron&lt;/code>&lt;/td>
&lt;td>Any valid Cron expression. For more information, see &lt;a href="https://bunkat.github.io/later/parsers.html#cron">LaterJS&lt;/a>&lt;/td>
&lt;td>no if &lt;code>text_expression&lt;/code> provided&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="code-sample">Code sample&lt;/h2>
&lt;p>The definition takes the typical form below:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#4e9a06">&amp;#34;replications&amp;#34;&lt;/span>&lt;span style="color:#a40000">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;fromSuffix&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;user-[^\\-]+-meta&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;toSuffix&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;users-meta&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;text_expression&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;cron&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;0 2 * * *&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Apps: .roles</title><link>https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/user-roles/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/user-roles/</guid><description>
&lt;p>Each user is assigned one of the defined roles. Roles can be defined using the App Management app, which is represented by the &lt;code>roles&lt;/code> object of the &lt;code>app-settings.json&lt;/code> file. Each role is defined by an identifier as the key, and an object with the following properties:&lt;/p>
&lt;h3 id="app_settingsjson-roles">&lt;code>app_settings.json .roles{}&lt;/code>&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Property&lt;/th>
&lt;th>Description&lt;/th>
&lt;th>Required&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>name&lt;/code>&lt;/td>
&lt;td>The translation key for this role&lt;/td>
&lt;td>Yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>offline&lt;/code>&lt;/td>
&lt;td>Determines if user will be an online or offline user. Set to &lt;code>false&lt;/code> for users to be &amp;ldquo;online&amp;rdquo; users.&lt;/td>
&lt;td>No, default &lt;code>true&lt;/code>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table></description></item><item><title>Apps: .schedules</title><link>https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/schedules/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/schedules/</guid><description>
&lt;p>The &lt;code>schedules&lt;/code> key contains an array of schedule objects, each representing the messages to send based on a registration.&lt;/p>
&lt;h2 id="app_settingsjson-schedules">&lt;code>app_settings.json .schedules[]&lt;/code>&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>property&lt;/th>
&lt;th>description&lt;/th>
&lt;th>required&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>name&lt;/code>&lt;/td>
&lt;td>A unique string label that is used to identify the schedule. Spaces are allowed.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>summary&lt;/code>&lt;/td>
&lt;td>Short description of the of the schedule.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>description&lt;/code>&lt;/td>
&lt;td>A narrative for the schedule.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>start_from&lt;/code>&lt;/td>
&lt;td>The base date from which the &lt;code>messages[].offset&lt;/code> is added to determine when to send individual messages. You could specify any property on the report that contains a date value. The default is &lt;code>reported_date&lt;/code>, which is when the report was submitted.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>start_mid_group&lt;/code>&lt;/td>
&lt;td>Whether or not a schedule can start mid-group. If not present, the schedule will not start mid-group. In other terms, the default value is &lt;code>false&lt;/code>&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messages&lt;/code>&lt;/td>
&lt;td>Array of objects, each containing a message to send out and its properties.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messages[].translation_key&lt;/code>&lt;/td>
&lt;td>The translation key of the message to send out. Available in 2.15+.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messages[].messages&lt;/code>&lt;/td>
&lt;td>Array of message objects, each with &lt;code>content&lt;/code> and &lt;code>locale&lt;/code> properties. From 2.15 on use &lt;code>translation_key&lt;/code> instead.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messages[].group&lt;/code>&lt;/td>
&lt;td>Integer identifier to group messages that belong together so that they can be cleared together as a group by future reports. For instance a series of messages announcing a visit, and following up for a missed visit could be grouped together and cleared by a single visit report.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messages[].offset&lt;/code>&lt;/td>
&lt;td>Time interval from the &lt;code>start_from&lt;/code> date for when the message should be sent. It is structured as a string with an integer value followed by a space and the time unit. For instance &lt;code>8 weeks&lt;/code> or &lt;code>2 days&lt;/code>. The units available are &lt;code>seconds&lt;/code>, &lt;code>minutes&lt;/code>, &lt;code>hours&lt;/code>, &lt;code>days&lt;/code>, &lt;code>weeks&lt;/code>, &lt;code>months&lt;/code>, &lt;code>years&lt;/code>, and their singular forms as well. Note that although you can specify &lt;code>seconds&lt;/code>, the accuracy of the sending time will be determined by delays in the processing the message on the server and on the gateway.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messages[].send_day&lt;/code>&lt;/td>
&lt;td>String value of the day of the week on which the message should be sent. For instance, to send a message at the beginning of the week setting it to &lt;code>&amp;quot;Monday&amp;quot;&lt;/code> will make sure the message goes out on the closest Monday &lt;em>after&lt;/em> the &lt;code>start_date&lt;/code> + &lt;code>offset&lt;/code>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messages[].send_time&lt;/code>&lt;/td>
&lt;td>Time of day that the message should be sent in 24 hour format.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messages[].recipient&lt;/code>&lt;/td>
&lt;td>Recipient of the message. It can be set to &lt;code>reporting_unit&lt;/code> (sender of the form), &lt;code>clinic&lt;/code> (clinic that the sender of the form is attached to), &lt;code>parent&lt;/code> (parent of the sender of the form), or a specific phone number.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="code-sample">Code Sample&lt;/h2>
&lt;p>This sample shows a schedule with a single message, which will be sent on Monday 9am 4 weeks after the LMP date on the report that triggers this schedule:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json"> &lt;span style="color:#4e9a06">&amp;#34;schedules&amp;#34;&lt;/span>&lt;span style="color:#a40000">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;name&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;ANC Visit Reminders&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;summary&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;description&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;start_from&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;lmp_date&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;start_mid_group&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">true&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;messages&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;translation_key&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;messages.schedule.registration.followup_anc_pnc&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;group&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;offset&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;4 weeks&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;send_day&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;monday&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;send_time&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;09:00&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;recipient&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;reporting_unit&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Apps: .sms</title><link>https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/sms/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/sms/</guid><description>
&lt;p>SMS settings are defined under the &lt;code>sms&lt;/code> key, as an object supporting the following properties:&lt;/p>
&lt;h2 id="app_settingsjson-sms">&lt;code>app_settings.json .sms&lt;/code>&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>property&lt;/th>
&lt;th>default&lt;/th>
&lt;th>description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>outgoing_service&lt;/td>
&lt;td>medic-gateway&lt;/td>
&lt;td>Defines the service to use to send SMS messages. Currently supports &amp;ldquo;medic-gateway&amp;rdquo; and &amp;ldquo;africas-talking&amp;rdquo;. Read more about &amp;ldquo;africas-talking&amp;rdquo; configuration &lt;a href="../../guides/africas-talking">here&lt;/a>.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>duplicate_limit&lt;/td>
&lt;td>5&lt;/td>
&lt;td>The number of identical sms message allowed to be sent to the same recipient.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="code-sample">Code sample&lt;/h2>
&lt;p>The definition takes the typical form below:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#4e9a06">&amp;#34;sms&amp;#34;&lt;/span>&lt;span style="color:#a40000">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;outgoing_service&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;medic-gateway&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;duplicate_limit&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;2&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="duplicate-sms-messages-handling">Duplicate SMS messages handling&lt;/h4>
&lt;p>Every time a service (API or Sentinel) creates an SMS, we cache the recipient, and the message content, along with the current timestamp.
When more than &lt;code>duplicate_limit&lt;/code> messages have been created for the same pair of recipient+content, within the cache time limit, we mark the new message with a &amp;ldquo;duplicate&amp;rdquo; status. Such messages are never sent.
The cache is cleared 30 minutes after the last SMS message for a specific pair was generated.&lt;/p></description></item><item><title>Apps: .transitions</title><link>https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/transitions/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/transitions/</guid><description>
&lt;p>When sentinel detects a document has changed it runs transitions against the doc. These transitions can be used to generate a short form patient id or assign a report to a facility.&lt;/p>
&lt;h2 id="configuration">Configuration&lt;/h2>
&lt;p>By default all transitions are disabled. They can be enabled by configuring the &lt;code>transitions&lt;/code> property to have a key with the transitions name and a &lt;code>truthy&lt;/code> value, eg:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;transitions&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;a&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;b&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">true&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;c&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;disable&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">false&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;d&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#204a87;font-weight:bold">&amp;#34;disable&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">true&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>In this example the &lt;code>d&lt;/code> transition will not be applied, but the other three will be.&lt;/p>
&lt;h2 id="available-transitions">Available transitions&lt;/h2>
&lt;p>The following transitions are available and executed in order.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Key&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>maintain_info_document&lt;/td>
&lt;td>Records metadata about the document such as when it was replicated. Enabled by default.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>update_clinics&lt;/td>
&lt;td>Adds a contact&amp;rsquo;s info to a new data record. This is used to attribute an incoming SMS message or report to the appropriate contact. The &lt;code>rc_code&lt;/code> value on the contact is used to match to the value of the form field set as the &lt;code>facility_reference&lt;/code> in the &lt;a href="https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/forms/#app_settingsjson-forms">JSON form definition&lt;/a>. This matching is useful when reports are sent on behalf of a facility by unknown or various phone numbers. If &lt;code>facility_reference&lt;/code> is not set for a form, the contact match is attempted using the sender&amp;rsquo;s phone number.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="#registration">registration&lt;/a>&lt;/td>
&lt;td>For registering a patient to a schedule. Performs some validation and creates the patient document if the patient does not already exist. Can create places (as of 3.8.x).&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>accept_patient_reports&lt;/td>
&lt;td>Validates reports about a patient and silences relevant reminders.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="#generate-shortcode-on-contacts">generate_shortcode_on_contacts&lt;/a>&lt;/td>
&lt;td>Automatically generates the &lt;code>patient_id&lt;/code> on all person documents and the &lt;code>place_id&lt;/code> on all place documents. Available since 3.8.x.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="#generate-patient-id-on-people">generate_patient_id_on_people&lt;/a>&lt;/td>
&lt;td>&lt;strong>Deprecated in 3.8.x&lt;/strong> Automatically generates the &lt;code>patient_id&lt;/code> on all person documents. As of 3.8.x, also generates the &lt;code>place_id&lt;/code> on all place documents and is an alias for &lt;code>generate_shortcode_on_contacts&lt;/code>.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>default_responses&lt;/td>
&lt;td>Responds to the message with a confirmation or validation error.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>update_sent_by&lt;/td>
&lt;td>Sets the sent_by field of the report based on the sender&amp;rsquo;s phone number.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>update_sent_forms&lt;/td>
&lt;td>&lt;strong>Deprecated in 3.7.x&lt;/strong> Update sent_forms property on facilities so we can setup reminders for specific forms. &lt;em>As of 3.7.x, reminders no longer require this transition&lt;/em>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="#death_reporting">death_reporting&lt;/a>&lt;/td>
&lt;td>Updates the deceased status of patients.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>conditional_alerts&lt;/td>
&lt;td>Executes the configured condition and sends an alert if the condition is met.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="#multi_report_alerts">multi_report_alerts&lt;/a>&lt;/td>
&lt;td>Similar to conditional_alerts, with more flexible configuration, including using different form types for the same alert.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="#update_notifications">update_notifications&lt;/a>&lt;/td>
&lt;td>&lt;strong>Deprecated in 3.2.x&lt;/strong> Mutes or unmutes scheduled messages based on configuration.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>update_scheduled_reports&lt;/td>
&lt;td>If a report has a month/week/week_number, year and clinic then look for duplicates and update those instead.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>resolve_pending&lt;/td>
&lt;td>Sets the state of pending messages to sent. It is useful during builds where we don&amp;rsquo;t want any outgoing messages queued for sending.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="#muting">muting&lt;/a>&lt;/td>
&lt;td>Implements muting/unmuting actions of people and places. Available since 3.2.x.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="./outbound.md">mark_for_outbound&lt;/a>&lt;/td>
&lt;td>Enables outbound pushes. Available since 3.5.x&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;a href="#self_report">self_report&lt;/a>&lt;/td>
&lt;td>Maps patient to sender. Available since 3.9.x&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="transition-configuration-guide">Transition Configuration Guide&lt;/h2>
&lt;p>Guides for how to setup specific transitions.&lt;/p>
&lt;h3 id="multi_report_alerts">multi_report_alerts&lt;/h3>
&lt;p>Send alert messages by SMS when specific conditions are received through reports. More flexible than simple Alerts.&lt;/p>
&lt;p>Example: send SMS to the district manager when 2 CHWs within the same district report cholera or diarrhea symptoms within the last week.&lt;/p>
&lt;p>Understanding the different types of reports used in the configuration:&lt;/p>
&lt;pre>&lt;code> previous suspected_cholera alert was sent
|
| latest_report comes in, suspected_cholera alert is sent
| |
v v
---[---*-o---*--*--o-o---*]-------&amp;gt; time
1 0
&lt;/code>&lt;/pre>&lt;p>&lt;code>[]&lt;/code> : time window&lt;/p>
&lt;p>&lt;code>*&lt;/code> and &lt;code>o&lt;/code> : &lt;code>reports&lt;/code> : any report that came in to the server.&lt;/p>
&lt;p>&lt;code>*&lt;/code> : &lt;code>counted_reports&lt;/code> : reports that came in that passed the &lt;code>is_report_counted&lt;/code> filter function.&lt;/p>
&lt;p>&lt;code>0&lt;/code>, &lt;code>1&lt;/code> : &lt;code>new_reports&lt;/code> : &lt;code>counted_reports&lt;/code> that came in since the previous alert was sent. They haven&amp;rsquo;t been messaged about yet.&lt;/p>
&lt;h4 id="configuration-1">Configuration&lt;/h4>
&lt;pre>&lt;code>&amp;quot;multi_report_alerts&amp;quot; : [
{
&amp;quot;name&amp;quot;: &amp;quot;suspected_cholera&amp;quot;,
&amp;quot;is_report_counted&amp;quot;: &amp;quot;function(report, latest_report) { return latest_report.contact.parent.parent._id === report.contact.parent.parent._id; }&amp;quot;,
&amp;quot;num_reports_threshold&amp;quot;: 2,
&amp;quot;message&amp;quot;: &amp;quot;{{num_counted_reports}} patients with {{alert_name}} in {{time_window_in_days}} days reported at {{new_reports.0.contact.parent.name}}. New reports from: {{new_reports.0.contact.name}}, {{new_reports.1.contact.name}}, {{new_reports.2.contact.name}}.&amp;quot;,
&amp;quot;recipients&amp;quot;: [
&amp;quot;+123456&amp;quot;,
&amp;quot;new_report.contact.phone&amp;quot;, // sender of each report in new_reports
&amp;quot;new_report.contact.parent.parent.contact.phone&amp;quot;, // contact person for the parent place of the sender of each report in new_reports.
// If it's the same for several reports, only one message will be sent (recipient phone numbers are deduplicated before generating messages).
],
&amp;quot;time_window_in_days&amp;quot;: 7,
&amp;quot;forms&amp;quot;: [&amp;quot;C&amp;quot;, &amp;quot;D&amp;quot;] // Only Cholera and Diarrhea forms.
}
]
&lt;/code>&lt;/pre>&lt;p>Note that we are using Mustache templates for our message templates (anything with &lt;code>{{}}&lt;/code>), and they use a &lt;code>.&lt;/code> notation to access items in an array (e.g. &lt;code>new_reports.1&lt;/code>) rather than a &lt;code>[]&lt;/code> notation as in conventional javascript (&lt;code>new_reports[1]&lt;/code>).&lt;/p>
&lt;p>For performance reasons the &lt;code>num_reports_threshold&lt;/code> cannot exceed 100.&lt;/p>
&lt;h3 id="death_reporting">death_reporting&lt;/h3>
&lt;p>Updates patient documents with a &lt;code>date_of_death&lt;/code> field which updates how the patient is displayed in the UI.&lt;/p>
&lt;h4 id="configuration-2">Configuration&lt;/h4>
&lt;p>Configuration is stored in the &lt;code>death_reporting&lt;/code> field of the settings.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Property&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>mark_deceased_forms&lt;/code>&lt;/td>
&lt;td>An array of form codes which will cause patients to be recorded as deceased.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>undo_deceased_forms&lt;/code>&lt;/td>
&lt;td>An array of form codes which will remove the deceased date from the patient. Optional.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>date_field&lt;/code>&lt;/td>
&lt;td>The path to the field in the report document which has the date the patient died. Optional: if not configured it defaults to the reported_date of the report.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h5 id="example">Example&lt;/h5>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#4e9a06">&amp;#34;death_reporting&amp;#34;&lt;/span>&lt;span style="color:#a40000">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;mark_deceased_forms&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;death&amp;#34;&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;undo_deceased_forms&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;undo-death&amp;#34;&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;date_field&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;fields.death_date&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="registration">Registration&lt;/h3>
&lt;p>Configuration is held at &lt;code>app_settings.registrations&lt;/code>, as a list of objects connecting forms to validations, events and messages.&lt;/p>
&lt;h4 id="events">Events&lt;/h4>
&lt;p>Lists different events.&lt;/p>
&lt;h5 id="on_create">&lt;code>on_create&lt;/code>&lt;/h5>
&lt;p>This is the only supported event.&lt;/p>
&lt;h4 id="triggers">Triggers&lt;/h4>
&lt;h5 id="add_patient">&lt;code>add_patient&lt;/code>&lt;/h5>
&lt;p>Sets the &lt;code>patient_id&lt;/code> on the root of the registration document and creates the person doc if required. Can be configured to either use a provided ID or generate a new unique one.&lt;/p>
&lt;h6 id="external-patient-id">External Patient ID&lt;/h6>
&lt;p>If you are providing the patient id instead of having Sentinel generate you one, name the field in a &lt;code>patient_id_field&lt;/code> key in &lt;code>&amp;quot;params&amp;quot;&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;name&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;on_create&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;trigger&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;add_patient&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;params&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;{\&amp;#34;patient_id_field\&amp;#34;: \&amp;#34;external_id\&amp;#34;}&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;bool_expr&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>In this example the provided id would be in &lt;code>fields.external_id&lt;/code> on the registration document.&lt;/p>
&lt;p>&lt;strong>NB:&lt;/strong> this field must not be called &lt;code>patient_id&lt;/code>.
&lt;strong>NB:&lt;/strong> the JSON passed in &lt;code>&amp;quot;params&amp;quot;&lt;/code> should still be a string. Support for raw JSON as shown below exists, but is in beta and may not always work correctly in all situations, because kanso.json does not support it:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;params&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>&lt;span style="color:#204a87;font-weight:bold">&amp;#34;patient_id_field&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;external_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="alternative-name-location">Alternative Name Location&lt;/h6>
&lt;p>To provide an alternative location for the patient name, either provide a &lt;code>patient_name_field&lt;/code> in &lt;code>&amp;quot;params&amp;quot;&lt;/code> or provide it directly into the &lt;code>&amp;quot;params&amp;quot;&lt;/code> field as a String:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;params&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;{\&amp;#34;patient_name_field\&amp;#34;: \&amp;#34;full_name\&amp;#34;}&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;params&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;full_name&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>The first format is required if you wish to also provide other params:&lt;/p>
&lt;h6 id="contact-type">Contact Type&lt;/h6>
&lt;p>If you have changed from the default contact hierarchy you will need to specify which type of contact the registration should create.&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;params&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;{ \&amp;#34;contact_type\&amp;#34;: \&amp;#34;patient\&amp;#34; }&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="specific-parent-as-of-380">Specific Parent &lt;em>as of 3.8.0&lt;/em>&lt;/h6>
&lt;p>By default, the newly created person will have the same parent as the report submitter.
A different parent may be selected by providing a location for the parent id. This field should
contain the &lt;code>place_id&lt;/code> of the place in question.
If the selected parent is invalid - does not exist or does not respect the configured hierarchy&lt;/p>
&lt;ul>
&lt;li>the report is rejected as invalid and the person document is not created. As such
, &lt;code>report_accepted&lt;/code> event should check if the report has a &lt;code>patient&lt;/code> property (or similar).&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json"> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;params&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;{ \&amp;#34;parent_id\&amp;#34;: \&amp;#34;parent_id\&amp;#34; }&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="events-1">Events&lt;/h6>
&lt;ul>
&lt;li>&lt;code>parent_field_not_provided&lt;/code> - triggered when the report does not have the required parent_id field&lt;/li>
&lt;li>&lt;code>parent_invalid&lt;/code> - triggered when selected parent is invalid (parent document is found and
either does not have a configured type or its type is not configured to be a parent to the
person type to be created)&lt;/li>
&lt;li>&lt;code>parent_not_found&lt;/code> - triggered when selected parent is not found&lt;/li>
&lt;/ul>
&lt;p>The selected parent (if found) can be accessed by using the &lt;code>parent&lt;/code> path in error messages:
&lt;code>Cannot create a person type &amp;quot;patient&amp;quot; under parent {{parent.place_id}}({{parent.contact_type}})&lt;/code>&lt;/p>
&lt;h5 id="add_patient_id">&lt;code>add_patient_id&lt;/code>&lt;/h5>
&lt;p>&lt;strong>Deprecated in favour of &lt;code>add_patient&lt;/code>.&lt;/strong> Previously this only added a &lt;code>patient_id&lt;/code> to the root of the registration form. This functionality has been merged into &lt;code>add_patient&lt;/code>. Now, using this event will result in the same functionality as described in &lt;code>add_patient&lt;/code> above.&lt;/p>
&lt;h5 id="add_expected_date">&lt;code>add_expected_date&lt;/code>&lt;/h5>
&lt;h5 id="add_birth_date">&lt;code>add_birth_date&lt;/code>&lt;/h5>
&lt;h5 id="assign_schedule">&lt;code>assign_schedule&lt;/code>&lt;/h5>
&lt;h5 id="clear_schedule">&lt;code>clear_schedule&lt;/code>&lt;/h5>
&lt;h5 id="add_place-as-of-380">&lt;code>add_place&lt;/code> &lt;em>as of 3.8.0&lt;/em>&lt;/h5>
&lt;p>Sets the &lt;code>place_id&lt;/code> on the root of the registration document and creates the place doc with the
provided type.&lt;/p>
&lt;p>By default, the created place would have the same parent as the submitter. If such a combination is
invalid - for example a contact under a &amp;ldquo;clinic&amp;rdquo; attempts to create a new &amp;ldquo;health_center&amp;rdquo; - the
report will be rejected as errored and the place document will not be created. As such,
&lt;code>report_accepted&lt;/code> event should check if the report has a &lt;code>place&lt;/code> property (or similar).&lt;/p>
&lt;p>The created place does not have a primary contact.
The created place can be accessed by the &lt;code>place&lt;/code> path in messages:
&lt;code>Place {{place.name}}({{place.place_id}}) added to {{place.parent.name}}({{place.parent.place_id}})&lt;/code>&lt;/p>
&lt;h6 id="contact-type-1">Contact Type&lt;/h6>
&lt;p>Specifying the contact type is required, even if not using configurable hierarchies.
The selected contact type must be a configured place type.&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;params&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;{ \&amp;#34;contact_type\&amp;#34;: \&amp;#34;clinic\&amp;#34; }&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="specific-parent">Specific Parent&lt;/h6>
&lt;p>By default, the newly created place will have the same parent as the report submitter.
A different parent may be selected by providing a location for the parent id. This field should
contain the &lt;code>place_id&lt;/code> of the place in question.
If the selected parent is invalid - does not exist or is not an acceptable parent to the
selected type in the configured hierarchy - the report will be rejected as errored.&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json"> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;params&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;{ \&amp;#34;parent_id\&amp;#34;: \&amp;#34;parent_id\&amp;#34; }&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h6 id="events-2">Events&lt;/h6>
&lt;ul>
&lt;li>&lt;code>parent_field_not_provided&lt;/code> - triggered when the report does not have the required parent_id field&lt;/li>
&lt;li>&lt;code>parent_invalid&lt;/code> - triggered when selected parent is invalid (parent document is found and
either does not have a configured type or its type is not configured to be a parent to the
place type to be created)&lt;/li>
&lt;li>&lt;code>parent_not_found&lt;/code> - triggered when selected parent is not found&lt;/li>
&lt;/ul>
&lt;p>The selected parent (if found) can be accessed by using the &lt;code>parent&lt;/code> path in error messages:
&lt;code>'Cannot create a place type &amp;quot;health_center&amp;quot; under parent {{parent.place_id}}({{parent.contact_type}})'&lt;/code>&lt;/p>
&lt;h6 id="alternative-name-location-1">Alternative Name Location&lt;/h6>
&lt;p>The created place&amp;rsquo;s name is provided in the &lt;code>place_name&lt;/code> field by default.
To provide an alternative location for the place name, provide a &lt;code>place_name_field&lt;/code> in
&lt;code>&amp;quot;params&amp;quot;&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;params&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;{\&amp;#34;place_name_field\&amp;#34;: \&amp;#34;clinic_name\&amp;#34;}&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="generate-shortcode-on-contacts">Generate Shortcode on Contacts&lt;/h3>
&lt;p>No custom configuration for &lt;code>generate_shortcode_on_contacts&lt;/code>.&lt;/p>
&lt;h3 id="generate-patient-id-on-people">Generate Patient ID On People&lt;/h3>
&lt;p>&lt;strong>Deprecated since 3.8.x&lt;/strong> in favor of &lt;code>generate_shortcode_on_contacts&lt;/code>&lt;/p>
&lt;p>No custom configuration for &lt;code>generate_patient_id_on_people&lt;/code>.&lt;/p>
&lt;h3 id="update_notifications">update_notifications&lt;/h3>
&lt;p>&lt;strong>Deprecated in favor of &lt;a href="#muting">Muting&lt;/a>&lt;/strong>&lt;/p>
&lt;h4 id="configuration-3">Configuration&lt;/h4>
&lt;pre>&lt;code>&amp;quot;notifications&amp;quot;: {
&amp;quot;off_form&amp;quot;: &amp;quot;OFF&amp;quot;,
&amp;quot;on_form&amp;quot;: &amp;quot;ON&amp;quot;,
&amp;quot;validations&amp;quot;: {
&amp;quot;join_responses&amp;quot;: true,
&amp;quot;list&amp;quot;: []
},
&amp;quot;messages&amp;quot;: [
{
&amp;quot;translation_key&amp;quot;: &amp;quot;&amp;quot;,
&amp;quot;event_type&amp;quot;: &amp;quot;on_mute&amp;quot;,
&amp;quot;recipient&amp;quot;: &amp;quot;reporting_unit&amp;quot;
},
{
&amp;quot;translation_key&amp;quot;: &amp;quot;&amp;quot;,
&amp;quot;event_type&amp;quot;: &amp;quot;on_unmute&amp;quot;,
&amp;quot;recipient&amp;quot;: &amp;quot;reporting_unit&amp;quot;
},
{
&amp;quot;translation_key&amp;quot;: &amp;quot;&amp;quot;,
&amp;quot;event_type&amp;quot;: &amp;quot;patient_not_found&amp;quot;,
&amp;quot;recipient&amp;quot;: &amp;quot;reporting_unit&amp;quot;
}
]
}
&lt;/code>&lt;/pre>&lt;h3 id="muting">Muting&lt;/h3>
&lt;p>Implements muting/unmuting of persons and places. Supports multiple forms for each action, for webapp and sms workflows.&lt;/p>
&lt;p>Muting action:&lt;/p>
&lt;ul>
&lt;li>updates target contact and all its descendants&lt;sup>[1]&lt;/sup>, setting the &lt;code>muted&lt;/code> property equal to the current &lt;code>date&lt;/code> in ISO format&lt;sup>[2]&lt;/sup>&lt;/li>
&lt;li>adds a &lt;code>muting_history&lt;/code> entry to Sentinel &lt;code>info&lt;/code> docs for every updated contact&lt;sup>[7]&lt;/sup>&lt;/li>
&lt;li>updates all connected registrations&lt;sup>[3]&lt;/sup>, changing the state of all unsent&lt;sup>[4]&lt;/sup> &lt;code>scheduled_tasks&lt;/code> to &lt;code>muted&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>Unmuting action:&lt;/p>
&lt;ul>
&lt;li>updates target contact&amp;rsquo;s topmost muted ancestor&lt;sup>[1][5]&lt;/sup> and all its descendants, removing the &lt;code>muted&lt;/code> property&lt;/li>
&lt;li>adds a &lt;code>muting_history&lt;/code> entry to Sentinel &lt;code>info&lt;/code> docs for every updated contact&lt;sup>[7]&lt;/sup>&lt;/li>
&lt;li>updates all connected registrations&lt;sup>[3]&lt;/sup>, changing the state of all present/future&lt;sup>[6]&lt;/sup> &lt;code>muted&lt;/code> &lt;code>scheduled_tasks&lt;/code> to &lt;code>scheduled&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>[1] Contacts that are already in the correct state are skipped. This applies to updates to the contact itself, updates to the Sentinel &lt;code>muting_history&lt;/code> and to the connected registrations (registrations of a contact that is already in the correct state will not be updated).
[2] The date represents the moment Sentinel has processed the muting action
[3] target contact and descendants&amp;rsquo; registrations
[4] &lt;code>scheduled_tasks&lt;/code> being in either &lt;code>scheduled&lt;/code> or &lt;code>pending&lt;/code> state
[5] Because the muted state is inherited, unmuting cascades upwards to the highest level muted ancestor. If none of the ancestors is muted, unmuting cascades downwards only.
[6] &lt;code>scheduled_tasks&lt;/code> which are due today or in the future. All &lt;code>scheduled_tasks&lt;/code> with a due date in the past will remain unchanged.&lt;/p>
&lt;h5 id="7-muting-history">[7] Muting history&lt;/h5>
&lt;p>Each time the &lt;code>muted&lt;/code> state of a contact changes, an entry is added to a &lt;code>muting_history&lt;/code> list saved in Sentinel &lt;code>info&lt;/code> docs (stored as an array property with the same name).
Entries in &lt;code>muting_history&lt;/code> contain the following information:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Property&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>muted&lt;/td>
&lt;td>Boolean representing the muted state&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>date&lt;/td>
&lt;td>Date in ISO Format&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>report_id&lt;/td>
&lt;td>An &lt;code>_id&lt;/code> reference to the report that triggered the action&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="configuration-4">Configuration&lt;/h4>
&lt;p>Configuration is stored in the &lt;code>muting&lt;/code> field of &lt;code>app_settings.json&lt;/code>.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Property&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>mute_forms&lt;/code>&lt;/td>
&lt;td>An array of form codes which will trigger muting. &lt;strong>Required&lt;/strong>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>unmute_forms&lt;/code>&lt;/td>
&lt;td>An array of form codes which will trigger unmuting. Optional.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>validations&lt;/code>&lt;/td>
&lt;td>List of form fields validations. All mute &amp;amp; unmute forms will be subjected to these validation rules. Invalid forms will not trigger muting/unmuting actions. Optional.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messages&lt;/code>&lt;/td>
&lt;td>List of tasks/errors that will be created, determined by &lt;code>event_type&lt;/code>. Optional.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>Supported &lt;code>events_types&lt;/code> are:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Event Type&lt;/th>
&lt;th>Trigger&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>mute&lt;/code>&lt;/td>
&lt;td>On successful &lt;code>mute&lt;/code> action&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>unmute&lt;/code>&lt;/td>
&lt;td>On successful &lt;code>unmute&lt;/code> action&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>already_muted&lt;/code>&lt;/td>
&lt;td>On &lt;code>mute&lt;/code> action, when target contact is already muted&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>already_unmuted&lt;/code>&lt;/td>
&lt;td>On &lt;code>unmute&lt;/code> action, when target contact is already unmuted&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>contact_not_found&lt;/code>&lt;/td>
&lt;td>Either mute or unmute actions when target contact is not found&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h5 id="example-1">Example&lt;/h5>
&lt;pre>&lt;code>&amp;quot;muting&amp;quot;: {
&amp;quot;mute_forms&amp;quot;: [&amp;quot;mute_person&amp;quot;, &amp;quot;mute_clinic&amp;quot;],
&amp;quot;unmute_forms&amp;quot;: [&amp;quot;unmute_person&amp;quot;, &amp;quot;unmute_clinic&amp;quot;],
&amp;quot;validations&amp;quot;: {
&amp;quot;join_responses&amp;quot;: true,
&amp;quot;list&amp;quot;: []
},
&amp;quot;messages&amp;quot;: [
{
&amp;quot;translation_key&amp;quot;: &amp;quot;&amp;quot;,
&amp;quot;event_type&amp;quot;: &amp;quot;mute&amp;quot;,
&amp;quot;recipient&amp;quot;: &amp;quot;reporting_unit&amp;quot;
},
{
&amp;quot;translation_key&amp;quot;: &amp;quot;&amp;quot;,
&amp;quot;event_type&amp;quot;: &amp;quot;unmute&amp;quot;,
&amp;quot;recipient&amp;quot;: &amp;quot;reporting_unit&amp;quot;
},
{
&amp;quot;translation_key&amp;quot;: &amp;quot;&amp;quot;,
&amp;quot;event_type&amp;quot;: &amp;quot;already_muted&amp;quot;,
&amp;quot;recipient&amp;quot;: &amp;quot;reporting_unit&amp;quot;
},
{
&amp;quot;translation_key&amp;quot;: &amp;quot;&amp;quot;,
&amp;quot;event_type&amp;quot;: &amp;quot;already_unmuted&amp;quot;,
&amp;quot;recipient&amp;quot;: &amp;quot;reporting_unit&amp;quot;
},
{
&amp;quot;translation_key&amp;quot;: &amp;quot;&amp;quot;,
&amp;quot;event_type&amp;quot;: &amp;quot;contact_not_found&amp;quot;,
&amp;quot;recipient&amp;quot;: &amp;quot;reporting_unit&amp;quot;
}
]
}
&lt;/code>&lt;/pre>&lt;h3 id="self_report">self_report&lt;/h3>
&lt;p>Updates a &lt;code>data_record&lt;/code> to set its patient to its sender. The resulting doc will have &lt;code>fields.patient_uuid&lt;/code> and &lt;code>fields.patient_id&lt;/code> filled with the sender&amp;rsquo;s information. Provides hydrated patient information to subsequent transitions.
The &lt;code>sender&lt;/code> is the contact associated with the phone number that sent the original SMS.&lt;br>
If a doc already contains a &lt;code>patient&lt;/code> field, does not have a sender or its &lt;code>form&lt;/code> is not configured to be enabled for this transition, it will be ignored.&lt;/p>
&lt;h4 id="configuration-5">Configuration&lt;/h4>
&lt;p>Configuration is stored in the &lt;code>self_report&lt;/code> field of &lt;code>app_settings.json&lt;/code> as a list of objects connecting forms to messages.
Every object should have this structure:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Property&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>form&lt;/code>&lt;/td>
&lt;td>Form code. &lt;strong>Required&lt;/strong>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>messages&lt;/code>&lt;/td>
&lt;td>List of tasks/errors that will be created, determined by &lt;code>event_type&lt;/code>. Optional.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>Supported &lt;code>events_types&lt;/code> are:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Event Type&lt;/th>
&lt;th>Trigger&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>report_accepted&lt;/code>&lt;/td>
&lt;td>On successful sender updating&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>sender_not_found&lt;/code>&lt;/td>
&lt;td>Sender not found&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h5 id="example-2">Example&lt;/h5>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#4e9a06">&amp;#34;self_report&amp;#34;&lt;/span>&lt;span style="color:#a40000">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;form&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;FORM&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;messages&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;event_type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;report_accepted&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;recipient&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;reporting_unit&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;translation_key&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;messages.form.report_accepted&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;event_type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;sender_not_found&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;recipient&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;reporting_unit&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;translation_key&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;messages.form.sender_not_found&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;form&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;OTHER&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;messages&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;event_type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;report_accepted&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;recipient&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;reporting_unit&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;translation_key&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;messages.other.report_accepted&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;event_type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;sender_not_found&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;recipient&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;reporting_unit&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;translation_key&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;messages.other.sender_not_found&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Apps: app</title><link>https://docs.communityhealthtoolkit.org/beta/apps/reference/forms/app/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/reference/forms/app/</guid><description>
&lt;p>App forms are used for care guides within the web app, whether accessed in browser or via the Android app. When a user completes an app form, the contents are saved in the database with the type &lt;code>data_record&lt;/code>. These docs are known in the app as &lt;a href="https://docs.communityhealthtoolkit.org/beta/apps/features/reports/">Reports&lt;/a>.&lt;/p>
&lt;p>App forms are defined by the following files:&lt;/p>
&lt;ul>
&lt;li>A XML form definition using a CHT-enhanced ODK XForm format&lt;/li>
&lt;li>A XLSForm form definition, easier to write and converts to the XForm (optional)&lt;/li>
&lt;li>Meta information in the &lt;code>{form_name}.properties.json&lt;/code> file (optional)&lt;/li>
&lt;li>Media files in the &lt;code>{form_name}-media&lt;/code> directory (optional)&lt;/li>
&lt;/ul>
&lt;h2 id="xform">XForm&lt;/h2>
&lt;p>A CHT-enhanced version of the ODK XForm standard is supported.&lt;/p>
&lt;p>Data needed during the completion of the form (eg patient&amp;rsquo;s name, prior information) is passed into the &lt;code>inputs&lt;/code> group. Reports that have at least one of &lt;code>place_id&lt;/code>, &lt;code>patient_id&lt;/code>, and &lt;code>patient_uuid&lt;/code> at the top level will be associated with that contact.&lt;/p>
&lt;p>A typical form ends with a summary group (eg &lt;code>group_summary&lt;/code>, or &lt;code>group_review&lt;/code>) where important information is shown to the user before they submit the form.&lt;/p>
&lt;p>In between the &lt;code>inputs&lt;/code> and the closing group is the form flow - a collection of questions that can be grouped into pages. All data fields submitted with a form are stored, but often important information that will need to be accessed from the form is brought to the top level. To make sure forms are properly associated to a contact, make sure at least one of &lt;code>place_id&lt;/code>, &lt;code>patient_id&lt;/code>, and &lt;code>patient_uuid&lt;/code> is stored at the top level of the form.&lt;/p>
&lt;p>&lt;em>See Also:&lt;/em> &lt;a href=https://docs.communityhealthtoolkit.org/beta/design/apps/#content-and-layout>Content and Layout&lt;/a>&lt;/p>
&lt;h2 id="xlsform">XLSForm&lt;/h2>
&lt;p>Since writing raw XML can be tedious, we suggest creating the forms using the &lt;a href="http://xlsform.org/">XLSForm standard&lt;/a>, and using the &lt;a href="https://github.com/medic/medic-conf">medic-conf&lt;/a> command line configurer tool to &lt;a href="#build">convert them to XForm format&lt;/a>.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>type&lt;/th>
&lt;th>name&lt;/th>
&lt;th>label&lt;/th>
&lt;th>relevant&lt;/th>
&lt;th>appearance&lt;/th>
&lt;th>calculate&lt;/th>
&lt;th>&amp;hellip;&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>begin group&lt;/td>
&lt;td>inputs&lt;/td>
&lt;td>Inputs&lt;/td>
&lt;td>./source = &amp;lsquo;user&amp;rsquo;&lt;/td>
&lt;td>field-list&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>hidden&lt;/td>
&lt;td>source&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>hidden&lt;/td>
&lt;td>source_id&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>begin group&lt;/td>
&lt;td>contact&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>db:person&lt;/td>
&lt;td>_id&lt;/td>
&lt;td>Patient ID&lt;/td>
&lt;td>&lt;/td>
&lt;td>db-object&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>string&lt;/td>
&lt;td>patient_id&lt;/td>
&lt;td>Medic ID&lt;/td>
&lt;td>&lt;/td>
&lt;td>hidden&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>string&lt;/td>
&lt;td>name&lt;/td>
&lt;td>Patient Name&lt;/td>
&lt;td>&lt;/td>
&lt;td>hidden&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>end group&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>end group&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>calculate&lt;/td>
&lt;td>_id&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>../inputs/contact/_id&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>calculate&lt;/td>
&lt;td>patient_id&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>../inputs/contact/patient_id&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>calculate&lt;/td>
&lt;td>name&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>../inputs/contact/name&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&amp;hellip;&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>begin group&lt;/td>
&lt;td>group_summary&lt;/td>
&lt;td>Summary&lt;/td>
&lt;td>&lt;/td>
&lt;td>field-list summary&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>note&lt;/td>
&lt;td>r_patient_info&lt;/td>
&lt;td>**${patient_name}** ID: ${r_patient_id}&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>note&lt;/td>
&lt;td>r_followup&lt;/td>
&lt;td>Follow Up &amp;lt;i class=&amp;quot;fa fa-flag&amp;rdquo;&amp;gt;&amp;lt;/i&amp;gt;&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>note&lt;/td>
&lt;td>r_followup_note&lt;/td>
&lt;td>${r_followup_instructions}&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>end group&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="cht-xform-widgets">CHT XForm Widgets&lt;/h2>
&lt;p>Some XForm widgets have been added or modified for use in the app:&lt;/p>
&lt;ul>
&lt;li>&lt;strong>Bikram Sambat Datepicker&lt;/strong>: Calendar widget using Bikram Sambat calendar. Used by default for appropriate languages.&lt;/li>
&lt;li>&lt;strong>Countdown Timer&lt;/strong>: A visual timer widget that starts when tapped/clicked, and has an audible alert when done. To use it create a &lt;code>string&lt;/code> field with an &lt;code>appearance&lt;/code> set to &lt;code>countdown-timer&lt;/code>. The duration of the timer is the field&amp;rsquo;s value, which can be set in the XLSForm&amp;rsquo;s &lt;code>default&lt;/code> column. If this value is not set, the timer will be set to 60 seconds.&lt;/li>
&lt;li>&lt;strong>Contact Selector&lt;/strong>: Select a contact, such as a person or place, and save their UUID in the report. To use create a field of type &lt;code>db:{{contact_type}}&lt;/code> (eg &lt;code>db:person&lt;/code>, &lt;code>db:clinic&lt;/code>) with appearance &lt;code>db-object&lt;/code>.&lt;/li>
&lt;li>&lt;strong>Rapid Diagnostic Test capture&lt;/strong>: Take a picture of a Rapid Diagnotistic Test and save it with the report. Works with &lt;a href="https://github.com/medic/rdt-capture/">rdt-capture Android application&lt;/a>. To use create a string field with appearance &lt;code>mrdt-verify&lt;/code>.&lt;/li>
&lt;li>&lt;strong>Simprints registration&lt;/strong>: Register a patient with the Simprints biometric tool. To include in a form create a &lt;code>string&lt;/code> field with &lt;code>appearance&lt;/code> of &lt;code>simprints-reg&lt;/code>. Requires the Simprints app connected with hardware, or &lt;a href="https://github.com/medic/mocksimprints">mock app&lt;/a>. Demo only, not ready for production since API key is hardcoded.&lt;/li>
&lt;/ul>
&lt;p>The code for these widgets can be found in the &lt;a href="https://github.com/medic/medic/tree/master/webapp/src/js/enketo/widgets">Medic repo&lt;/a>.&lt;/p>
&lt;h3 id="contact-selector">Contact Selector&lt;/h3>
&lt;p>Using a contact selector allows you to get data off the selected contact(person or place) or search for an existing contact.&lt;/p>
&lt;p>When using with the appearance column set to &lt;code>db-object&lt;/code>. The contact selector will display as a search box allowing you to search for the type of contact specified when building the report. EX: &lt;code>db-person&lt;/code> will only search for contacts with type of person.&lt;/p>
&lt;p>When used as a field you can pull the current contact. This is can be used to link reports to a person or place where you started the form from. Getting the data of &lt;code>_id&lt;/code> or &lt;code>patient_id&lt;/code> and setting those to &lt;code>patient_id&lt;/code> or &lt;code>patient_uuid&lt;/code> on the final report will link that report so it displays on their contact summary page.&lt;/p>
&lt;p>Example of getting the data from the contact and assigning it to the fields neccessary to link the report.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>type&lt;/th>
&lt;th>name&lt;/th>
&lt;th>label&lt;/th>
&lt;th>relevant&lt;/th>
&lt;th>appearance&lt;/th>
&lt;th>calculate&lt;/th>
&lt;th>&amp;hellip;&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>begin group&lt;/td>
&lt;td>contact&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>db:person&lt;/td>
&lt;td>_id&lt;/td>
&lt;td>Patient ID&lt;/td>
&lt;td>&lt;/td>
&lt;td>db-object&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>string&lt;/td>
&lt;td>patient_id&lt;/td>
&lt;td>Medic ID&lt;/td>
&lt;td>&lt;/td>
&lt;td>hidden&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>string&lt;/td>
&lt;td>name&lt;/td>
&lt;td>Patient Name&lt;/td>
&lt;td>&lt;/td>
&lt;td>hidden&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>end group&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>calculate&lt;/td>
&lt;td>patient_uuid&lt;/td>
&lt;td>Patient UUID&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>../contact/_id&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>calculate&lt;/td>
&lt;td>patient_id&lt;/td>
&lt;td>Patient ID&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>../contact/patient_id&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="cht-xpath-functions">CHT XPath Functions&lt;/h2>
&lt;h3 id="difference-in-months">&lt;code>difference-in-months&lt;/code>&lt;/h3>
&lt;p>Calculates the number of whole calendar months between two dates. This is often used when determining a child&amp;rsquo;s age for immunizations or assessments.&lt;/p>
&lt;h3 id="z-score">&lt;code>z-score&lt;/code>&lt;/h3>
&lt;p>In Enketo forms you have access to an XPath function to calculate the z-score value for a patient.&lt;/p>
&lt;h2 id="uploading-binary-attachments">Uploading Binary Attachments&lt;/h2>
&lt;p>Forms can include arbitrary binary data which is submitted and included in the doc as an attachment. If this is an image type it&amp;rsquo;ll then be displayed inline in the report UI.&lt;/p>
&lt;p>To mark an element as having binary data add an extra column in the XLSForm called &lt;code>instance::type&lt;/code> and specify &lt;code>binary&lt;/code> in the element&amp;rsquo;s row.&lt;/p>
&lt;h2 id="properties">Properties&lt;/h2>
&lt;p>The meta information in the &lt;code>{form_name}.properties.json&lt;/code> file defines the form&amp;rsquo;s title and icon, as well as when and where the form should be available.&lt;/p>
&lt;h3 id="formsappform_namepropertiesjson">&lt;code>forms/app/{form_name}.properties.json&lt;/code>&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>property&lt;/th>
&lt;th>description&lt;/th>
&lt;th>required&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>title&lt;/code>&lt;/td>
&lt;td>The form&amp;rsquo;s title seen in the app. Uses a localization array using the 2-letter code, not the translation keys discussed in the &lt;a href="#localization">Localization section&lt;/a>.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>icon&lt;/code>&lt;/td>
&lt;td>Icon associated with the form. The value is the image&amp;rsquo;s key in the &lt;code>resources.json&lt;/code> file, as described in the &lt;a href="#icons">Icons section&lt;/a>&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>context&lt;/code>&lt;/td>
&lt;td>The context defines when and where the form should be available in the app&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>context.person&lt;/code>&lt;/td>
&lt;td>Boolean determining if the form can be seen in the Action list for a person&amp;rsquo;s profile. This is still subject to the &lt;code>expression&lt;/code>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>context.place&lt;/code>&lt;/td>
&lt;td>Boolean determining if the form can be seen in the Action list for a person&amp;rsquo;s profile. This is still subject to the &lt;code>expression&lt;/code>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>context.expression&lt;/code>&lt;/td>
&lt;td>A JavaScript expression which is evaluated when a contact profile or the reports tab is viewed. If the expression evaluates to true, the form will be listed as an available action. The inputs &lt;code>contact&lt;/code>, &lt;code>user&lt;/code>, and &lt;code>summary&lt;/code> are available. By default, forms are not shown on the reports tab, use &lt;code>&amp;quot;expression&amp;quot;: &amp;quot;!contact&amp;quot;&lt;/code> to show the form on the Reports tab since there is no contact for this scenario.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="code-sample">Code sample&lt;/h3>
&lt;p>In this sample properties file, the associated form would only show on a person&amp;rsquo;s page, and only if their sex is unspecified or female and they are between 10 and 65 years old:&lt;/p>
&lt;h4 id="formsapppregnancypropertiesjson">&lt;code>forms/app/pregnancy.properties.json&lt;/code>&lt;/h4>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json"> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;title&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;locale&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;en&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;content&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;New Pregnancy&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;locale&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;hi&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;content&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;नई गर्भावस्था&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;icon&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;pregnancy-1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;context&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;person&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">true&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;place&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">false&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;expression&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;contact.type === &amp;#39;person&amp;#39; &amp;amp;&amp;amp; (!contact.sex || contact.sex === &amp;#39;female&amp;#39;) &amp;amp;&amp;amp; (!contact.date_of_birth || (ageInYears(contact) &amp;gt;= 10 &amp;amp;&amp;amp; ageInYears(contact) &amp;lt; 65))&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="build">Build&lt;/h2>
&lt;p>Convert and build the app forms into your application using the &lt;code>convert-app-forms&lt;/code> and &lt;code>upload-app-forms&lt;/code> actions in &lt;code>medic-conf&lt;/code>.&lt;/p>
&lt;pre>&lt;code>medic-conf --local convert-app-forms upload-app-forms
&lt;/code>&lt;/pre></description></item><item><title>Apps: collect</title><link>https://docs.communityhealthtoolkit.org/beta/apps/reference/forms/collect/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/reference/forms/collect/</guid><description>
&lt;p>ODK XForms are used to render forms in the Medic Collect Android app. These forms cannot use any Medic-specific XForm notations. All Medic Collect forms are processed as SMS (even when submitted over a wifi) therefore a corresponding JSON form with matching fields is used to interpret the incoming report.&lt;/p>
&lt;p>Collect forms must be in the &lt;code>forms/collect&lt;/code> folder to be processed by &lt;a href="https://github.com/medic/medic-conf">&lt;code>medic-conf&lt;/code>&lt;/a>&amp;lsquo;s &lt;code>convert-collect-forms&lt;/code> and &lt;code>upload-collect-forms&lt;/code> actions. Once uploaded to the server, they can be downloaded by the Medic Collect app. These forms can also be included in Medic Collect builds for users without a data connection to get forms.&lt;/p>
&lt;p>XForms require a couple minor changes to be compatible with Medic Collect so that they can properly be received by a Medic instance. The changes can be done either manually in the XForm&amp;rsquo;s XML, or automatically with XLSForm forms using &lt;code>medic-conf&lt;/code>.&lt;/p>
&lt;h3 id="automatic-changes-with-xlsforms">Automatic changes with XLSForms&lt;/h3>
&lt;p>If using a &lt;a href="http://xlsform.org/">XLSForm&lt;/a> and using &lt;a href="https://github.com/medic/medic-conf">&lt;code>medic-conf&lt;/code>&lt;/a> to convert to XForm, the necessary fields will be automatically added to the resulting XForm. You can override the default prefix and separator by declaring &lt;code>sms_keyword&lt;/code> and &lt;code>sms_seperator&lt;/code> respectively in the Settings tab.&lt;/p>
&lt;h3 id="manual-changes-in-xform">Manual changes in XForm&lt;/h3>
&lt;p>Collect forms need &lt;code>prefix&lt;/code> and &lt;code>delimiter&lt;/code> values added to the XForm&amp;rsquo;s XML. This is done where the form ID is declared in the instance&amp;rsquo;s data model. For example, the following:&lt;/p>
&lt;pre>&lt;code>&amp;lt;instance&amp;gt;
&amp;lt;data id=&amp;quot;myform&amp;quot; &amp;gt;
...
&lt;/code>&lt;/pre>&lt;p>becomes:&lt;/p>
&lt;pre>&lt;code>&amp;lt;instance&amp;gt;
&amp;lt;data id=&amp;quot;myform&amp;quot; prefix=&amp;quot;J1!FORM_CODE!&amp;quot; delimiter=&amp;quot;#&amp;quot;&amp;gt;
...
&lt;/code>&lt;/pre>&lt;p>Note that &lt;code>FORM_CODE&lt;/code> should be replaced with the form code as defined in the JSON forms version of the form. If the form code is &lt;code>ABCD&lt;/code> the prefix value would be &lt;code>J1!ABCD!&lt;/code>, resulting in &lt;code>prefix=&amp;quot;J1!ABCD!&amp;quot;&lt;/code>. In case you are curious, the &lt;code>J1&lt;/code> lets the Medic Mobile server know that version 1 of the JavaRosa parser should be used on the incoming SMS.&lt;/p></description></item><item><title>Apps: contact</title><link>https://docs.communityhealthtoolkit.org/beta/apps/reference/forms/contact/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/reference/forms/contact/</guid><description>
&lt;p>Contact forms are used for the creation and editing of each contact. The type associated to people is &lt;code>person&lt;/code>, and there are three types of places corresponding to levels in the app: &lt;code>district_hospital&lt;/code> &amp;gt; &lt;code>health_center&lt;/code> &amp;gt; &lt;code>clinic&lt;/code>. The display names for the place levels can be changed via &lt;a href="https://docs.communityhealthtoolkit.org/beta/apps/reference/translations/">custom translations&lt;/a>, and wherever they are defined in the contact forms. Each contact type has its own XForm where it defines the fields that it wants to store/edit for the contact:&lt;/p>
&lt;pre>&lt;code>- /forms/contact/person-create.xml
- /forms/contact/person-edit.xml
- /forms/contact/clinic-create.xml
- /forms/contact/clinic-edit.xml
- /forms/contact/health_center-create.xml
- /forms/contact/health_center-edit.xml
- /forms/contact/district_hospital-create.xml
- /forms/contact/district_hospital-edit.xml
&lt;/code>&lt;/pre>
&lt;p>To create the above XForm files it is recommended to use XLSForms. Also, if the contact forms will be similar for all places, you can use a &lt;code>PLACE_TYPE-create.xlsx&lt;/code> file for creation, a &lt;code>PLACE_TYPE-edit.xlsx&lt;/code> for editing, and have &lt;code>medic-conf&lt;/code> generate the individual forms. For this you would also need &lt;code>forms/contact/places.json&lt;/code>, where you would define the place names. From the XLSForm you can refer to the place type with &lt;code>PLACE_TYPE&lt;/code>, and the place name with &lt;code>PLACE_NAME&lt;/code>. You can even use the place type for conditional behaviour in the form. The base files needed would therefore be:&lt;/p>
&lt;pre>&lt;code>- /forms/contact/person-create.xlsx
- /forms/contact/person-edit.xlsx
- /forms/contact/PLACE_TYPE-create.xlsx
- /forms/contact/PLACE_TYPE-edit.xlsx
- /forms/contact/places.json
&lt;/code>&lt;/pre>
&lt;p>Here is an example of a &lt;code>places.json&lt;/code> files:&lt;/p>
&lt;pre>&lt;code>{
&amp;quot;clinic&amp;quot;: &amp;quot;Village Clinic&amp;quot;,
&amp;quot;health_center&amp;quot;: &amp;quot;Health Center&amp;quot;,
&amp;quot;district_hospital&amp;quot;: &amp;quot;District Hospital&amp;quot;
}
&lt;/code>&lt;/pre>
&lt;p>Convert and build the contact forms into your application using the &lt;code>convert-contact-forms&lt;/code> and &lt;code>upload-contact-forms&lt;/code> actions in &lt;code>medic-conf&lt;/code>.&lt;/p>
&lt;blockquote>
&lt;p>&lt;code>medic-conf --local convert-contact-forms upload-contact-form&lt;/code>&lt;/p>
&lt;/blockquote></description></item><item><title>Apps: contact-summary.templated.js</title><link>https://docs.communityhealthtoolkit.org/beta/apps/reference/contact-page/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/reference/contact-page/</guid><description>
&lt;p>Contact profile pages display basic information about the contact along with their history and upcoming tasks.
A contact&amp;rsquo;s profile page is defined by the &lt;a href="#contact-summary">Fields&lt;/a>, &lt;a href="#condition-cards">Cards&lt;/a>, and &lt;a href="#care-guides">Care Guides&lt;/a> available.&lt;/p>
&lt;p>Helper variables and functions for the contact summary can be defined in &lt;code>contact-summary-extras.js&lt;/code>. There are several variables available to inspect to generate the summary information:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Variable&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>contact&lt;/code>&lt;/td>
&lt;td>The currently selected contact. This has minimal stubs for the &lt;code>contact.parent&lt;/code>, so if you want to refer to a property on the parent use &lt;code>lineage&lt;/code> below.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>reports&lt;/code>&lt;/td>
&lt;td>An array of reports for the contact.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>lineage&lt;/code>&lt;/td>
&lt;td>An array of the contact&amp;rsquo;s parents (2.13+), eg &lt;code>lineage[0]&lt;/code> is the parent, &lt;code>lineage[1]&lt;/code> is the grandparent, etc. Each lineage entry has full information for the contact, so you can use &lt;code>lineage[1].contact.phone&lt;/code>.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>targetDoc&lt;/code>&lt;/td>
&lt;td>Doc with &lt;a href="https://docs.communityhealthtoolkit.org/beta/core/overview/db-schema/#targets">&lt;code>target&lt;/code>&lt;/a> document of the contact, hydrated with the config information of every target it contains a value for. If there is no target document available (for example when viewing a contact that does not upload targets), this value will be &lt;code>undefined&lt;/code>. This value might also be &lt;code>undefined&lt;/code> if the contact has not yet synced the current target document. Added in &lt;code>3.9.0&lt;/code>.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="contact-summary">Contact Summary&lt;/h2>
&lt;p>Each field that can be shown on a contact&amp;rsquo;s profile is defined as an object in the &lt;code>fields&lt;/code> array of &lt;code>contact-summary.templated.js&lt;/code>. The properties for each object determine how and when the field is shown.&lt;/p>
&lt;h3 id="contact-summarytemplatedjs-fields">&lt;code>contact-summary.templated.js .fields[]&lt;/code>&lt;/h3>
&lt;!-- If you change this table, update the duplicate descriptions in ### Cards -->
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>property&lt;/th>
&lt;th>type&lt;/th>
&lt;th>description&lt;/th>
&lt;th>required&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>label&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>A translation key which is shown with the field.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>icon&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>The name of the icon to display beside this field, as defined through the Configuration &amp;gt; Icons page.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>value&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>The value shown for the field.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>filter&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>The display filter to apply to the value, eg: &lt;code>{ value: '2005-10-09', filter: 'age' }&lt;/code> will render as &amp;ldquo;11 years&amp;rdquo;. Common filters are: &lt;code>age&lt;/code>, &lt;code>phone&lt;/code>, &lt;code>weeksPregnant&lt;/code>, &lt;code>relativeDate&lt;/code>, &lt;code>relativeDay&lt;/code>, &lt;code>fullDate&lt;/code>, &lt;code>simpleDate&lt;/code>, &lt;code>simpleDateTime&lt;/code>, &lt;code>lineage&lt;/code>, &lt;code>resourceIcon&lt;/code>, &lt;code>translate&lt;/code>. For the complete list of filters, and more details on what each does, check out the code in &lt;a href="https://github.com/medic/medic/tree/master/webapp/src/js/filters">&lt;code>medic/webapp/src/js/filters&lt;/code> dir&lt;/a>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>width&lt;/code>&lt;/td>
&lt;td>&lt;code>integer&lt;/code>&lt;/td>
&lt;td>The horizontal space for the field. Common values are 12 for full width, 6 for half width, or 3 for quarter width. Default 12.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>translate&lt;/code>&lt;/td>
&lt;td>&lt;code>boolean&lt;/code>&lt;/td>
&lt;td>Whether or not to translate the &lt;code>value&lt;/code>. Defaults to false.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>context&lt;/code>&lt;/td>
&lt;td>&lt;code>object&lt;/code>&lt;/td>
&lt;td>When &lt;code>translate: true&lt;/code> and &lt;code>value&lt;/code> uses &lt;a href="https://angular-translate.github.io/docs/#/guide/06_variable-replacement">translation variables&lt;/a>, this value should provide the translation variables.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>appliesIf&lt;/code>&lt;/td>
&lt;td>&lt;code>function()&lt;/code> or &lt;code>boolean&lt;/code>&lt;/td>
&lt;td>Return true if the field should be shown.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>appliesToType&lt;/code>&lt;/td>
&lt;td>&lt;code>string[]&lt;/code>&lt;/td>
&lt;td>Filters the contacts for which &lt;code>appliesIf&lt;/code> will be evaluated. For example, &lt;code>['person']&lt;/code> or &lt;code>['clinic', 'health_center']&lt;/code>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;!-- TODO: See [How to configure profile pages]() for an example. -->
&lt;h2 id="condition-cards">Condition Cards&lt;/h2>
&lt;p>Each condition card is defined as a card object in the &lt;code>cards&lt;/code> array of &lt;code>contact-summary.templated.js&lt;/code>. The properties for each object determine how and when the card and its fields are shown.&lt;/p>
&lt;h3 id="contact-summarytemplatedjs-cards">&lt;code>contact-summary.templated.js .cards[]&lt;/code>&lt;/h3>
&lt;!-- If you change the field data in this table, update the duplicate descriptions in ### Fields -->
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>property&lt;/th>
&lt;th>type&lt;/th>
&lt;th>description&lt;/th>
&lt;th>required&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>label&lt;/code>&lt;/td>
&lt;td>&lt;code>translation key&lt;/code>&lt;/td>
&lt;td>Label on top of card.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>appliesToType&lt;/code>&lt;/td>
&lt;td>&lt;code>string[]&lt;/code>&lt;/td>
&lt;td>A filter, so &lt;code>appliesIf&lt;/code> is called only if the contact&amp;rsquo;s type matches one or more of the elements. For example, &lt;code>['person']&lt;/code>. Please, note that &lt;code>['report']&lt;/code> is also allowed to create a report card. But, you cannot use it in conjunction with a contact&amp;rsquo;s type.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>appliesIf&lt;/code>&lt;/td>
&lt;td>&lt;code>function()&lt;/code> or &lt;code>boolean&lt;/code>&lt;/td>
&lt;td>Return true if the field should be shown.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>modifyContext&lt;/code>&lt;/td>
&lt;td>&lt;code>function(context)&lt;/code>&lt;/td>
&lt;td>Used to modify or add data which is passed as input to forms filled from the contact page.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields&lt;/code>&lt;/td>
&lt;td>&lt;code>Array[]&lt;/code> of &lt;a href="#fields">fields&lt;/a>&lt;/td>
&lt;td>The content of the card.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields[n].appliesIf&lt;/code>&lt;/td>
&lt;td>&lt;code>boolean&lt;/code> or &lt;code>function(report)&lt;/code>&lt;/td>
&lt;td>Same as Fields.appliesIf above.&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields[n].label&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code> or &lt;code>function(report)&lt;/code>&lt;/td>
&lt;td>Label shown with the field.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields[n].icon&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code> or &lt;code>function(report)&lt;/code>&lt;/td>
&lt;td>The name of the icon to display beside this field, as defined through the Configuration &amp;gt; Icons page.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields[n].value&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code> or &lt;code>function(report)&lt;/code>&lt;/td>
&lt;td>The value shown for the field.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields[n].filter&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code> or &lt;code>function(report)&lt;/code>&lt;/td>
&lt;td>The display filter to apply to the value, eg: &lt;code>{ value: '2005-10-09', filter: 'age' }&lt;/code> will render as &amp;ldquo;11 years&amp;rdquo;. Common filters are: &lt;code>age&lt;/code>, &lt;code>phone&lt;/code>, &lt;code>weeksPregnant&lt;/code>, &lt;code>relativeDate&lt;/code>, &lt;code>relativeDay&lt;/code>, &lt;code>fullDate&lt;/code>, &lt;code>simpleDate&lt;/code>, &lt;code>simpleDateTime&lt;/code>, &lt;code>lineage&lt;/code>, &lt;code>resourceIcon&lt;/code>, &lt;code>translate&lt;/code>. For the complete list of filters, and more details on what each does, check out the code in &lt;a href="https://github.com/medic/medic/tree/master/webapp/src/js/filters">&lt;code>medic/webapp/src/js/filters&lt;/code> dir&lt;/a>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields[n].width&lt;/code>&lt;/td>
&lt;td>&lt;code>integer&lt;/code> or &lt;code>function(report)&lt;/code>&lt;/td>
&lt;td>The horizontal space for the field. Common values are 12 for full width, 6 for half width, or 3 for quarter width. Default 12.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields[n].translate&lt;/code>&lt;/td>
&lt;td>&lt;code>boolean&lt;/code> or &lt;code>function(report)&lt;/code>&lt;/td>
&lt;td>Whether or not to translate the &lt;code>value&lt;/code>. Defaults to false.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>fields[n].context&lt;/code>&lt;/td>
&lt;td>&lt;code>object&lt;/code>&lt;/td>
&lt;td>When &lt;code>translate: true&lt;/code> and &lt;code>value&lt;/code> uses &lt;a href="https://angular-translate.github.io/docs/#/guide/06_variable-replacement">translation variables&lt;/a>, this value should provide the translation variables. Only supports properties &lt;code>count&lt;/code> and &lt;code>total&lt;/code> on cards.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;!-- TODO: See [How to configure profile pages]() for an example. -->
&lt;h2 id="care-guides">Care Guides&lt;/h2>
&lt;p>Each care guide accessible from a contact profile is defined as an &lt;a href="https://docs.communityhealthtoolkit.org/beta/apps/reference/forms/app/">App Form&lt;/a>. Context information can be provided to forms via the &lt;code>context&lt;/code> object of &lt;code>contact-summary.templated.js&lt;/code>.&lt;/p>
&lt;p>To show an App Form on a contact&amp;rsquo;s profile, the form&amp;rsquo;s &lt;code>expression&lt;/code> field in its properties file must evaluate to true for that contact. The context infomation from the profile is accessible as the variable &lt;code>summary&lt;/code>.&lt;/p>
&lt;p>The context data is also available directly within the app forms&amp;rsquo; XForm calculations, as &lt;code>instance('contact-summary')/context/${variable}&lt;/code>. For instance if &lt;code>context.is_pregnant&lt;/code> is used in the contact summary, it can be accessed in an XForm field&amp;rsquo;s calculation as &lt;code>instance('contact-summary')/context/is_pregnant&lt;/code>. Note that these fields are not available when editing a previously completed form, or when accessing the form from outside of the profile page.&lt;/p>
&lt;!-- TODO: See [How to configure profile pages]() and [How to build app forms]() for examples and more information. -->
&lt;h2 id="code-samples">Code samples&lt;/h2>
&lt;p>The following samples show how fields, cards, and care guide context comes together in the &lt;code>contact-summary.templated.js&lt;/code> file.&lt;/p>
&lt;h3 id="contact-summarytemplatedjs">&lt;code>contact-summary.templated.js&lt;/code>&lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-js" data-lang="js">&lt;span style="color:#000">module&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">exports&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">context&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">use_cases&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">anc&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">isCoveredByUseCaseInLineage&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">lineage&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;anc&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>
&lt;span style="color:#000">pnc&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">isCoveredByUseCaseInLineage&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">lineage&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;pnc&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">),&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000">fields&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">appliesToType&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;person&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">label&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;patient_id&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">value&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">patient_id&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">width&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">4&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">appliesToType&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;person&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">label&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;contact.age&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">value&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">date_of_birth&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">width&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">4&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">filter&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;age&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">appliesToType&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;person&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">label&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;contact.parent&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">value&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#000">lineage&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">filter&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;lineage&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">appliesToType&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;!person&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">appliesIf&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">parent&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#000">lineage&lt;/span>&lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">];&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span> &lt;span style="color:#000">label&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;contact.parent&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">value&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#000">lineage&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">filter&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;lineage&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#000">cards&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">label&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;contact.profile.pregnancy&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">appliesToType&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;report&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">appliesIf&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">extras&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">isActivePregnancy&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">fields&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">label&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;contact.profile.edd&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">value&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">fields&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">edd_8601&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000">filter&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;relativeDay&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">width&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">12&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">label&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;contact.profile.visit&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">value&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;contact.profile.visits.of&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">translate&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">true&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">context&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">count&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">extras&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">getSubsequentVisits&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>&lt;span style="color:#000">length&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000">total&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">4&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000">width&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">6&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">label&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;contact.profile.risk.title&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">value&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">extras&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">isHighRiskPregnancy&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">?&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;high&amp;#39;&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;normal&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000">translate&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">true&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">width&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">5&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">icon&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">extras&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">isHighRiskPregnancy&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">?&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;risk&amp;#39;&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#000">modifyContext&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">ctx&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">ctx&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">pregnant&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#204a87;font-weight:bold">true&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// don&amp;#39;t show Create Pregnancy Report button
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#000;font-weight:bold">};&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="contact-summary-extrasjs">&lt;code>contact-summary-extras.js&lt;/code>&lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-js" data-lang="js">&lt;span style="color:#000">module&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">exports&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">isActivePregnancy&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">// ...
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000">isCoveredByUseCaseInLineage&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">lineage&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">usecase&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">// ...
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000">isHighRiskPregnancy&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">pregnancy&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">// ...
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000">getSubsequentVisits&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">// ...
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">};&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="build">Build&lt;/h2>
&lt;p>To update the Contact profiles for an app, changes must be compiled into &lt;code>app-settings&lt;/code>, then uploaded.&lt;/p>
&lt;p>&lt;code>medic-conf --local compile-app-settings backup-app-settings upload-app-settings&lt;/code>&lt;/p></description></item><item><title>Apps: targets.js</title><link>https://docs.communityhealthtoolkit.org/beta/apps/reference/targets/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/reference/targets/</guid><description>
&lt;p>&lt;img src="counts.png" alt="Percentages">&lt;/p>
&lt;p>&lt;img src="percentages.png" alt="Percentages">&lt;/p>
&lt;p>All targets are defined in the &lt;code>targets.js&lt;/code> file as an array of objects according to the Targets schema defined below. Each object corresponds to a target widget that shows in the app. The order of objects in the array defines the display order of widgets on the Targets tab. The properties of the object are used to define when the target should appear, what it should look like, and the values it will display.&lt;/p>
&lt;p>&lt;em>See Also:&lt;/em> &lt;a href=https://docs.communityhealthtoolkit.org/beta/apps/features/targets/#>Targets Overview&lt;/a>&lt;/p>
&lt;h2 id="targetsjs">&lt;code>targets.js&lt;/code>&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>property&lt;/th>
&lt;th>type&lt;/th>
&lt;th>description&lt;/th>
&lt;th>required&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>id&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>An identifier for the target. Used for querying task completeness.&lt;/td>
&lt;td>yes, unique&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>icon&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>The icon to show alongside the task. Should correspond with a value defined in &lt;code>resources.json&lt;/code>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>translation_key&lt;/code>&lt;/td>
&lt;td>&lt;code>translation key&lt;/code>&lt;/td>
&lt;td>Translation key for the title of this target.&lt;/td>
&lt;td>no, but recommended&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>subtitle_translation_key&lt;/code>&lt;/td>
&lt;td>&lt;code>translation key&lt;/code>&lt;/td>
&lt;td>Translation key for the subtitle of this target. If none supplied the subtitle will be blank.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>percentage_count_translation_key&lt;/code>&lt;/td>
&lt;td>&lt;code>translation key&lt;/code>&lt;/td>
&lt;td>Translation key for the percentage value detail shown at the bottom of the target, eg &amp;ldquo;(5 of 6 deliveries)&amp;quot;. The translation context has &lt;code>pass&lt;/code> and &lt;code>total&lt;/code> variables available. If none supplied this defaults to &lt;code>targets.count.default&lt;/code>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>context&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>A string containing a JavaScript expression. This widget will only be shown if the expression evaluates to true. Details of the current user is available through the variable &lt;code>user&lt;/code>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>type&lt;/code>&lt;/td>
&lt;td>&lt;code>'count'&lt;/code> or &lt;code>'percent'&lt;/code>&lt;/td>
&lt;td>The type of the widget.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>goal&lt;/code>&lt;/td>
&lt;td>&lt;code>integer&lt;/code>&lt;/td>
&lt;td>For targets with &lt;code>type: 'percent'&lt;/code>, an integer from 0 to 100. For &lt;code>type: 'count'&lt;/code>, any positive number. If there is no goal, put -1.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>appliesTo&lt;/code>&lt;/td>
&lt;td>&lt;code>'contacts'&lt;/code> or &lt;code>'reports'&lt;/code>&lt;/td>
&lt;td>Do you want to count reports or contacts? This attribute controls the behavior of other attributes herein.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>appliesToType&lt;/code>&lt;/td>
&lt;td>If &lt;code>appliesTo: 'reports'&lt;/code>, an array of form codes. If &lt;code>appliesTo: 'contacts'&lt;/code>, an array of contact types.&lt;/td>
&lt;td>Filters the contacts or reports for which &lt;code>appliesIf&lt;/code> will be evaluated. For example, &lt;code>['person']&lt;/code> or &lt;code>['clinic', 'health_center']&lt;/code>. For example, &lt;code>['pregnancy']&lt;/code> or &lt;code>['P', 'pregnancy']&lt;/code>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>appliesIf&lt;/code>&lt;/td>
&lt;td>&lt;code>function(contact, report)&lt;/code>&lt;/td>
&lt;td>If &lt;code>appliesTo: 'contacts'&lt;/code>, this function is invoked once per contact and &lt;code>report&lt;/code> is undefined. If &lt;code>appliesTo: 'reports'&lt;/code>, this function is invoked once per report. Return true to count this document. For &lt;code>type: 'percent'&lt;/code>, this controls the denominator.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>passesIf&lt;/code>&lt;/td>
&lt;td>&lt;code>function(contact, report)&lt;/code>&lt;/td>
&lt;td>For &lt;code>type: 'percent'&lt;/code>, return true to increment the numerator.&lt;/td>
&lt;td>yes, if &lt;code>type: 'percent'&lt;/code>. Forbidden when &lt;code>groupBy&lt;/code> is defined.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>date&lt;/code>&lt;/td>
&lt;td>&lt;code>'reported'&lt;/code> or &lt;code>'now'&lt;/code> or &lt;code>function(contact, report)&lt;/code>&lt;/td>
&lt;td>When &lt;code>'reported'&lt;/code>, the target will count documents with a &lt;code>reported_date&lt;/code> within the current month. When &lt;code>'now'&lt;/code>, target includes all documents. A function can be used to indicate when the document should be counted. Default is &lt;code>'reported'&lt;/code>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>idType&lt;/code>&lt;/td>
&lt;td>&lt;code>'report'&lt;/code> or &lt;code>'contact'&lt;/code> or &lt;code>function(contact, report)&lt;/code>&lt;/td>
&lt;td>The target&amp;rsquo;s values are incremented once per unique ID. To count individual contacts that have one or more reports that apply, use &lt;code>'contact'&lt;/code>. Use &lt;code>'report'&lt;/code> to count all reports, even if there are multiple that apply for a single contact. If you need more than a single count for each applying contact or report then a custom function can be used returning an array with unique IDs — one element for each count.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>groupBy&lt;/code>&lt;/td>
&lt;td>&lt;code>function(contact, report)&lt;/code> returning string&lt;/td>
&lt;td>Allows for target ids to be aggregated and scored in groups. Not required for most targets. Use with passesIfGroupCount.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>passesIfGroupCount&lt;/code>&lt;/td>
&lt;td>&lt;code>object&lt;/code>&lt;/td>
&lt;td>The criteria to determine if the target ids within a group should be counted as passing&lt;/td>
&lt;td>yes when &lt;code>groupBy&lt;/code> is defined&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>passesIfGroupCount.gte&lt;/code>&lt;/td>
&lt;td>&lt;code>number&lt;/code>&lt;/td>
&lt;td>The group should be counted as passing if the number of target ids in the group is greater-than-or-equal-to this value&lt;/td>
&lt;td>yes when &lt;code>groupBy&lt;/code> is defined&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dhis&lt;/code>&lt;/td>
&lt;td>&lt;code>object&lt;/code> or &lt;code>object[]&lt;/code>&lt;/td>
&lt;td>Settings relevant to the &lt;a href="https://docs.communityhealthtoolkit.org/beta/apps/guides/integrations/dhis2-aggregate/#configuration">DHIS2 Integration&lt;/a>&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dhis[n].dataElement&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>The hash id of a data element configured in the DHIS2 data set you&amp;rsquo;re integrating with&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>dhis[n].dataSet&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>The hash id of the data set that contains the data element you&amp;rsquo;re integrating with. If this is left undefined, the data element will appear in all data sets.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>visible&lt;/code>&lt;/td>
&lt;td>&lt;code>boolean&lt;/code>&lt;/td>
&lt;td>Whether the target is visible in the targets page. &lt;strong>Default: true&lt;/strong>&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>aggregate&lt;/code>&lt;/td>
&lt;td>&lt;code>boolean&lt;/code>&lt;/td>
&lt;td>As of 3.9, defines whether the target will be displayed on the TargetAggregates page&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="utils">Utils&lt;/h2>
&lt;p>Utility functions in the Core Framework can make common tasks much easier. These are available only for Tasks and Targets. To use the function call &lt;code>Utils.&amp;lt;function-name&amp;gt;(&amp;lt;params&amp;gt;)&lt;/code>, for example &lt;code>Utils.addDate(report.reported_date, 10)&lt;/code>.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Name&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>isTimely(date, event)&lt;/code>&lt;/td>
&lt;td>Returns true if the given date is after the start date and before the end date of the event.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>addDate(date, days)&lt;/code>&lt;/td>
&lt;td>Returns a new Date set to midnight the given number of days after the given date. If no date is given the date defaults to today.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>getLmpDate(doc)&lt;/code>&lt;/td>
&lt;td>Attempts to work out the LMP from the given doc. If no LMP is given it defaults to four weeks before the reported_date.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>getSchedule(name)&lt;/code>&lt;/td>
&lt;td>Returns the task schedule with the given name from the configuration.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>getMostRecentTimestamp(reports, form)&lt;/code>&lt;/td>
&lt;td>Returns the reported_date of the most recent of the reports with form ID matching the given form.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>getMostRecentReport(reports, form)&lt;/code>&lt;/td>
&lt;td>Like &lt;code>getMostRecentTimestamp&lt;/code> but returns the report, not just the reported_date.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>isFormSubmittedInWindow(reports, form, start, end)&lt;/code>&lt;/td>
&lt;td>Returns true if any of the given reports are for the given form and were reported after start and before end.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>isFirstReportNewer(firstReport, secondReport)&lt;/code>&lt;/td>
&lt;td>Returns true if the firstReport was reported before the secondReport.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>isDateValid(date)&lt;/code>&lt;/td>
&lt;td>Returns true if the given date is a validate JavaScript Date.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>now()&lt;/code>&lt;/td>
&lt;td>Returns the current Date.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>MS_IN_DAY&lt;/code>&lt;/td>
&lt;td>A constant for the number of milliseconds in a day.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>Please open &lt;a href="https://github.com/medic/cht-core/issues/new">an issue&lt;/a> if you&amp;rsquo;d like other functions included.&lt;/p>
&lt;h2 id="nools-extras">Nools Extras&lt;/h2>
&lt;p>Helper variables and functions can be defined in &lt;code>nools-extras.js&lt;/code>, which is shared by both &lt;code>tasks.js&lt;/code> and &lt;code>targets.js&lt;/code>. The following are global variables that can be used:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Variable&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>c.contact&lt;/code>&lt;/td>
&lt;td>The contact&amp;rsquo;s doc. All contacts have &lt;code>type&lt;/code> of either &lt;code>person&lt;/code> or &lt;code>place&lt;/code>.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>c.reports&lt;/code>&lt;/td>
&lt;td>An array of all the reports submitted about the contact.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>console&lt;/code>&lt;/td>
&lt;td>Useful for outputting &lt;em>debugging&lt;/em> statements. Should not be used in production code.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>Utils&lt;/code>&lt;/td>
&lt;td>Useful functions across projects are available, and describe in the Utils section.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="code-samples">Code Samples&lt;/h2>
&lt;p>This sample &lt;code>targets.js&lt;/code> generates three widgets, and uses functions written in the &lt;code>targets-extras.js&lt;/code> file.&lt;/p>
&lt;h3 id="targetsjs-1">&lt;code>targets.js&lt;/code>&lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-js" data-lang="js">&lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">isHealthyDelivery&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">countReportsSubmittedInWindow&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">require&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;./targets-extras&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#000">module&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">exports&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">// BIRTHS THIS MONTH
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;births-this-month&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">type&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;count&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">icon&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;infant&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">goal&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">-&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">translation_key&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;targets.births.title&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">subtitle_translation_key&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;targets.this_month.subtitle&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">appliesTo&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;reports&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">appliesIf&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">isHealthyDelivery&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">date&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;reported&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">// % DELIVERIES ALL TIME WITH 1+ VISITS
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;delivery-with-min-1-visit&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">type&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;percent&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">icon&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;nurse&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">goal&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">100&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">translation_key&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;targets.delivery_1_visit.title&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">subtitle_translation_key&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;targets.all_time.subtitle&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">appliesTo&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;reports&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">idType&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;report&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">appliesIf&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">isHealthyDelivery&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">passesIf&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">var&lt;/span> &lt;span style="color:#000">visits&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">countReportsSubmittedInWindow&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">reports&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">antenatalForms&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">reported_date&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">-&lt;/span> &lt;span style="color:#000">MAX_DAYS_IN_PREGNANCY&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">*&lt;/span>&lt;span style="color:#000">MS_IN_DAY&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">reported_date&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">visits&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000">date&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;now&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;2-home-visits-per-family&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">icon&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;home-visit&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">type&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;percent&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">goal&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">100&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">translation_key&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">`target.2-home-visits-per-family`&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">context&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;user.role === &amp;#34;chw&amp;#34;&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">date&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;reported&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">appliesTo&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;contacts&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">appliesToType&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;person&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">idType&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">contact&lt;/span> &lt;span style="color:#000;font-weight:bold">=&amp;gt;&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">// Determines the target ids which will be in the group.
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// eg. &amp;#34;family1~2000-02-15&amp;#34; and &amp;#34;family1~2000-02-16&amp;#34;
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000">householdVisitDates&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#204a87;font-weight:bold">new&lt;/span> &lt;span style="color:#000">Set&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">reports&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">map&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">report&lt;/span> &lt;span style="color:#000;font-weight:bold">=&amp;gt;&lt;/span> &lt;span style="color:#000">toDateString&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">report&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">reported_date&lt;/span>&lt;span style="color:#000;font-weight:bold">)));&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000">familyId&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">parent&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">_id&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#204a87">Array&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">from&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">householdVisitDates&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>&lt;span style="color:#000">map&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">date&lt;/span> &lt;span style="color:#000;font-weight:bold">=&amp;gt;&lt;/span> &lt;span style="color:#4e9a06">`&lt;/span>&lt;span style="color:#4e9a06">${&lt;/span>&lt;span style="color:#000">familyId&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>&lt;span style="color:#4e9a06">~&lt;/span>&lt;span style="color:#4e9a06">${&lt;/span>&lt;span style="color:#000">date&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>&lt;span style="color:#4e9a06">`&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000">groupBy&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">contact&lt;/span> &lt;span style="color:#000;font-weight:bold">=&amp;gt;&lt;/span> &lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">parent&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">_id&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">passesIfGroupCount&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">gte&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">2&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="targets-extrasjs">&lt;code>targets-extras.js&lt;/code>&lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-js" data-lang="js">&lt;span style="color:#000">module&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">exports&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">isHealthyDelivery&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">form&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">===&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;D&amp;#39;&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">||&lt;/span>
&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">form&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">===&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;delivery&amp;#39;&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">fields&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">pregnancy_outcome&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">===&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;healthy&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000">countReportsSubmittedInWindow&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">reports&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">form&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">start&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">end&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">var&lt;/span> &lt;span style="color:#000">reportsFound&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;span style="color:#000">reports&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">forEach&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">if&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">form&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">indexOf&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">form&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;=&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">if&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">reported_date&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;gt;=&lt;/span> &lt;span style="color:#000">start&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">reported_date&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;=&lt;/span> &lt;span style="color:#000">end&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">reportsFound&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">++&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">});&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">reportsFound&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">};&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="build">Build&lt;/h2>
&lt;p>To build your targets into your app, you must compile them into app-settings, then upload them to your instance.&lt;/p>
&lt;p>&lt;code>medic-conf --local compile-app-settings backup-app-settings upload-app-settings&lt;/code>&lt;/p></description></item><item><title>Apps: tasks.js</title><link>https://docs.communityhealthtoolkit.org/beta/apps/reference/tasks/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/reference/tasks/</guid><description>
&lt;p>&lt;img src="task-with-description.png" alt="task">&lt;/p>
&lt;p>Tasks are configured in the &lt;code>tasks.js&lt;/code> file. This file is a JavaScript module which defines an array of objects conforming to the Task schema detailed below. When defining tasks, all the data about contacts on the device (both people and places) along with all their reports are available. Tasks are available only for users of type &amp;ldquo;restricted to their place&amp;rdquo;. Tasks can pull in fields from reports and pass data as inputs to the form that opens when the task is selected, enabling richer user experiences.&lt;/p>
&lt;p>&lt;em>See Also:&lt;/em> &lt;a href=https://docs.communityhealthtoolkit.org/beta/apps/features/tasks/#>Tasks Overview&lt;/a>&lt;/p>
&lt;h2 id="tasksjs">&lt;code>tasks.js&lt;/code>&lt;/h2>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>property&lt;/th>
&lt;th>type&lt;/th>
&lt;th>description&lt;/th>
&lt;th>required&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>name&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>A unique identifier for the task. Used for querying task completeness.&lt;/td>
&lt;td>yes, unique&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>icon&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>The icon to show alongside the task. Should correspond with a value defined in &lt;code>resources.json&lt;/code>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>title&lt;/code>&lt;/td>
&lt;td>&lt;code>translation key&lt;/code>&lt;/td>
&lt;td>The title of the task (labeled above).&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>appliesTo&lt;/code>&lt;/td>
&lt;td>&lt;code>'contacts'&lt;/code> or &lt;code>'reports'&lt;/code>&lt;/td>
&lt;td>Do you want to emit one task per report, or one task per contact? This attribute controls the behavior of other properties herein.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>appliesIf&lt;/code>&lt;/td>
&lt;td>&lt;code>function(contact, report)&lt;/code>&lt;/td>
&lt;td>If &lt;code>appliesTo: 'contacts'&lt;/code>, this function is invoked once per contact and &lt;code>report&lt;/code> is undefined. If &lt;code>appliesTo: 'reports'&lt;/code>, this function is invoked once per report. Return true if the task should appear for the given documents.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>appliesToType&lt;/code>&lt;/td>
&lt;td>&lt;code>string[]&lt;/code>&lt;/td>
&lt;td>Filters the contacts or reports for which &lt;code>appliesIf&lt;/code> will be evaluated. If &lt;code>appliesTo: 'reports'&lt;/code>, this is an array of form codes. If &lt;code>appliesTo: 'contacts'&lt;/code>, this is an array of contact types. For example, &lt;code>['person']&lt;/code> or &lt;code>['clinic', 'health_center']&lt;/code>. For example, &lt;code>['pregnancy']&lt;/code> or &lt;code>['P', 'pregnancy']&lt;/code>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>contactLabel&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code> or &lt;code>function(contact, report)&lt;/code>&lt;/td>
&lt;td>Controls the label describing the subject of the task. Defaults to the name of the contact (&lt;code>contact.contact.name&lt;/code>).&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>resolvedIf&lt;/code>&lt;/td>
&lt;td>&lt;code>function(contact, report, event, dueDate)&lt;/code>&lt;/td>
&lt;td>Return true to mark the task as &amp;ldquo;resolved&amp;rdquo;. A resolved task uses memory on the phone, but is not displayed.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>events&lt;/code>&lt;/td>
&lt;td>&lt;code>object[]&lt;/code>&lt;/td>
&lt;td>An event is used to specify the timing of the task.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>events[n].id&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>A descriptive identifier. Used for querying task completeness.&lt;/td>
&lt;td>yes, unique&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>events[n].days&lt;/code>&lt;/td>
&lt;td>&lt;code>integer&lt;/code>&lt;/td>
&lt;td>Number of days after the doc&amp;rsquo;s &lt;code>reported_date&lt;/code> that the event is due&lt;/td>
&lt;td>yes, if &lt;code>dueDate&lt;/code> is not set&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>events[n].dueDate&lt;/code>&lt;/td>
&lt;td>&lt;code>function(event, contact, report)&lt;/code>&lt;/td>
&lt;td>Returns a &lt;code>Date&lt;/code> object for the day when this event is due.&lt;/td>
&lt;td>yes, if &lt;code>days&lt;/code> is not set&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>events[n].start&lt;/code>&lt;/td>
&lt;td>&lt;code>integer&lt;/code>&lt;/td>
&lt;td>Number of days to show the task before it is due.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>events[n].end&lt;/code>&lt;/td>
&lt;td>&lt;code>integer&lt;/code>&lt;/td>
&lt;td>Number of days to show the task after it is due.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>actions&lt;/code>&lt;/td>
&lt;td>&lt;code>object[]&lt;/code>&lt;/td>
&lt;td>The actions (forms) that a user can access after clicking on a task. If you put multiple forms here, the user will see a task summary screen where they can select which action they would like to complete.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>actions[n].type&lt;/code>&lt;/td>
&lt;td>&lt;code>'report'&lt;/code> or &lt;code>'contact'&lt;/code>&lt;/td>
&lt;td>When &lt;code>'report'&lt;/code>, the action opens the given form. When &lt;code>'contact'&lt;/code>, the action redirects to a contact&amp;rsquo;s profile page. Defaults to &amp;lsquo;report&amp;rsquo;.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>actions[n].form&lt;/code>&lt;/td>
&lt;td>&lt;code>string&lt;/code>&lt;/td>
&lt;td>The code of the form that should open when you select the action.&lt;/td>
&lt;td>yes&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>actions[n].label&lt;/code>&lt;/td>
&lt;td>&lt;code>translation key&lt;/code>&lt;/td>
&lt;td>The label that should appear on the task summary screen if multiple actions are present.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>actions[n].modifyContent&lt;/code>&lt;/td>
&lt;td>&lt;code>function (content, contact, report)&lt;/code>&lt;/td>
&lt;td>Set the values on the content object to control the data which will be passed as &lt;code>inputs&lt;/code> to the form which opens when the action is selected.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>priority&lt;/code>&lt;/td>
&lt;td>&lt;code>object&lt;/code> or &lt;code>function(contact, report)&lt;/code> returning object of same schema&lt;/td>
&lt;td>Controls the &amp;ldquo;high risk&amp;rdquo; line seen above.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>priority.level&lt;/code>&lt;/td>
&lt;td>&lt;code>high&lt;/code> or &lt;code>medium&lt;/code>&lt;/td>
&lt;td>Tasks that are &lt;code>high&lt;/code> will display a high risk icon with the task. Default: &lt;code>medium&lt;/code>.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>priority.label&lt;/code>&lt;/td>
&lt;td>&lt;code>translation key&lt;/code>&lt;/td>
&lt;td>Text shown with the task associated to the risk level.&lt;/td>
&lt;td>no&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="utils">Utils&lt;/h2>
&lt;p>Utility functions in the Core Framework can make common tasks much easier. These are available only for Tasks and Targets. To use the function call &lt;code>Utils.&amp;lt;function-name&amp;gt;(&amp;lt;params&amp;gt;)&lt;/code>, for example &lt;code>Utils.addDate(report.reported_date, 10)&lt;/code>.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Name&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>isTimely(date, event)&lt;/code>&lt;/td>
&lt;td>Returns true if the given date is after the start date and before the end date of the event.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>addDate(date, days)&lt;/code>&lt;/td>
&lt;td>Returns a new Date set to midnight the given number of days after the given date. If no date is given the date defaults to today.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>getLmpDate(doc)&lt;/code>&lt;/td>
&lt;td>Attempts to work out the LMP from the given doc. If no LMP is given it defaults to four weeks before the reported_date.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>getSchedule(name)&lt;/code>&lt;/td>
&lt;td>Returns the task schedule with the given name from the configuration.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>getMostRecentTimestamp(reports, form)&lt;/code>&lt;/td>
&lt;td>Returns the reported_date of the most recent of the reports with form ID matching the given form.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>getMostRecentReport(reports, form)&lt;/code>&lt;/td>
&lt;td>Like &lt;code>getMostRecentTimestamp&lt;/code> but returns the report, not just the reported_date.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>isFormSubmittedInWindow(reports, form, start, end)&lt;/code>&lt;/td>
&lt;td>Returns true if any of the given reports are for the given form and were reported after start and before end.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>isFirstReportNewer(firstReport, secondReport)&lt;/code>&lt;/td>
&lt;td>Returns true if the firstReport was reported before the secondReport.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>isDateValid(date)&lt;/code>&lt;/td>
&lt;td>Returns true if the given date is a validate JavaScript Date.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>now()&lt;/code>&lt;/td>
&lt;td>Returns the current Date.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>MS_IN_DAY&lt;/code>&lt;/td>
&lt;td>A constant for the number of milliseconds in a day.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>Please open &lt;a href="https://github.com/medic/cht-core/issues/new">an issue&lt;/a> if you&amp;rsquo;d like other functions included.&lt;/p>
&lt;h2 id="nools-extras">Nools Extras&lt;/h2>
&lt;p>Helper variables and functions can be defined in &lt;code>nools-extras.js&lt;/code>, which is shared by both &lt;code>tasks.js&lt;/code> and &lt;code>targets.js&lt;/code>. The following are global variables that can be used:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Variable&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>c.contact&lt;/code>&lt;/td>
&lt;td>The contact&amp;rsquo;s doc. All contacts have &lt;code>type&lt;/code> of either &lt;code>person&lt;/code> or &lt;code>place&lt;/code>.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>c.reports&lt;/code>&lt;/td>
&lt;td>An array of all the reports submitted about the contact.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>console&lt;/code>&lt;/td>
&lt;td>Useful for outputting &lt;em>debugging&lt;/em> statements. Should not be used in production code.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>Utils&lt;/code>&lt;/td>
&lt;td>Useful functions across projects are available, and describe in the Utils section.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="code-samples">Code samples&lt;/h2>
&lt;h3 id="basic-task">Basic task&lt;/h3>
&lt;p>This sample &lt;code>tasks.js&lt;/code> generates two postnatal-visit tasks for each delivery form. The tasks are due 7 and 14 days after the delivery report was submitted. Each task is displayed for 2 days before the due date and 2 days after the due date.&lt;/p>
&lt;h4 id="tasksjs-1">tasks.js&lt;/h4>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-js" data-lang="js">&lt;span style="color:#000">module&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">exports&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">icon&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;mother-child&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">title&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;task.postnatal_followup&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">appliesTo&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;reports&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">appliesToType&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;delivery&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#000">actions&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">form&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;postnatal_visit&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#000">events&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">days&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">7&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">start&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">end&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">days&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">14&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">start&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">end&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">];&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="tasks-with-functions">Tasks with functions&lt;/h3>
&lt;p>These samples show more complex tasks which use functions kepts in a separate &lt;code>nools-extras.js&lt;/code> file&lt;/p>
&lt;h4 id="tasksjs-2">&lt;code>tasks.js&lt;/code>&lt;/h4>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-js" data-lang="js">&lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000">extras&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">require&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;./nools-extras&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">);&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">const&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">isFormFromArraySubmittedInWindow&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000">extras&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;span style="color:#000">module&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">exports&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">// PNC TASK 1: If a home delivery, needs clinic tasks
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">icon&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;mother-child&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">title&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">locale&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;en&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">content&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;Postnatal visit needed&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#000">appliesTo&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;reports&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">appliesToType&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;D&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;delivery&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#000">appliesIf&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">isCoveredByUseCase&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;pnc&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&amp;amp;&lt;/span>
&lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">fields&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&amp;amp;&lt;/span>
&lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">fields&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">delivery_code&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;amp;&amp;amp;&lt;/span>
&lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">fields&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">delivery_code&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">toUpperCase&lt;/span>&lt;span style="color:#000;font-weight:bold">()&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">!==&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;F&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000">actions&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[{&lt;/span>
&lt;span style="color:#000">form&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;postnatal_visit&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">// Pass content that will be used within the task form
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000">modifyContent&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">content&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">content&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">delivery_place&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;home&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}],&lt;/span>
&lt;span style="color:#000">events&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">days&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">start&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">end&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">4&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#000">priority&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">level&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;high&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">label&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">locale&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;en&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">content&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;Home Birth&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000">resolvedIf&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">event&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">dueDate&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">// Resolved if there a visit report received in time window or a newer pregnancy
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">reported_date&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span> &lt;span style="color:#000">extras&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">getNewestDeliveryTimestamp&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">||&lt;/span>
&lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">reported_date&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">&amp;lt;&lt;/span> &lt;span style="color:#000">extras&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">getNewestPregnancyTimestamp&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">||&lt;/span>
&lt;span style="color:#000">isFormFromArraySubmittedInWindow&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">reports&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">extras&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">postnatalForms&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">Utils&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">addDate&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">dueDate&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">-&lt;/span>&lt;span style="color:#000">event&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">start&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>&lt;span style="color:#000">getTime&lt;/span>&lt;span style="color:#000;font-weight:bold">(),&lt;/span>
&lt;span style="color:#000">Utils&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">addDate&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">dueDate&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">event&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">end&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>&lt;span style="color:#000">getTime&lt;/span>&lt;span style="color:#000;font-weight:bold">());&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">// Option 1a: Place-based task: Family survey when place is created, then every 6 months
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">icon&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;family&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">title&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;task.family_survey.title&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">appliesTo&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;contacts&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">appliesToType&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;clinic&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#000">actions&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">form&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;family_survey&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#000">events&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;family-survey&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">days&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">start&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">end&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">14&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#000">resolvedIf&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">event&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">dueDate&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">// Resolved if there a family survey received in time window
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">isFormFromArraySubmittedInWindow&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">reports&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;family_survey&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">Utils&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">addDate&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">dueDate&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">-&lt;/span>&lt;span style="color:#000">event&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">start&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>&lt;span style="color:#000">getTime&lt;/span>&lt;span style="color:#000;font-weight:bold">(),&lt;/span>
&lt;span style="color:#000">Utils&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">addDate&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">dueDate&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">event&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">end&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>&lt;span style="color:#000">getTime&lt;/span>&lt;span style="color:#000;font-weight:bold">());&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">// Regular check for infants
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">icon&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;infant&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">title&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;task.infant.title&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">appliesTo&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;contacts&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">appliesToType&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;person&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#000">actions&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">form&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;infant_assessment&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#000">events&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;infant_asssessment-q1&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">days&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">91&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">start&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">7&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">end&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">14&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;infant_asssessment-q2&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">days&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">182&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">start&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">7&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">end&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">14&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;infant_asssessment-q3&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">days&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">273&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">start&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">7&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">end&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">14&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;infant_asssessment-q4&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">days&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">365&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">start&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">7&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">end&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">14&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">// Option 2: Place-based task: Family survey every 6 months
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">icon&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;family&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">title&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;task.family_survey.title&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">appliesTo&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;contacts&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">appliesToType&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;clinic&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#000">appliesIf&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">extras&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">needsFamilySurvey&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// function returns true if family doesn&amp;#39;t have survey in previous 6 months
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000">actions&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span> &lt;span style="color:#000">form&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;family_survey&amp;#39;&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#000">events&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;family-survey&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">start&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">end&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">14&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">dueDate&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">extras&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">getNextFamilySurveyDate&lt;/span> &lt;span style="color:#8f5902;font-style:italic">// function gets expected date of next family survey
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">}&lt;/span> &lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#000">resolvedIf&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">r&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">event&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">dueDate&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">// Resolved if there a family survey received in time window
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#204a87;font-weight:bold">return&lt;/span> &lt;span style="color:#000">isFormFromArraySubmittedInWindow&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">reports&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;family_survey&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">Utils&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">addDate&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">dueDate&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">-&lt;/span>&lt;span style="color:#000">event&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">start&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>&lt;span style="color:#000">getTime&lt;/span>&lt;span style="color:#000;font-weight:bold">(),&lt;/span>
&lt;span style="color:#000">Utils&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">addDate&lt;/span>&lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">dueDate&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">event&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">end&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">+&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">).&lt;/span>&lt;span style="color:#000">getTime&lt;/span>&lt;span style="color:#000;font-weight:bold">());&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="nools-extrasjs">&lt;code>nools-extras.js&lt;/code>&lt;/h4>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-js" data-lang="js">&lt;span style="color:#000">module&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">exports&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">isCoveredByUseCase&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">usecase&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">// ...
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000">getNewestDeliveryTimestamp&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">// ...
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000">getNewestPregnancyTimestamp&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">c&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">// ...
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000">isFormFromArraySubmittedInWindow&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">function&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">reports&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">formsArray&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">startTime&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span> &lt;span style="color:#000">endTime&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#8f5902;font-style:italic">// ...
&lt;/span>&lt;span style="color:#8f5902;font-style:italic">&lt;/span> &lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">};&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="build">Build&lt;/h2>
&lt;p>To build your tasks into your app, you must compile them into app-settings, then upload them to your instance.&lt;/p>
&lt;p>&lt;code>medic-conf --local compile-app-settings backup-app-settings upload-app-settings&lt;/code>&lt;/p></description></item><item><title>Apps: Building Workflows</title><link>https://docs.communityhealthtoolkit.org/beta/apps/concepts/workflows/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/concepts/workflows/</guid><description>
&lt;p>Workflows can be defined within apps built with the Core Framework to connect actions and data with people. Forms are the main building block of tasks and messaging workflows, and are useful in creating reminders for follow-up visits or referrals.&lt;/p>
&lt;h2 id="tasks">Tasks&lt;/h2>
&lt;figure class="right col-6 col-lg-3">&lt;a href="tasks.png">
&lt;img src="tasks.png"/> &lt;/a>
&lt;/figure>
&lt;p>Tasks within the app can drive a workflow, ensuring that the right actions are taken for people at the right time. Tasks indicate a recommended action to the user. They indicate who the user should perform the action with, and the recommended timeframe of that action. When the user taps the task, they are directed to a form where the details of the action are captured.&lt;/p>
&lt;p>Tasks can be triggered by a set of conditions, such as contact details or submitted reports. Tasks are accessible in the Tasks tab and the profile in the Contact tab, and initiate a follow up action to complete a form. More information on building app workflows is available in the &lt;a href="">Tasks section&lt;/a>.&lt;/p>
&lt;p>Data submitted in one form can generate several tasks at once, for example, multiple ANC visits following one pregnancy registration. Some workflows involve a series of sequential forms and tasks, such as a child health assessment form, a follow up task scheduled 48 hours later, a referral form (only if the child’s condition hasn’t improved), and then a referral follow up task. Tasks are accessible on the Tasks tab, as well as the Tasks section of profiles.&lt;/p>
&lt;p>&lt;em>See Also:&lt;/em> &lt;a href=https://docs.communityhealthtoolkit.org/beta/apps/reference/tasks/#>Defining Tasks&lt;/a>&lt;/p>
&lt;h2 id="sms-messaging">SMS Messaging&lt;/h2>
&lt;figure class="right col-6 col-lg-3">&lt;a href="messaging.png">
&lt;img src="messaging.png"/> &lt;/a>
&lt;/figure>
&lt;p>Workflows can include notifications and interactions with CHWs, nurses, supervisors, and patients via SMS. A report can trigger SMS messages to be sent immediately or upon a set schedule. Responses via SMS or the app can update the workflows.&lt;/p>
&lt;h2 id="interoperability">Interoperability&lt;/h2>
&lt;p>Workflows can incorporate other digital tools, such as a facility-based electronic medical record system for referral workflows. New contacts or reports can trigger an interoperabilty workflow using the &lt;a href="">outbound push&lt;/a> feature. Data can be received as reports using the &lt;a href="https://github.com/medic/cht-core/tree/master/api">CHT API&lt;/a>&lt;/p></description></item><item><title>Apps: Configurable Hierarchies</title><link>https://docs.communityhealthtoolkit.org/beta/apps/concepts/hierarchy/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/concepts/hierarchy/</guid><description>
&lt;p>The Core Framework requires a hierarchy to organize the information in the app. It is often based on the hierarchy of a health system within a particular geographic region.&lt;/p>
&lt;p>Large deployment sites often need three or more levels of place hierarchy, while some small sites need fewer than three levels. For this reason, the Core Framework’s information hierarchies are configurable to meet a users needs.&lt;/p>
&lt;p>A user logging into their app will see a custom set of people, tasks, reports, and analytics based on the hierarchy level that they belong to. This allows appropriate data sharing based on the role of the user in the health system.&lt;/p>
&lt;p>The information hierarchy is configured in the administration console. The hierarchy levels can be given different titles depending on a particular health system’s program or reporting structures.&lt;/p>
&lt;h3 id="places">Places&lt;/h3>
&lt;p>This is an example of a simple hierarchy that includes a CHW Supervisor area, CHW area, and families as levels which serve as “places” or units of organizing people.&lt;/p>
&lt;p>&lt;img src="hierarchy-with-places.png" alt="hierarchy-with-places.png">&lt;/p>
&lt;p>User roles can be assigned to log in at any of these levels. For example, it would be customary for a CHW to log in at the CHW Area level and view the families, and below that the people, i.e. patients or family members, who belong there.&lt;/p>
&lt;h3 id="people">People&lt;/h3>
&lt;p>The hierarchy can be modeled after the health system, health program and/or the community. All people are associated with a place and these places can be associated to each other.&lt;/p>
&lt;p>For example, a Family Member is part of a Family. A Family and CHWs are part of a CHW Area. A Family Member, a Family, and CHWs are part of a CHW Supervisor Area.&lt;/p>
&lt;p>&lt;img src="hierarchy-with-people.png" alt="hierarchy-with-people.png">&lt;/p>
&lt;p>Additional hierarchy levels may be added as needed and each section of the hierarchy is configurable. For instance, many large projects have unbalanced hierarchies, which is to say, some parts of the hierarchy have more or different layers than others.
The Admin level operates outside of the hierarchy structure and enables access to all levels and people within the hierarchy.&lt;/p></description></item><item><title>Apps: Users</title><link>https://docs.communityhealthtoolkit.org/beta/apps/concepts/users/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/concepts/users/</guid><description>
&lt;p>Apps built with the Core Framework use roles and permissions to determine who has access to what data. User roles are general categories you can use to assign a collection of broad permissions to users. There are two classes of roles: online and offline. Generally speaking, CHWs are usually offline users, while managers and nurses are usually online users. SMS users do not use the app, and thus do not have a user role.&lt;/p>
&lt;h2 id="roles">Roles&lt;/h2>
&lt;p>Differing levels of access and permissions are assigned to each persona. A user role is created to provide them with access to the information they need. Offline and online access, storage limitations, and data privacy are taken into account.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th align="left">Persona&lt;/th>
&lt;th align="left">Hierarchy&lt;/th>
&lt;th align="left">Device&lt;/th>
&lt;th align="left">Permissions&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td align="left">Program Officer&lt;/td>
&lt;td align="left">Logs in as Admin&lt;/td>
&lt;td align="left">Computer&lt;/td>
&lt;td align="left">Admin users, usually Program Officers, are online-only admin users not associated to a particular level. They have access to all people, places, and records in the app, but since they are online-only users, they cannot view any tasks or targets.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td align="left">CHW Supervisors&lt;/td>
&lt;td align="left">Logs in at Health Facility level&lt;/td>
&lt;td align="left">Tablet&lt;/td>
&lt;td align="left">User at this level have online and offline access to view CHWs, fill out reports about them, and view tasks and targets related to them. Due to storage limitations, they aren’t able to view households or submit reports and review tasks and targets about them.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td align="left">CHWs&lt;/td>
&lt;td align="left">Logs in at CHW Area level&lt;/td>
&lt;td align="left">Phone&lt;/td>
&lt;td align="left">Users at this level have online and offline access to view households and family members, submit reports about them, and view tasks and targets about them.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td align="left">Family members&lt;/td>
&lt;td align="left">Registered at Household level, does not log in&lt;/td>
&lt;td align="left">Messaging&lt;/td>
&lt;td align="left">Family members might include fathers, mothers, children, and other adults. The program model determines which family members should be registered in the app. However, they are not users of the app, and do not log in themselves.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="online-users">Online Users&lt;/h3>
&lt;p>Online roles are for users who need access to a lot of data and need to maintain the system or update system settings. An internet connection is required.&lt;/p>
&lt;h3 id="offline-users">Offline Users&lt;/h3>
&lt;p>Offline roles are for users who need to be able to access data on the go in the field, don’t need to maintain the system, and don’t have a reliable internet connection. All the data they have access to will be synced to their device.&lt;/p>
&lt;h2 id="permissions">Permissions&lt;/h2>
&lt;figure class="right col-6 col-lg-3">&lt;a href="user-permissions.png">
&lt;img src="user-permissions.png"/> &lt;/a>
&lt;/figure>
&lt;p>User Permissions are settings that can be individually toggled on or off to allow users with a particular Role to do a certain action or see a certain thing. CHT app developers and administrators can add as many User Roles as needed to grant permissions to different groups of users.&lt;/p>
&lt;p>Viewing permissions determine which page tabs a user sees in the app and which types of data they do and don’t have access to. User action permissions include who can create (e.g., create new users), who can delete (e.g., delete reports), who can edit (e.g., edit profiles), and who can export (e.g., export server logs).&lt;/p></description></item><item><title>Apps: Interoperability</title><link>https://docs.communityhealthtoolkit.org/beta/apps/concepts/interoperability/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/concepts/interoperability/</guid><description>
&lt;p>&lt;em>Interoperability&lt;/em> and &lt;em>Integration&lt;/em> are often used interchangeably but mean different things. &lt;a href="https://www.linkedin.com/pulse/lets-talk-interoperability-vs-integration-mike-fleck">This&lt;/a> article offers a useful delineation between the two.&lt;/p>
&lt;p>With &lt;strong>interoperability&lt;/strong>, systems work together, even if they weren’t designed specifically to work together, because standard communication protocol techniques are applied. Two (or more) systems that weren&amp;rsquo;t designed to be interoperable require &lt;strong>integration&lt;/strong>.&lt;/p>
&lt;p>&lt;a href="https://ohie.org/">OpenHIE&lt;/a>, &lt;a href="https://www.hl7.org/fhir/index.html">HL7 FHIR&lt;/a>, &lt;a href="https://www.who.int/classifications/icd/factsheet/en/">ICD-10&lt;/a>, &lt;a href="https://loinc.org/">LOINC&lt;/a>, etc&amp;hellip; are examples of healthcare related protocols and standards used to achieve interoperability. CHT Core can be configured to support many of these standards and also exchange data with other systems through &lt;em>integrations&lt;/em>.&lt;/p></description></item><item><title>Apps: Prerequisites for App Development</title><link>https://docs.communityhealthtoolkit.org/beta/apps/concepts/prerequisites/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/concepts/prerequisites/</guid><description>
&lt;p>There are no set prerequisites for users of CHT apps, yet the following are helpful for developing CHT applications.&lt;/p>
&lt;h2 id="test-instance">Test Instance&lt;/h2>
&lt;p>To build your own application using the Core Framework you will need an instance set up for testing. You can set up a local instance by &lt;a href="https://github.com/medic/cht-core/blob/master/INSTALL.md">following these instructions&lt;/a>).&lt;/p>
&lt;h2 id="build-tool">Build tool&lt;/h2>
&lt;p>The build tool for applications using the Core Framework is &lt;code>medic-conf&lt;/code>. To set it up, follow the &lt;a href="https://github.com/medic/medic-conf/blob/master/README.md#installation">installation instructions&lt;/a>. To properly use the tool you will need your application files in set locations within a folder. Once you are set up with the basic file structure you can edit the files, and rebuild the application by compiling or converting components as needed, and uploading them to your test instance.&lt;/p>
&lt;h2 id="background-skills">Background skills&lt;/h2>
&lt;p>To build applications with the Core Framework the follow skills are helpful, ordered by importance:&lt;/p>
&lt;h3 id="xlsforms-and-xforms">XLSForms and XForms&lt;/h3>
&lt;p>Many workflows in your application, including completing tasks and creating contacts, will be generated using &lt;a href="https://opendatakit.github.io/xforms-spec/">ODK XForms&lt;/a>. Many app developers use XLSForms as an easier way to generate XForms. A strong knowledge of &lt;a href="http://xlsform.org/">XLSForm standard&lt;/a> is very useful in building your own application.&lt;/p>
&lt;h3 id="json">JSON&lt;/h3>
&lt;p>JSON (JavaScript Object Notation) is a format for storing structured text. Understanding JSON will help with minor modification of existing applications.&lt;/p>
&lt;h3 id="javascript">Javascript&lt;/h3>
&lt;p>Many key aspects are defined with JavaScript code and expressions. This includes managing profile pages, creating tasks and targets, and setting the condition for when to show forms. Unless you are only doing minor modification to an existing application, a good understanding of JavaScript is required.&lt;/p>
&lt;h3 id="couchdb">CouchDB&lt;/h3>
&lt;p>A free and open source NoSQL database we use to store all our data, configuration, and even the application code. CouchDB is really good at replication which is the process of sending the data to another database, such as PouchDB in the client application, and back again. Although building your own app using the Core Framework does not require knowledge or experience with CouchDB it can be useful to be familiar with general concepts as a document store.&lt;/p>
&lt;h3 id="sql">SQL&lt;/h3>
&lt;p>Although the application you build uses a NoSQL database, a parallel PostgreSQL database is available in the Core Framework to make querying data easier. Familiarity with SQL is needed to set up and query the database.&lt;/p></description></item><item><title>Apps: Configuration</title><link>https://docs.communityhealthtoolkit.org/beta/apps/guides/messaging/gateway/configuration/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/guides/messaging/gateway/configuration/</guid><description>
&lt;p>Medic gateway supports Android 4.1 and above. To have it up and fully working, follow the below steps.&lt;/p>
&lt;ul>
&lt;li>
&lt;p>Install the app from the playstore from this &lt;a href="https://play.google.com/store/apps/details?id=medic.gateway.alert&amp;amp;hl=en">link&lt;/a> or by searching &amp;ldquo;Medic Gateway&amp;rdquo; on the Android Playstore.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Open the app.
You will get a &lt;code>Warning:medic-gateway is not set as the default messaging app on this device&lt;/code> if you are installing the app for the first time or afresh. Select &lt;code>HELP ME CHANGE&lt;/code> and agree to the folloup system prompt about changing the default messaging app.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>If you&amp;rsquo;re configuring medic-gateway(v1.00 and above) for use with hosted medic, with a URL of e.g. &lt;code>https://myproject.dev.medicmobile.org&lt;/code> and a username of &lt;code>my_gateway_user&lt;/code> and a password of &lt;code>topSecret&lt;/code>, fill in the settings as follows:&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>Instance name: &lt;code>myproject [dev]&lt;/code> (if &lt;code>https://myproject.app...&lt;/code>, select &amp;lsquo;app&amp;rsquo;)&lt;br>
Username: &lt;code>my_gateway_user&lt;/code>&lt;br>
Password: &lt;code>topSecret&lt;/code>&lt;/p>
&lt;p>&lt;img src="gateway-config.png" alt="configuration">&lt;/p>
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">Note&lt;/h4>
If you&amp;rsquo;re configuring medic-gateway(v 0.62 and below - recommended if you have a non-medicmobile hosted instance) you will need to use the generic build of medic-gateway - links to download are &lt;a href="https://github.com/medic/medic-gateway/releases">here&lt;/a>. Find out the value for webapp URL from your tech support then configure as below
&lt;strong>WebappUrl&lt;/strong>: &lt;code>https://my_gateway_user:topSecret@myproject.some-subdomain.mydomain.org&lt;/code>
&lt;/div>
&lt;h1 id="power-saving">Power Saving&lt;/h1>
&lt;p>Care should be taken to disable all power-saving modes on the phone, as these may affect &lt;code>medic-gateway&lt;/code>'s ability to check in with the server regularly.&lt;/p>
&lt;p>On different versions of Android, power saving options may be found in different places. Sometimes they will be per-app, and sometimes phone-wide. Some places you might find the settings:&lt;/p>
&lt;ul>
&lt;li>&lt;code>WiFi &amp;gt; MORE &amp;gt; Keep WiFi on during sleep &amp;gt; ALWAYS (increases battery usage)&lt;/code>&lt;/li>
&lt;li>&lt;code>Smart Manager &amp;gt; Battery &amp;gt; App Power Saving &amp;gt; OFF&lt;/code>, or&lt;/li>
&lt;li>&lt;code>Smart Manager &amp;gt; Battery &amp;gt; App Power Saving &amp;gt; Detail &amp;gt; Medic Gateway &amp;gt; Disable&lt;/code>&lt;/li>
&lt;/ul></description></item><item><title>Apps: Phones</title><link>https://docs.communityhealthtoolkit.org/beta/apps/guides/messaging/gateway/phones/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/guides/messaging/gateway/phones/</guid><description>
&lt;p>In order to implement the Medic Mobile Standard package at your site, you will require an Android device for the Medic gateway. You may use an existing Android device and are not required to purchase a new one. However, please note that the Android device must always stay in your organization’s office or facility, and must be connected to stable and continuous internet at all times.&lt;/p>
&lt;p>Below is a list of recommended Android devices across a range of prices. You may find these in local mobile equipment stores as well as online through Amazon and other e-commerce sites.&lt;/p>
&lt;h2 id="low-cost-devices">Low-cost devices:&lt;/h2>
&lt;ul>
&lt;li>LG L60 *&lt;/li>
&lt;li>Samsung Duos *&lt;/li>
&lt;li>Lenovo A1000&lt;/li>
&lt;/ul>
&lt;h2 id="medium-cost-devices">Medium-cost devices:&lt;/h2>
&lt;ul>
&lt;li>Samsung Galaxy J5 *&lt;/li>
&lt;li>Huawei Honor 4x *&lt;/li>
&lt;li>Huawei G Play mini *&lt;/li>
&lt;li>Motorola Moto X play&lt;/li>
&lt;/ul>
&lt;h2 id="high-cost-devices">High-cost devices:&lt;/h2>
&lt;ul>
&lt;li>OnePlus 3T&lt;/li>
&lt;li>Nexus 6&lt;/li>
&lt;/ul>
&lt;p>*Devices marked with an asterisk have been tested and used by Medic Mobile and our partners before.&lt;/p>
&lt;p>Android OS: We also support Android version 4.1 (Jelly Beans) and above. Details of the Android history can be found &lt;a href="https://en.wikipedia.org/wiki/Android_version_history">here&lt;/a>.&lt;/p>
&lt;p>We highly recommend investing in devices that are medium to high-cost, and in models that are marked with an asterisk in the list above to ensure optimal efficiency.&lt;/p></description></item><item><title>Apps: Troubleshooting</title><link>https://docs.communityhealthtoolkit.org/beta/apps/guides/messaging/gateway/troubleshooting/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/guides/messaging/gateway/troubleshooting/</guid><description>
&lt;p>In a techlead heaven, we would have immeadiate physical access to gateway phones, but alas, most of the time we have to hand them over to the partner. Fortunately, comes this guide on debugging gateway problems.&lt;/p>
&lt;p>Follow the steps as below (if you don&amp;rsquo;t have physical access to the phone, start with step 2 i.e debug from the server side first)&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Make sure that the device:&lt;/p>
&lt;ol>
&lt;li>
&lt;p>Is connected to the internet. You can check this by opening any Browser app in the phone and going to &lt;code>https://google.com&lt;/code>.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Check if the instance name, instance type and &lt;code>gateway&lt;/code> user password are set correctly in the Gateway &lt;code>Settings&lt;/code> app screen.&lt;/p>
&lt;p>&lt;img src="settings_screen.png" alt="Settings Screen">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Has the latest Gateway version. Get the latest version by opening the Google Playstore, searching for &lt;code>Medic Gateway&lt;/code> and updating the existing app&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Medic Gatway should be set as the default app for SMS. To check, go to &lt;code>Settings&lt;/code> in the Gateway app. If Medic Gateway is not the default, you will be met with the below app screen. In that case, click &lt;code>Help me change&lt;/code>.&lt;/p>
&lt;p>&lt;img src="not_default.png" alt="Not Default">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>If messages are not going through to the server, in the &lt;code>To Webapp&lt;/code> tab, select some of them and press &lt;code>Retry&lt;/code> at the bottom and wait for about 5-10 minutes.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>If messages are not going through to the users, in the &lt;code>From Webapp&lt;/code> tab, select some of them and press &lt;code>Retry&lt;/code> at the bottom and wait for about 5-10 minutes.&lt;/p>
&lt;/li>
&lt;li>
&lt;p>In CDMA networks, there are operator issues where messages get to the users in chunks of around 160 characters when the message is too long. If this is the case, go to &lt;code>Settings&lt;/code> in the gateway screen and make sure you tick &lt;code>CDMA compatibility mode&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Check if the phone has adequate free space&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Restart the phone if no solution seems to work. Resetting the Adroind state sometimes resolves some persistent problems&lt;/p>
&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>
&lt;p>When attacking the problem from the phones end does not work, move on to the server and try to solve it from there. Maybe the server has a configuration issue which hinders the processing or the acceptance of the messages by &lt;code>Medic-Api&lt;/code>
Follow the steps:&lt;/p>
&lt;ol>
&lt;li>Navigate to &lt;code>/srv/storage/gardener/logs/ &lt;/code>&lt;/li>
&lt;li>Perform &lt;code>ls -lt&lt;/code> to arrange the log files in order of modified date. Note the concerned file which was last modified on the date you are investigating&lt;/li>
&lt;li>Pipe it to grep to get only SMS logs e.g &lt;code>grep api/sms medic_medic_medic-api4.log&lt;/code>. As below, note the errors and work from there.&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol>
&lt;pre>&lt;code>cd /srv/storage/gardener/logs/
ls -lt
grep api/sms medic_medic_medic-api4.log
&lt;/code>&lt;/pre>&lt;p>If the above steps don&amp;rsquo;t yield the problem, get the Android logs using the steps outlined in the doc &lt;a href="https://docs.communityhealthtoolkit.org/beta/core/guides/get-android-logs/">in this link&lt;/a>, note the make/model/android version their gateway handset is and escalate with those details to the PM/project techlead.&lt;/p>
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">Note&lt;/h4>
Insist on screenshots even for the most trivial things that partners insist they have performed as you asked. They are also good for giving you a mental image of what is happenning on the phone remotely.
&lt;/div></description></item><item><title>Apps:</title><link>https://docs.communityhealthtoolkit.org/beta/apps/reference/_partial_functions/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/reference/_partial_functions/</guid><description>
&lt;h2 id="utils">Utils&lt;/h2>
&lt;p>Utility functions in the Core Framework can make common tasks much easier. These are available only for Tasks and Targets. To use the function call &lt;code>Utils.&amp;lt;function-name&amp;gt;(&amp;lt;params&amp;gt;)&lt;/code>, for example &lt;code>Utils.addDate(report.reported_date, 10)&lt;/code>.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Name&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>isTimely(date, event)&lt;/code>&lt;/td>
&lt;td>Returns true if the given date is after the start date and before the end date of the event.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>addDate(date, days)&lt;/code>&lt;/td>
&lt;td>Returns a new Date set to midnight the given number of days after the given date. If no date is given the date defaults to today.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>getLmpDate(doc)&lt;/code>&lt;/td>
&lt;td>Attempts to work out the LMP from the given doc. If no LMP is given it defaults to four weeks before the reported_date.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>getSchedule(name)&lt;/code>&lt;/td>
&lt;td>Returns the task schedule with the given name from the configuration.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>getMostRecentTimestamp(reports, form)&lt;/code>&lt;/td>
&lt;td>Returns the reported_date of the most recent of the reports with form ID matching the given form.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>getMostRecentReport(reports, form)&lt;/code>&lt;/td>
&lt;td>Like &lt;code>getMostRecentTimestamp&lt;/code> but returns the report, not just the reported_date.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>isFormSubmittedInWindow(reports, form, start, end)&lt;/code>&lt;/td>
&lt;td>Returns true if any of the given reports are for the given form and were reported after start and before end.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>isFirstReportNewer(firstReport, secondReport)&lt;/code>&lt;/td>
&lt;td>Returns true if the firstReport was reported before the secondReport.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>isDateValid(date)&lt;/code>&lt;/td>
&lt;td>Returns true if the given date is a validate JavaScript Date.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>now()&lt;/code>&lt;/td>
&lt;td>Returns the current Date.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>MS_IN_DAY&lt;/code>&lt;/td>
&lt;td>A constant for the number of milliseconds in a day.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>Please open &lt;a href="https://github.com/medic/cht-core/issues/new">an issue&lt;/a> if you&amp;rsquo;d like other functions included.&lt;/p>
&lt;h2 id="nools-extras">Nools Extras&lt;/h2>
&lt;p>Helper variables and functions can be defined in &lt;code>nools-extras.js&lt;/code>, which is shared by both &lt;code>tasks.js&lt;/code> and &lt;code>targets.js&lt;/code>. The following are global variables that can be used:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>Variable&lt;/th>
&lt;th>Description&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>&lt;code>c.contact&lt;/code>&lt;/td>
&lt;td>The contact&amp;rsquo;s doc. All contacts have &lt;code>type&lt;/code> of either &lt;code>person&lt;/code> or &lt;code>place&lt;/code>.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>c.reports&lt;/code>&lt;/td>
&lt;td>An array of all the reports submitted about the contact.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>console&lt;/code>&lt;/td>
&lt;td>Useful for outputting &lt;em>debugging&lt;/em> statements. Should not be used in production code.&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>&lt;code>Utils&lt;/code>&lt;/td>
&lt;td>Useful functions across projects are available, and describe in the Utils section.&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table></description></item><item><title>Apps: Creating Additional Docs from App Forms</title><link>https://docs.communityhealthtoolkit.org/beta/apps/guides/forms/additional-docs/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/guides/forms/additional-docs/</guid><description>
&lt;p>In version 2.13.0 and higher, you can configure app forms to generate additional docs upon submission. You can create one or more docs using variations on the configuration described below. One case where this can be used is to register a newborn from a delivery report, as shown below. First, here is an overview of what you can do and how the configuration should look in XML:&lt;/p>
&lt;h2 id="extra-docs">Extra Docs&lt;/h2>
&lt;p>Extra docs can be added by defining structures in the model with the attribute&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-zsh" data-lang="zsh">db-doc&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;true&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">Note&lt;/h4>
You must have lower-case &lt;code>true&lt;/code> in your XLSform, even though Excel will default to &lt;code>TRUE&lt;/code>.
&lt;/div>
&lt;h3 id="example-form-model">Example Form Model&lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-xml" data-lang="xml">&lt;span style="color:#204a87;font-weight:bold">&amp;lt;data&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;root_prop_1&amp;gt;&lt;/span>val A&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/root_prop_1&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;other_doc&lt;/span> &lt;span style="color:#c4a000">db-doc=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;true&amp;#34;&lt;/span>&lt;span style="color:#204a87;font-weight:bold">&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;type&amp;gt;&lt;/span>whatever&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/type&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;other_prop&amp;gt;&lt;/span>val B&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/other_prop&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/other_doc&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/data&amp;gt;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="resulting-docs">Resulting Docs&lt;/h3>
&lt;p>Report (as before):&lt;/p>
&lt;pre>&lt;code>{
_id: '...',
_rev: '...',
type: 'report',
_attachments: { xml: ... ],
fields: {
root_prop_1: 'val A',
}
}
&lt;/code>&lt;/pre>&lt;p>Other doc:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;...&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_rev&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;...&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;whatever&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;other_prop&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;val B&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="linked-docs">Linked Docs&lt;/h2>
&lt;ul>
&lt;li>Linked docs can be referred to using the doc-ref attribute, with an xpath. This can be done at any point in the model, e.g.:&lt;/li>
&lt;/ul>
&lt;h3 id="example-form-model-1">Example Form Model&lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-xml" data-lang="xml">&lt;span style="color:#204a87;font-weight:bold">&amp;lt;sickness&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;sufferer&lt;/span> &lt;span style="color:#c4a000">db-doc-ref=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/sickness/new&amp;#34;&lt;/span>&lt;span style="color:#204a87;font-weight:bold">&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;new&lt;/span> &lt;span style="color:#c4a000">db-doc=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;true&amp;#34;&lt;/span>&lt;span style="color:#204a87;font-weight:bold">&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;type&amp;gt;&lt;/span>person&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/type&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;name&amp;gt;&lt;/span>Gómez&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/name&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;original_report&lt;/span> &lt;span style="color:#c4a000">db-doc-ref=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/sickness&amp;#34;&lt;/span>&lt;span style="color:#204a87;font-weight:bold">/&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/new&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/sickness&amp;gt;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="resulting-docs-1">Resulting Docs&lt;/h3>
&lt;p>Report:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;abc-123&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_rev&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;...&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;report&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;fields&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;sufferer&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;def-456&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Other doc:&lt;/p>
&lt;pre>&lt;code>{
&amp;quot;_id&amp;quot;: &amp;quot;def-456&amp;quot;,
&amp;quot;_rev&amp;quot;: &amp;quot;...&amp;quot;,
&amp;quot;type&amp;quot;: &amp;quot;person&amp;quot;,
&amp;quot;name&amp;quot;: &amp;quot;Gómez&amp;quot;,
&amp;quot;original_report&amp;quot;: &amp;quot;abc-123&amp;quot;
}
&lt;/code>&lt;/pre>&lt;h2 id="repeated-docs">Repeated Docs&lt;/h2>
&lt;ul>
&lt;li>Can have references to other docs, including the parent&lt;/li>
&lt;li>These currently cannot be linked from other docs, as no provision is made for indexing these docs&lt;/li>
&lt;/ul>
&lt;h3 id="example-form">Example Form&lt;/h3>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-xml" data-lang="xml">&lt;span style="color:#204a87;font-weight:bold">&amp;lt;thing&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;name&amp;gt;&lt;/span>Ab&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/name&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;related&lt;/span> &lt;span style="color:#c4a000">db-doc=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;true&amp;#34;&lt;/span>&lt;span style="color:#204a87;font-weight:bold">&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;type&amp;gt;&lt;/span>relative&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/type&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;name&amp;gt;&lt;/span>Bo&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/name&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;parent&lt;/span> &lt;span style="color:#c4a000">db-doc-ref=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/thing&amp;#34;&lt;/span>&lt;span style="color:#204a87;font-weight:bold">/&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/related&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;related&lt;/span> &lt;span style="color:#c4a000">db-doc=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;true&amp;#34;&lt;/span>&lt;span style="color:#204a87;font-weight:bold">&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;type&amp;gt;&lt;/span>relative&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/type&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;name&amp;gt;&lt;/span>Ca&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/name&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;parent&lt;/span> &lt;span style="color:#c4a000">db-doc-ref=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/thing&amp;#34;&lt;/span>&lt;span style="color:#204a87;font-weight:bold">/&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/related&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/artist&amp;gt;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="resulting-docs-2">Resulting Docs&lt;/h3>
&lt;p>Report:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;abc-123&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_rev&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;...&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;report&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;fields&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;name&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;Ab&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Other docs:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;...&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_rev&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;...&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;relative&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;name&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;Bo&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;parent&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;abc-123&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;...&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_rev&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;...&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;relative&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;name&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;Ch&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;parent&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;abc-123&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="linked-docs-example">Linked Docs Example&lt;/h2>
&lt;p>This example shows how you would register a single newborn from a delivery report.&lt;/p>
&lt;p>First, the relevant section of the delivery report XLSForm file:
&lt;img src="linked_docs_xlsform.png" alt="Delivery report">&lt;/p>
&lt;p>Here is the corresponding portion of XML generated after converting the form:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-xml" data-lang="xml">&lt;span style="color:#204a87;font-weight:bold">&amp;lt;repeat&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;child_repeat&lt;/span> &lt;span style="color:#c4a000">db-doc=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;true&amp;#34;&lt;/span> &lt;span style="color:#c4a000">jr:template=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#204a87;font-weight:bold">&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;child_name/&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;child_gender/&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;child_doc&lt;/span> &lt;span style="color:#c4a000">db-doc-ref=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34; /delivery/repeat/child_repeat &amp;#34;&lt;/span>&lt;span style="color:#204a87;font-weight:bold">/&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;created_by_doc&lt;/span> &lt;span style="color:#c4a000">db-doc-ref=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/delivery&amp;#34;&lt;/span>&lt;span style="color:#204a87;font-weight:bold">/&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;name/&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;sex/&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;date_of_birth/&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;parent&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;_id/&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;parent&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;_id/&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;parent&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;_id/&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/parent&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/parent&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/parent&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;type&amp;gt;&lt;/span>person&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/type&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/child_repeat&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/repeat&amp;gt;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>If you&amp;rsquo;ve done your configuration correctly, all you should see when you click on the submitted report from the Reports tab is the &lt;code>child_doc&lt;/code> field with an &lt;code>_id&lt;/code> that corresponds to the linked doc. In this case, you could look for that &lt;code>_id&lt;/code> on the People tab or in the DB itself to confirm that the resulting doc looks correct.&lt;/p>
&lt;h2 id="repeated-docs-example">Repeated Docs Example&lt;/h2>
&lt;p>This example extends the above example to show how you would register one or multiple newborns from a delivery report. This allows you to handle multiple births.&lt;/p>
&lt;p>First, the relevant section of the delivery report XLSForm file:
&lt;img src="repeated_docs_xlsform.png" alt="Delivery report">&lt;/p>
&lt;p>Here is the corresponding portion of XML generated after converting the form:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-xml" data-lang="xml">&lt;span style="color:#204a87;font-weight:bold">&amp;lt;repeat&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;child_repeat&lt;/span> &lt;span style="color:#c4a000">db-doc=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;true&amp;#34;&lt;/span> &lt;span style="color:#c4a000">jr:template=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#204a87;font-weight:bold">&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;child_name/&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;child_gender/&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;created_by_doc&lt;/span> &lt;span style="color:#c4a000">db-docs-ref=&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;/delivery&amp;#34;&lt;/span>&lt;span style="color:#204a87;font-weight:bold">/&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;name/&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;sex/&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;date_of_birth/&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;parent&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;_id/&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;parent&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;_id/&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;parent&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;_id/&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/parent&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/parent&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/parent&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;type&amp;gt;&lt;/span>person&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/type&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/child_repeat&amp;gt;&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;lt;/repeat&amp;gt;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>If you&amp;rsquo;ve done your configuration correctly, all you should see when you click on the submitted report from the Reports tab is that there will be no information on the children created. You will find the created docs as siblings to the subject of the previously submitted report. Each of these child docs will have a field &lt;code>created_by_doc&lt;/code> whose value is the &lt;code>_id&lt;/code> of the report that created them. You can also look in the DB itself to confirm that the resulting docs look correct.&lt;/p></description></item><item><title>Apps: Africa's Talking SMS Aggregator</title><link>https://docs.communityhealthtoolkit.org/beta/apps/guides/messaging/africas-talking/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/guides/messaging/africas-talking/</guid><description>
&lt;p>As of v3.6.0, SMS messages can be sent and received using the &lt;a href="https://africastalking.com">Africa&amp;rsquo;s Talking&lt;/a> service.&lt;/p>
&lt;p>&lt;img src="sms-aggregator-workflow.svg" alt="SMS Aggregator Workflow">&lt;/p>
&lt;h2 id="africas-talking-configuration">Africa&amp;rsquo;s Talking configuration&lt;/h2>
&lt;p>First generate a long unique key to use as the &lt;code>medic-api-key&lt;/code>.&lt;/p>
&lt;p>Log on to the &lt;a href="https://account.africastalking.com">Africa&amp;rsquo;s Talking Dashboard&lt;/a> and configure your callback URLs as follows.&lt;/p>
&lt;ul>
&lt;li>Delivery Reports: &lt;code>https://&amp;lt;hostname&amp;gt;/api/v1/sms/africastalking/delivery-reports?key=&amp;lt;medic-api-key&amp;gt;&lt;/code>&lt;/li>
&lt;li>Incoming Messages: &lt;code>https://&amp;lt;hostname&amp;gt;/api/v1/sms/africastalking/incoming-messages?key=&amp;lt;medic-api-key&amp;gt;&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>Then generate an &amp;ldquo;API Key&amp;rdquo; (we&amp;rsquo;ll refer to this as the &lt;code>at-api-key&lt;/code>) and save this in your Medic configuration covered below.&lt;/p>
&lt;h2 id="medic-configuration">Medic configuration&lt;/h2>
&lt;h3 id="api-keys">API keys&lt;/h3>
&lt;p>The API keys should be treated as securely as a password as anyone with access to them will be able to send messages using your account. Therefore we store them in the CouchDB configuration.&lt;/p>
&lt;p>To add the credentials to the admin config you need to either &lt;a href="https://docs.couchdb.org/en/stable/api/server/configuration.html#put--_node-node-name-_config-section-key">PUT the value using curl&lt;/a> or similar:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">curl -X PUT https://&amp;lt;user&amp;gt;:&amp;lt;pass&amp;gt;@&amp;lt;domain&amp;gt;/_node/couchdb@127.0.0.1/_config/medic-credentials/africastalking.com:incoming -d &lt;span style="color:#4e9a06">&amp;#39;&amp;#34;&amp;lt;medic-api-key&amp;gt;&amp;#34;&amp;#39;&lt;/span>
curl -X PUT https://&amp;lt;user&amp;gt;:&amp;lt;pass&amp;gt;@&amp;lt;domain&amp;gt;/_node/couchdb@127.0.0.1/_config/medic-credentials/africastalking.com:outgoing -d &lt;span style="color:#4e9a06">&amp;#39;&amp;#34;&amp;lt;at-api-key&amp;gt;&amp;#34;&amp;#39;&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">Note&lt;/h4>
&lt;code>couchdb@127.0.0.1&lt;/code> is the local node name, and may be different for you depending on your setup.
&lt;/div>
&lt;p>You can also add it via Fauxton:&lt;/p>
&lt;ul>
&lt;li>Navigate to &lt;a href="http://localhost:5984/_utils/#/_config">the Config screen&lt;/a>&lt;/li>
&lt;li>Click &lt;code>Add Option&lt;/code>&lt;/li>
&lt;li>The &lt;code>Section&lt;/code> should be &lt;code>medic-credentials&lt;/code>, the &lt;code>Name&lt;/code> should be &lt;code>africastalking.com:incoming&lt;/code> or &lt;code>africastalking.com:outgoing&lt;/code>, and the value should be the relevant API key.&lt;/li>
&lt;li>Click &lt;code>Create&lt;/code>&lt;/li>
&lt;li>You should then be able to see your credential in the list of configuration shown&lt;/li>
&lt;/ul>
&lt;h3 id="app-settings">App settings&lt;/h3>
&lt;p>Update your app settings as follows.&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;sms&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;outgoing_service&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;africas-talking&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;reply_to&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;lt;africa&amp;#39;s talking shortcode&amp;gt;&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;africas_talking&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;username&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;lt;africa&amp;#39;s talking username&amp;gt;&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="testing">Testing&lt;/h2>
&lt;p>To test your integration, set your &amp;ldquo;username&amp;rdquo; to &amp;ldquo;sandbox&amp;rdquo;, log in to &lt;a href="https://account.africastalking.com">Africa&amp;rsquo;s Talking&lt;/a>, and go to the Sandbox app.&lt;/p></description></item><item><title>Apps: Making Calls and Sending SMS from App Forms</title><link>https://docs.communityhealthtoolkit.org/beta/apps/guides/forms/app-form-sms/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/guides/forms/app-form-sms/</guid><description>
&lt;h2 id="triggering-calls-and-sms">Triggering Calls and SMS&lt;/h2>
&lt;p>When a XForm is loaded on a phone you can start a phone call or trigger the sending of an SMS within the form itself. This can be useful if within a task or assessment you want to tell the user to contact a patient, or perhaps a health worker at a facility.&lt;/p>
&lt;p>To set up the call or SMS you&amp;rsquo;ll need to create a link with &lt;code>tel:&lt;/code> or &lt;code>sms:&lt;/code> within a &lt;code>note&lt;/code> field. To create the link, use the markdown link format, eg &lt;code>[Call Patient](tel:+2547009875000)&lt;/code>. You can specify the content of the SMS by using the body parameter, eg &lt;code>[Send SMS](sms://+25470098765000?body=Hello World!)&lt;/code>.&lt;/p>
&lt;p>The phone number and message can be generated from fields within the XForm. For instance, if you have &lt;code>patient_name&lt;/code>, &lt;code>patient_phone&lt;/code> and &lt;code>message&lt;/code> fields, you can generate the SMS as follows:&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>XLSForm&lt;/strong>
&lt;code>[Send SMS to ${patient_name}](sms://${patient_phone}?body=${message})&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>XForm&lt;/strong>
&lt;code>[Send SMS to &amp;lt;output value=&amp;quot; /data/patient_name &amp;quot;/&amp;gt;](sms://&amp;lt;output value=&amp;quot; /data/patient_phone &amp;quot;/&amp;gt;?body=&amp;lt;output value=&amp;quot; /data/message &amp;quot;/&amp;gt;)&lt;/code>&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>If you want to use a button to make the action more obvious, this can be done using HTML and CSS within the note:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-zsh" data-lang="zsh">&lt;span style="color:#ce5c00;font-weight:bold">[&lt;/span>&amp;lt;span &lt;span style="color:#000">style&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;background-color: #CC0000; color:white; padding: 1em; text-decoration: none; &amp;#39;&lt;/span>&amp;gt;Call the patient&amp;lt;/span&amp;gt;&lt;span style="color:#ce5c00;font-weight:bold">](&lt;/span>tel:&lt;span style="color:#4e9a06">${&lt;/span>&lt;span style="color:#000">patient_phone&lt;/span>&lt;span style="color:#4e9a06">}&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Note that the SMS link notation can be interpreted differently from one phone to another. Some devices work well with &lt;code>sms:${phone}?body=${message}&lt;/code>, others with &lt;code>sms://${phone}?body=${message}&lt;/code>. You may find &lt;a href="https://bradorego.com/test/sms.html">these SMS link tests&lt;/a> helpful in determining what works on devices for your deployment.&lt;/p>
&lt;h2 id="sending-reports-as-sms">Sending reports as SMS&lt;/h2>
&lt;p>To define that an XForm should be converted to an SMS, add the field &lt;code>xml2sms&lt;/code> to the form&amp;rsquo;s CouchDB doc and assign it a truthy value (either a boolean or a string).&lt;br>
When submitting such a form, along with creating the report document, the app will try to compact the report&amp;rsquo;s content into an SMS that would be sent to the configured Gateway phone number.&lt;/p>
&lt;p>There are two formats available - either using the &lt;a href="https://opendatakit.github.io/xforms-spec/#compact-record-representation-(for-sms)">ODK&amp;rsquo;s compact record representation for SMS&lt;/a>, or Medic&amp;rsquo;s custom format.
When the form compaction fails or returns no content, no SMS will be sent.&lt;/p>
&lt;h3 id="odk-compact-record-representation-for-sms">ODK compact record representation for SMS&lt;/h3>
&lt;p>When &lt;code>xml2sms&lt;/code> field value is Boolean &lt;code>true&lt;/code>, the app will try to compact the form using this format.
To get forms sent in this format, follow the &lt;a href="https://opendatakit.github.io/xforms-spec/#compact-record-representation-(for-sms)">ODK documentation&lt;/a>.&lt;/p>
&lt;h3 id="medic-custom-sms-representation">Medic Custom SMS representation&lt;/h3>
&lt;p>To configure a form to send using Medic&amp;rsquo;s custom SMS definition, the value of &lt;code>xml2sms&lt;/code> from the form&amp;rsquo;s CouchDB doc should be an string containing an &lt;a href="https://docs.angularjs.org/guide/expression">Angular expression&lt;/a>.
This allows access to the &lt;code>fields&lt;/code> property of the &lt;code>data_record&lt;/code> doc created when saving the form submission to the database. Extra functions are also provided to make compiling a form submission more simple.&lt;/p>
&lt;h4 id="special-functions">Special Functions&lt;/h4>
&lt;h5 id="concatargs">&lt;code>concat(...args)&lt;/code>&lt;/h5>
&lt;ul>
&lt;li>
&lt;p>&lt;code>...args&lt;/code>: 0 or more values to be concatenated.&lt;/p>
&lt;pre>&lt;code> concat('A', 'bee', 'Sea') =&amp;gt; 'AbeeSea'
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h5 id="spacedargs">&lt;code>spaced(...args)&lt;/code>&lt;/h5>
&lt;ul>
&lt;li>
&lt;p>&lt;code>...args&lt;/code>: 0 or more values to be concatenated with spaces between them.&lt;/p>
&lt;pre>&lt;code> spaced('A', 'bee', 'Sea') =&amp;gt; 'A bee Sea'
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h5 id="matchval-matchers">&lt;code>match(val, matchers)&lt;/code>&lt;/h5>
&lt;ul>
&lt;li>
&lt;p>&lt;code>val&lt;/code>: the value to run matches against&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>matchers&lt;/code>: a string representing values to match and their corresponding outputs&lt;/p>
&lt;pre>&lt;code> match('a', 'a:Hay,b:bzz,c:see') =&amp;gt; 'Hay'
match('b', 'a:Hay,b:bzz,c:see') =&amp;gt; 'bzz'
match('c', 'a:Hay,b:bzz,c:see') =&amp;gt; 'c'
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h4 id="examples">Examples&lt;/h4>
&lt;h5 id="form-submission-json">Form Submission JSON&lt;/h5>
&lt;pre>&lt;code>doc.fields = {
s_acc_danger_signs: {
s_acc_danger_sign_seizure: 'no',
s_acc_danger_sign_loss_consiousness: 'yes',
s_acc_danger_sign_unable_drink: 'no',
s_acc_danger_sign_confusion: 'yes',
s_acc_danger_sign_vomit: 'no',
s_acc_danger_sign_chest_indrawing: 'yes',
s_acc_danger_sign_wheezing: 'no',
s_acc_danger_sign_bleeding: 'yes',
s_acc_danger_sign_lathargy: 'no',
has_danger_sign: 'true',
},
};
&lt;/code>&lt;/pre>
&lt;h5 id="formdocreport2sms">&lt;code>formDoc.report2sms&lt;/code>&lt;/h5>
&lt;pre>&lt;code>concat(
&amp;quot;U5 &amp;quot;,
match(doc.s_acc_danger_signs.has_danger_sign, &amp;quot;true:DANGER, false:NO_DANGER&amp;quot;),
&amp;quot; &amp;quot;,
match(doc.s_acc_danger_signs.s_acc_danger_sign_seizure, &amp;quot;yes:S&amp;quot;),
match(doc.s_acc_danger_signs.s_acc_danger_sign_loss_consiousness, &amp;quot;yes:L&amp;quot;),
match(doc.s_acc_danger_signs.s_acc_danger_sign_unable_drink, &amp;quot;yes:D&amp;quot;),
match(doc.s_acc_danger_signs.s_acc_danger_sign_confusion, &amp;quot;yes:C&amp;quot;),
match(doc.s_acc_danger_signs.s_acc_danger_sign_vomit, &amp;quot;yes:V&amp;quot;),
match(doc.s_acc_danger_signs.s_acc_danger_sign_chest_indrawing, &amp;quot;yes:I&amp;quot;),
match(doc.s_acc_danger_signs.s_acc_danger_sign_wheezing, &amp;quot;yes:W&amp;quot;),
match(doc.s_acc_danger_signs.s_acc_danger_sign_bleeding, &amp;quot;yes:B&amp;quot;),
match(doc.s_acc_danger_signs.s_acc_danger_sign_lathargy, &amp;quot;yes:Y&amp;quot;)
)
&lt;/code>&lt;/pre>
&lt;h5 id="sms-content">SMS content&lt;/h5>
&lt;pre>&lt;code>U5 DANGER LCIB&lt;/code>&lt;/pre></description></item><item><title>Apps: Contact Forms</title><link>https://docs.communityhealthtoolkit.org/beta/apps/guides/forms/contact-forms/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/guides/forms/contact-forms/</guid><description>
&lt;p>Contact forms are used to create person or place types. Prior to version 3.7, CHT Core supported 4 contact types - 3 place types (clinic, health_center, district_hospital) and one person type (person). From version 3.7, an unlimited number of place and person types are supported. Each contact-type should ideally have two forms; one for creation, and another for editing.&lt;/p>
&lt;p>These forms are stored in the &lt;code>forms/contact&lt;/code> subfolder of the project config directory. The naming convention used sould be &lt;code>&amp;lt;contact_type_id-{create|edit}&amp;gt;.xlsx&lt;/code>. The &lt;code>contact_type_id&lt;/code> prefix should match what&amp;rsquo;s specified in the contact form settings page.&lt;/p>
&lt;h2 id="person-type-forms">Person-type forms&lt;/h2>
&lt;p>These have the simplest structure since we are only creating one thing - the actual contact. Below, we&amp;rsquo;ll look at the structure of the survey and settings sheets since these are critical to ensuring the contact is created correctly at the appropriate part of the hierarchy.&lt;/p>
&lt;h3 id="survey-sheet">Survey sheet&lt;/h3>
&lt;p>&lt;img src="person-contact-form-survey.png" alt="Person forms survey sheet">&lt;/p>
&lt;p>Section 1 and 3 are optional. We can pull in details of the logged in user as shown in section 1 and use that to log some metadata on the created documents as shown in section 3.&lt;/p>
&lt;p>Section 2 contains the core components of what will be saved in couchdb. The group name needs to match the contact type id specified in app_settings.json (if using the configurable hierarchy) or &lt;code>person&lt;/code> if using the old-style hierarchy. To learn more about setting up configurable hieararchy, review the &lt;a href="https://docs.communityhealthtoolkit.org/beta/apps/reference/app-settings/hierarchy/">Hierarchy&lt;/a> page. &lt;code>parent&lt;/code>, &lt;code>type&lt;/code>, &lt;code>contact_type&lt;/code> and &lt;code>name&lt;/code> attributes are mandatory for things to work correctly.&lt;/p>
&lt;h2 id="settings-sheet">Settings sheet&lt;/h2>
&lt;p>&lt;img src="person-contact-form-settings.png" alt="Person forms settings sheet">&lt;/p>
&lt;p>We&amp;rsquo;ll need to replace &lt;code>PLACE_NAME&lt;/code> with a name that corresponds to the created contact type. We&amp;rsquo;ll also need to replace &lt;code>PLACE_TYPE&lt;/code> with the contact-type id specified in app_settings.json (for configurable ones) or &lt;code>person&lt;/code>.&lt;/p>
&lt;h2 id="place-type-forms">Place-type forms&lt;/h2>
&lt;p>The main difference between place type and person type forms is that we can optionally create one or more person-type documents one of which can be linked to the created place as a contact.&lt;/p>
&lt;p>We&amp;rsquo;ll look at a simple structure of a place forms showing all the necessary components&lt;/p>
&lt;p>&lt;img src="place-contact-form-survey.png" alt="Place forms survey sheet">&lt;/p>
&lt;p>Section 1 is similar to what has been described earlier for person forms.&lt;/p>
&lt;p>Section 2 specifies the contact that will be linked to the place being created. &lt;code>parent&lt;/code>, &lt;code>type&lt;/code> and &lt;code>contact_type&lt;/code> and &lt;code>name&lt;/code> are mandatory. This also applies to the place-type definition in section 4. &lt;code>contact&lt;/code> on the other hand is not mandatory for the successful creation of a place. It usually more conventient to create a place and it&amp;rsquo;s primary contact at the same time.&lt;/p>
&lt;p>You can also create additional contacts linked to the place being created when you have a structure similar to that shown in section 3.&lt;/p>
&lt;h2 id="contact-edit-forms">Contact-edit forms&lt;/h2>
&lt;p>The edit forms are much simpler in structure and one can specify only the relevant fields that need editing. The name of the group should match the contact-type being edited and the field names should correspond to what is saved in Couchdb.&lt;/p>
&lt;p>&lt;img src="contact-edit-form.png" alt="Contact edit form survey sheet">&lt;/p>
&lt;h2 id="generic-contact-forms">Generic contact forms&lt;/h2>
&lt;p>If your place forms are similar across all levels of your specified project hiearachy, you can templatise the form creation process. You&amp;rsquo;ll need to create the following files: &lt;code>place-type.json&lt;/code>, &lt;code>PLACE_TYPE-create.xlsx&lt;/code> and &lt;code>PLACE_TYPE-edit.xlsx&lt;/code>.&lt;/p>
&lt;p>&lt;code>place-type.json&lt;/code> maps the place contact-type to a human readable description that will be shown on the app&amp;rsquo;s user interface.&lt;/p>
&lt;p>Both &lt;code>PLACE_TYPE-create.xlsx&lt;/code> and &lt;code>PLACE_TYPE-edit.xlsx&lt;/code> will contain two placeholder values &lt;code>PLACE_TYPE&lt;/code> and &lt;code>PLACE_NAME&lt;/code> which will be replaced by the keys and values specified in &lt;code>place-type.json&lt;/code> respectively during form conversion. Also, copies of the different place-type forms will be created (if they don&amp;rsquo;t exist) during the form conversion process with &lt;code>PLACE_TYPE&lt;/code> being replaced with the keys specified in &lt;code>place-type.json&lt;/code>.&lt;/p>
&lt;p>For examples on how to structure the above files you can have a look at the sample configurations in CHT-core: &lt;a href="https://github.com/medic/cht-core/tree/master/config/default/forms/contact">default&lt;/a> and &lt;a href="https://github.com/medic/cht-core/tree/master/config/standard/forms/contact">standard&lt;/a>.&lt;/p></description></item><item><title>Apps: Contact Tracing</title><link>https://docs.communityhealthtoolkit.org/beta/apps/examples/contact-tracing/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/examples/contact-tracing/</guid><description>
&lt;p>The CHT’s Contact Tracing functionality enables effective disease surveillance within communities to help control infectious disease outbreaks. It is a community public health tool that is designed to:&lt;/p>
&lt;ul>
&lt;li>Centrally register patient cases and track contacts to prevent secondary spread of diseases in communities&lt;/li>
&lt;li>Create a coordinated approach to contact tracing within existing health systems&lt;/li>
&lt;li>Communicate the importance of self-isolation and symptom screening to exposed individuals and their families&lt;/li>
&lt;/ul>
&lt;h2 id="problem-being-addressed">Problem Being Addressed&lt;/h2>
&lt;p>An essential part of containing disease outbreaks, such as COVID-19, requires public health organizations to rapidly notify people who have come into contact with confirmed or suspected patient cases. In many health systems, existing health management information systems are ill equipped to handle the necessary rapid tracking, triage, and care referrals for large numbers of patient cases and contacts to prevent secondary spread of viruses.&lt;/p>
&lt;h2 id="solution-overview">Solution Overview&lt;/h2>
&lt;p>Contact Tracing with the CHT offers a rapidly scalable surveillance strategy by registering patient cases and their contacts within communities in a responsive and empathetic way. Through proactive tracing of contacts, active symptom screening, and referrals to care or self-isolation, the app can be deployed to assist in:&lt;/p>
&lt;ul>
&lt;li>Disrupting secondary transmission via coordinated registration of patient cases&lt;/li>
&lt;li>Enrolling all contacts and households in monitoring during isolation periods&lt;/li>
&lt;li>Referring symptomatic cases for skilled care following triage&lt;/li>
&lt;li>Engaging in community education and follow-up during isolation&lt;/li>
&lt;/ul>
&lt;h2 id="app-user-roles-example">App User Roles Example&lt;/h2>
&lt;p>&lt;img src="user-roles.png" alt="user-roles.png">&lt;/p>
&lt;h2 id="reporting-hierarchy-example">Reporting Hierarchy Example&lt;/h2>
&lt;p>&lt;img src="hierarchy.png" alt="hierarchy.png">&lt;/p>
&lt;h2 id="app-workflow-example">App Workflow Example&lt;/h2>
&lt;p>This is a detailed workflow that supports tracing of contacts of suspected or confirmed patient cases, symptom screening, care referrals, and monitoring of asymptomatic contacts during self-isolation. It works on both SMS and the CHT app. It can be combined with other care workflows and configured to suit specific health system needs, particularly in terms of tracer roles.&lt;/p>
&lt;p>&lt;img src="workflow.png" alt="workflow.png">&lt;/p></description></item><item><title>Apps: Fixing couch2pg Memory Errors</title><link>https://docs.communityhealthtoolkit.org/beta/apps/guides/database/couch2pg-oom-errors/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/guides/database/couch2pg-oom-errors/</guid><description>
&lt;p>Some times when couch2pg is replicating documents to postgres, it encounters very large info docs that are larger than the memory allocation of the document sync array and causes out-of-memory errors.
To fix this, we need to delete this document so that couch2pg can proceed. Below are steps to follow to achieve this.&lt;/p>
&lt;ol>
&lt;li>Reduce the size of the replicated docs to a value of say 4 in the couch2pg.conf file so that you can get within the range of the failing document.&lt;/li>
&lt;li>Clone the existing &lt;a href="https://github.com/medic/couch2pg">couch2pg&lt;/a> repo so that you can run couch2pg locally&lt;/li>
&lt;li>Edit the file &lt;code>lib/importer.js&lt;/code> in the couch2pg source code to be able to log the doc-id of the problem doc&lt;/li>
&lt;li>Edit just logs doc_ids to the console, around line 100 of importer.js &lt;code>console.log(row.doc._id);&lt;/code>&lt;/li>
&lt;li>Get the remote couch2pg environment variable settings and export them into your profile terminal&lt;/li>
&lt;li>Create an ssh reverse tunnel from the postgres server to your laptop&lt;/li>
&lt;li>Run couch2pg locally so that you can see the doc-ids on console till it fails&lt;/li>
&lt;li>From the ids printed on console try loading the docs in the couchdb web access(Futon or Fauxton), the problem doc is usually big and won&amp;rsquo;t load&lt;/li>
&lt;li>This will help you identify the problem doc&lt;/li>
&lt;li>Curl the document to your pc and back it up&lt;/li>
&lt;li>Back up the document for further analysis&lt;/li>
&lt;li>Delete the document using curl
&lt;code>curl --head &amp;quot;&amp;lt;HOST&amp;gt;/&amp;lt;DB&amp;gt;/&amp;lt;DOC_ID&amp;gt;&amp;quot;&lt;/code>
This returns something like&lt;/li>
&lt;/ol>
&lt;pre>&lt;code>HTTP/1.1 200 OK
Cache-Control: must-revalidate
Content-Length: 307
Content-Type: application/json
Date: Tue, 25 Jun 2019 11:58:29 GMT
ETag: &amp;quot;2-6beeb38da9b096bacfe2fa769e5171be&amp;quot;
Server: CouchDB/2.3.1 (Erlang OTP/21)
X-Couch-Request-ID: e4aa7a8696
X-CouchDB-Body-Time: 0
&lt;/code>&lt;/pre>&lt;p>The ETag is the rev. Delete document with curl: &lt;code>curl -X DELETE &amp;quot;&amp;lt;HOST&amp;gt;/&amp;lt;DB&amp;gt;/&amp;lt;DOC_ID&amp;gt;?rev=&amp;lt;THE_REV&amp;gt;&amp;quot;&lt;/code>&lt;/p></description></item><item><title>Apps: CouchDB Authentication</title><link>https://docs.communityhealthtoolkit.org/beta/apps/guides/database/couchdb-authentication/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/guides/database/couchdb-authentication/</guid><description>
&lt;h3 id="to-invalidate-a-session-in-couchdb-there-are-two-options">To invalidate a session in couchdb, there are two options:&lt;/h3>
&lt;ol>
&lt;li>Change the session signing certificate on the server&lt;/li>
&lt;li>Change the password and/or salt for the user whose session should be invalidated&lt;/li>
&lt;/ol>
&lt;p>There are drawbacks to note with each. Option &lt;strong>1&lt;/strong> will invalidate &lt;em>all&lt;/em> sessions; option &lt;strong>2&lt;/strong> will invalidate all sessions &lt;em>for that user&lt;/em>, and also their password.&lt;/p>
&lt;p>Because of the nature of couch&amp;rsquo;s session management, there is no way to see a list of active/open sessions. Invalidating a specific session key could be achieved by blacklisting a cookie value in e.g. nginx or API, but this is unlikely to be of practical value.&lt;/p></description></item><item><title>Apps: CSV to Docs</title><link>https://docs.communityhealthtoolkit.org/beta/apps/guides/data/csv-to-docs/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/guides/data/csv-to-docs/</guid><description>
&lt;h2 id="seeding-data-with-medic-conf">Seeding data with medic-conf&lt;/h2>
&lt;p>Users, contacts, and report data can be specified in comma-separated value (CSV) files, then converted to JavaScript Object Notation (JSON) files and uploaded into your instance using &lt;a href="https://github.com/medic/medic-conf">medic-conf&lt;/a>. This documentation will cover the CSV notation used, fetching CSV files from Google Sheets, converting the CSV files into JSON docs, and then uploading the data from the JSON files to your instance.&lt;/p>
&lt;h3 id="converting-csvs">Converting CSVs&lt;/h3>
&lt;p>Running &lt;code>medic-conf&lt;/code> with the &lt;code>csv-to-docs&lt;/code> action converts CSV files from the &lt;code>csv&lt;/code> folder into JSON docs to be uploaded to your instance. The JSON files are stored in the &lt;code>json_docs&lt;/code> folder. Instructions for creating the CSV files are in sections below.&lt;/p>
&lt;h3 id="uploading-csvs">Uploading CSVs&lt;/h3>
&lt;p>Running &lt;code>medic-conf&lt;/code> with the &lt;code>upload-docs&lt;/code> action will upload the JSON docs that were generated from the CSV files to your instance. For example, running &lt;code>medic-conf --local upload-docs&lt;/code> will upload the converted docs into your local instance. The target location &lt;code>--local&lt;/code> can be replaced with an instance or URL. See &lt;a href="https://github.com/medic/medic-conf">medic-conf&lt;/a> for detailed instructions.&lt;/p>
&lt;h3 id="creating-csv-files-for-contacts-reports">Creating CSV files for Contacts, Reports&lt;/h3>
&lt;p>A separate CSV file is needed for each type of place, person, or report in your project&amp;rsquo;s local &lt;code>csv&lt;/code> folder. The name of the file determines the type of doc created for rows contained in the file. The possible types are: &lt;code>report&lt;/code>, &lt;code>person&lt;/code>, and &lt;code>place&lt;/code>. Each of these has a further specifier provided in the filename:&lt;/p>
&lt;ul>
&lt;li>&lt;code>place.{place_type}.csv&lt;/code>: where &lt;code>{place_type}&lt;/code> is the type of place specified in the file. By default, the place types are one of &lt;code>clinic&lt;/code>, &lt;code>health_center&lt;/code>, or &lt;code>district_hospital&lt;/code>. As of 3.7 of the &lt;a href="https://github.com/medic/cht-core">Core Framework&lt;/a>, the number of place types and their names can be configured — the &lt;code>{place_type}&lt;/code> should match with the hierarchy names used.&lt;/li>
&lt;li>&lt;code>person.{parent_place_type}.csv&lt;/code>: where &lt;code>{parent_place_type}&lt;/code> is the type of place to which the people in the file will belong.&lt;/li>
&lt;li>&lt;code>report.{form_id}.csv&lt;/code>: where &lt;code>{form_id}&lt;/code> is the form ID for all the reports in the file. You will need one file per form ID&lt;/li>
&lt;/ul>
&lt;p>Here are some examples:&lt;/p>
&lt;ul>
&lt;li>File named &lt;code>place.district_hospital.csv&lt;/code> adds the property &lt;code>&amp;quot;type&amp;quot;:&amp;quot;district_hospital&amp;quot;&lt;/code>&lt;/li>
&lt;li>File named &lt;code>person.clinic.csv&lt;/code> add the property &lt;code>&amp;quot;type&amp;quot;:&amp;quot;person&amp;quot;&lt;/code>&lt;/li>
&lt;li>File named &lt;code>report.immunization_visit.csv&lt;/code> add the property &lt;code>&amp;quot;type&amp;quot;:&amp;quot;report&amp;quot;, &amp;quot;form&amp;quot;:&amp;quot;immunization_visit&amp;quot;&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>In each of these files a header row is used to specify the JSON field names, and each subsequent row specifies the corresponding values for a doc. A &lt;code>_id&lt;/code> field is automatically generated with a universally unique identifier.&lt;/p>
&lt;p>Here is an example of a &lt;code>csv/person.clinic.csv&lt;/code> file for people belonging to clinics:&lt;/p>
&lt;pre>&lt;code class="language-csv" data-lang="csv">name,sex,date_of_birth
Adriana Akiyama,female,1985-12-31
Becky Backlund,female,1987-10-17
Carson Crane,male,2015-01-23
&lt;/code>&lt;/pre>&lt;p>Here is the table representation of the CSV:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>name&lt;/th>
&lt;th>sex&lt;/th>
&lt;th>date_of_birth&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>Adriana Akiyama&lt;/td>
&lt;td>female&lt;/td>
&lt;td>1985-12-31&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Becky Backlund&lt;/td>
&lt;td>female&lt;/td>
&lt;td>1987-10-17&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>Carson Crane&lt;/td>
&lt;td>male&lt;/td>
&lt;td>2015-01-23&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>Converting that CSV file to JSON docs with the &lt;code>csv-to-docs&lt;/code> action would generate three files, one for each person. Here is one of the corresponding JSON files, &lt;code>json_docs/dbfbc0f0-117a-59ec-9542-3313fb10ef25.doc.json&lt;/code>, which was created from the CSV data above:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;person&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;name&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;Adriana Akiyama&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;sex&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;female&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;date_of_birth&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;1985-12-31&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;dbfbc0f0-117a-59ec-9542-3313fb10ef25&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="special-notations">Special notations&lt;/h4>
&lt;h5 id="specifying-property-type">Specifying property type&lt;/h5>
&lt;p>By default, values are parsed as strings. To parse a CSV column as a different JSON type, append the JSON type name to the column definition, e.g.&lt;/p>
&lt;pre>&lt;code>column_one,column_two:bool,column_three:int,column_four:float,column_five:date,column_six:timestamp
some string,true,1,2.3,2017-12-31,1513255007072
&lt;/code>&lt;/pre>
&lt;p>This would create a structure such as:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;09efb53f-9cd8-524c-9dfd-f62c242f1817&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;column_one&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;some string&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;column_two&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">true&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;column_three&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;column_four&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">2.3&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;column_five&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;2017-12-31T00:00:00.000Z&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;column_six&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1513255007072&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="excluding-column">Excluding column&lt;/h5>
&lt;p>A special column type, &lt;code>excluded&lt;/code>, is used for excluding a column from the final JSON data:&lt;/p>
&lt;pre>&lt;code>my_column_that_will_not_be_a_property:excluded
&lt;/code>&lt;/pre>
&lt;p>This can be useful if using a column for doc references.&lt;/p>
&lt;h4 id="including-another-doc">Including another doc&lt;/h4>
&lt;p>Often times database documents need to include or refer to other documents in the database. This can be achieved with queries across CSV files, which is done by specifying a query in the column header. The query specifies the doc type (&lt;code>person&lt;/code> or &lt;code>place&lt;/code>) and matching condition.&lt;/p>
&lt;p>For instance, to include the parent district&amp;rsquo;s doc in a health center&amp;rsquo;s doc, the &lt;code>parent:place WHERE reference_id=COL_VAL&lt;/code> column header is used. The &lt;code>COL_VAL&lt;/code> is a special notation for that column&amp;rsquo;s value for the row, and it will be used to match against the &lt;code>reference_id&lt;/code> field in all other places. Given these example CSVs, you can see the corresponding JSON structure:&lt;/p>
&lt;p>&lt;strong>&lt;code>place.district.csv&lt;/code>:&lt;/strong>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>reference_id:excluded&lt;/th>
&lt;th>is_name_generated&lt;/th>
&lt;th>name&lt;/th>
&lt;th>reported_date:timestamp&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>district_1&lt;/td>
&lt;td>false&lt;/td>
&lt;td>D1&lt;/td>
&lt;td>1544031155715&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>district_2&lt;/td>
&lt;td>false&lt;/td>
&lt;td>D2&lt;/td>
&lt;td>1544031155715&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>district_3&lt;/td>
&lt;td>false&lt;/td>
&lt;td>D3&lt;/td>
&lt;td>1544031155715&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;strong>&lt;code>place.health_center.csv&lt;/code>:&lt;/strong>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>reference_id:excluded&lt;/th>
&lt;th>parent:place WHERE reference_id=COL_VAL&lt;/th>
&lt;th>is_name_generated&lt;/th>
&lt;th>name&lt;/th>
&lt;th>reported_date:timestamp&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>health_center_1&lt;/td>
&lt;td>district_1&lt;/td>
&lt;td>false&lt;/td>
&lt;td>HC1&lt;/td>
&lt;td>1544031155715&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>health_center_2&lt;/td>
&lt;td>district_2&lt;/td>
&lt;td>false&lt;/td>
&lt;td>HC2&lt;/td>
&lt;td>1544031155715&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>health_center_3&lt;/td>
&lt;td>district_3&lt;/td>
&lt;td>false&lt;/td>
&lt;td>HC3&lt;/td>
&lt;td>1544031155715&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;strong>&lt;code>480d0cd0-c021-5d55-8c63-d86576d592fc.doc.json&lt;/code>&lt;/strong>:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;health_center&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;parent&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;district_hospital&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;parent&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;is_name_generated&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;false&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;name&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;D2&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;external_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;notes&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;geolocation&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;reported_date&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1544031155715&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;f223f240-5d6a-5a7a-91d4-46d3c59de73e&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;is_name_generated&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;false&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;name&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;HC7&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;external_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;notes&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;geolocation&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;reported_date&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1544031155715&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;480d0cd0-c021-5d55-8c63-d86576d592fc&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h5 id="including-value-from-another-doc">Including value from another doc&lt;/h5>
&lt;p>Similar to including another doc, it is also possible to get the value of a specific field in another doc. For instance, if &lt;code>parent:GET _id OF place WHERE reference_id=COL_VAL&lt;/code> were used in the example above, the &lt;code>parent&lt;/code> field&amp;rsquo;s value would have been set to the &lt;code>_id&lt;/code> of the refered to doc instead of including the whole doc. Note that &lt;code>_id&lt;/code> is a generated value included in all generated docs.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>reference_id:excluded&lt;/th>
&lt;th>parent:GET _id OF place WHERE reference_id=COL_VAL&lt;/th>
&lt;th>is_name_generated&lt;/th>
&lt;th>name&lt;/th>
&lt;th>reported_date:timestamp&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>health_center_1&lt;/td>
&lt;td>district_1&lt;/td>
&lt;td>false&lt;/td>
&lt;td>HC1&lt;/td>
&lt;td>1544031155715&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>health_center_2&lt;/td>
&lt;td>district_2&lt;/td>
&lt;td>false&lt;/td>
&lt;td>HC2&lt;/td>
&lt;td>1544031155715&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>health_center_3&lt;/td>
&lt;td>district_3&lt;/td>
&lt;td>false&lt;/td>
&lt;td>HC3&lt;/td>
&lt;td>1544031155715&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>The resulting doc would be as follows, with the &lt;code>_id&lt;/code> from &lt;code>district_1&lt;/code> as the &lt;code>parent&lt;/code> value:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;health_center&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;parent&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;0c31056a-3a80-54dd-b136-46145d451a66&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;is_name_generated&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;false&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;name&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;HC3&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;external_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;notes&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;geolocation&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;reported_date&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1544031155715&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;45293356-353c-5eb1-9a41-baa3427b4f69&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="creating-csv-files-for-users">Creating CSV files for users&lt;/h3>
&lt;p>To create user accounts from CSV files, a &lt;code>users.csv&lt;/code> file will be needed in the &lt;code>csv&lt;/code> folder. The &lt;code>users.csv&lt;/code> file requires columns for &lt;code>username&lt;/code> and &lt;code>password&lt;/code>. Additional columns can be used for any additional fields needed on the user&amp;rsquo;s doc, for example &lt;code>roles&lt;/code>, &lt;code>phone&lt;/code>. Running the &lt;code>csv-to-docs&lt;/code> &lt;code>upload-docs&lt;/code> &lt;code>create-users&lt;/code> actions in that order will generate the necessary JSON docs with a &lt;code>users.csv&lt;/code> file in your working directory, and then create the people, places, and users.&lt;/p>
&lt;p>The following sections describe the different ways to associate the new users to contacts.&lt;/p>
&lt;h4 id="creating-new-users-with-existing-contacts">Creating new users with existing contacts&lt;/h4>
&lt;p>When creating users that are associated to existing contacts, &lt;code>contact&lt;/code> and &lt;code>place&lt;/code> columns should be created. Each row should have the UUID of an existing person for &lt;code>contact&lt;/code>, and an existing place for &lt;code>place&lt;/code>.&lt;/p>
&lt;h3 id="creating-new-users-with-new-contacts">Creating new users with new contacts&lt;/h3>
&lt;p>To create new contacts for each new user provide values for &lt;code>contact.name&lt;/code>, &lt;code>place.name&lt;/code>, and &lt;code>place.parent&lt;/code> (can be existing place), as seen in this example CSV:&lt;/p>
&lt;pre>&lt;code class="language-csv" data-lang="csv">username,password,roles,name,phone,contact.name,place.c_prop,place.type,place.name,place.parent
alice,Secret_1,district-admin,Alice Example,+123456789,Alice,p_val_a,health_center,alice area, district_uuid
bob,Secret_1,district-admin,bob Example,+123456789,bob,p_val_a,health_center,bob area,disctrict_uuid
&lt;/code>&lt;/pre>&lt;p>The &lt;code>username&lt;/code>, &lt;code>password&lt;/code>, &lt;code>contact.name&lt;/code>, &lt;code>place.type&lt;/code>, &lt;code>place.name&lt;/code> columns are required to have functional users with new places.&lt;/p>
&lt;h3 id="creating-new-users-linked-to-contacts-in-csv-files">Creating new users linked to contacts in CSV files&lt;/h3>
&lt;p>To associate the new users to contacts that will also be created with the &lt;code>csv-to-docs&lt;/code> action, use reference queries to the contacts.
For instance, the column header for the person would be &lt;code>contact:person WHERE reference_id=COL_VAL&lt;/code>, and for the place would be &lt;code>place:GET _id OF place WHERE reference_id=COL_VAL&lt;/code>.&lt;/p>
&lt;p>Here is a example of how the three CSV files need to be configured to setup a user linked to existing place and contact.&lt;/p>
&lt;p>&lt;strong>&lt;code>csv/place.health_center.csv&lt;/code>:&lt;/strong>&lt;/p>
&lt;pre>&lt;code class="language-csv" data-lang="csv">reference_id:excluded,parent:place WHERE reference_id=COL_VAL,is_name_generated,name,reported_date:timestamp
health_center_1,district_1,FALSE,HC1,1544031155715
&lt;/code>&lt;/pre>&lt;p>Generated JSON doc for the health center:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;health_center&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;parent&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;district_hospital&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;parent&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;is_name_generated&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;false&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;name&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;District1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;external_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;notes&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;geolocation&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;reported_date&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1544031155715&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;e8f9739a-5d37-5b1e-be3c-a571b2c2409b&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;is_name_generated&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;FALSE&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;name&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;HC1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;reported_date&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1544031155715&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;8606a91a-f454-56e3-a089-0b686af3c6b7&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>&lt;code>csv/person.csv&lt;/code>:&lt;/strong>&lt;/p>
&lt;pre>&lt;code class="language-csv" data-lang="csv">reference_id:excluded,parent:place WHERE reference_id=COL_VAL,name,phone,sex,role,reported_date,patient_id
p_hc1,health_center_1,Bob Johnson 1,+16143291527,male,manager,1552494835669,60951
p_hc2,health_center_1,Bob Johnson 2,+16143291528,male,manager,1552494835669,60951
&lt;/code>&lt;/pre>&lt;p>Generated JSON doc for the person:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;person&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;parent&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;health_center&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;parent&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;district_hospital&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;parent&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;is_name_generated&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;false&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;name&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;District1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;external_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;notes&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;geolocation&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;reported_date&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1544031155715&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;e8f9739a-5d37-5b1e-be3c-a571b2c2409b&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;is_name_generated&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;FALSE&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;name&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;HC1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;reported_date&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">1544031155715&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;8606a91a-f454-56e3-a089-0b686af3c6b7&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;name&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;Bob Johnson 1&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;phone&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;+16143291527&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;sex&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;male&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;role&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;manager&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;reported_date&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;1552494835669&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;patient_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;60951&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;65c52076-84c5-53a2-baca-88e6ec6e0875&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;strong>&lt;code>csv/users.csv&lt;/code>&lt;/strong>:&lt;/p>
&lt;pre>&lt;code class="language-csv" data-lang="csv">username,password,roles,phone,contact:person WHERE reference_id=COL_VAL,place:GET _id OF place WHERE reference_id=COL_VAL
ac1,Secret_1,district_admin:red1,+123456789,p_hc1,health_center_1
ac2,Secret_1,district_admin:supervisor,+123456789,p_hc2,health_center_1
ac3,Secret_1,district_admin,+123456789,p_hc3,health_center_1
ac4,Secret_1,district_admin,+123456789,p_hc4,health_center_1
&lt;/code>&lt;/pre>&lt;p>This will generate the &lt;code>users.csv&lt;/code> file in the working directory which is used by the &lt;code>create-users&lt;/code> action. The contact and place fields should be resolved to the actual UUIDs.&lt;/p>
&lt;pre>&lt;code class="language-csv" data-lang="csv">p_hc1&amp;quot;username&amp;quot;,&amp;quot;password&amp;quot;,&amp;quot;roles&amp;quot;,&amp;quot;contact&amp;quot;,&amp;quot;phone&amp;quot;,&amp;quot;place&amp;quot;
&amp;quot;ac1&amp;quot;,&amp;quot;Secret_1&amp;quot;,&amp;quot;district_admin:red1&amp;quot;,&amp;quot;65c52076-84c5-53a2-baca-88e6ec6e0875&amp;quot;,&amp;quot;+123456789&amp;quot;,&amp;quot;8606a91a-f454-56e3-a089-0b686af3c6b7&amp;quot;
&amp;quot;ac2&amp;quot;,&amp;quot;Secret_1&amp;quot;,&amp;quot;district_admin:supervisor&amp;quot;,&amp;quot;b7d0dbd5-beeb-52a8-8e4c-513d0baece8e&amp;quot;,&amp;quot;+123456789&amp;quot;,&amp;quot;8606a91a-f454-56e3-a089-0b686af3c6b7&amp;quot;
&lt;/code>&lt;/pre>&lt;h3 id="using-csv-files-on-google-drive">Using CSV files on Google Drive&lt;/h3>
&lt;p>Individual Google Sheets can be used for each CSV file, which can be exported manually to CSV file format, or linked to your project to be downloaded by medic-conf.&lt;/p>
&lt;p>To fetch the files from Google Drive run the &lt;code>fetch-csvs-from-google-drive&lt;/code> action in medic-conf. This will download the CSV files specified in the &lt;code>csvs-on-google-drive.json&lt;/code> file, and place them into the &lt;code>csv&lt;/code> folder.&lt;/p>
&lt;h4 id="linking-to-google-drive">Linking to Google Drive&lt;/h4>
&lt;p>The file &lt;code>csvs-on-google-drive.json&lt;/code> in your project&amp;rsquo;s home directory will consist of a key value pair for each CSV file. The keys must be the filename where the CSV will be stored locally — see the CSV &lt;a href="https://github.com/medic/medic-conf#csv-file-name">file documentation&lt;/a> for the notation. The value of each key must be the ID of the corresponding file in Google Drive — the ID can be obtained from the URL eg &lt;code>https://docs.google.com/spreadsheets/d/{FILE_ID}/edit&lt;/code>.&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;person.clinic.csv&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;google_drive_ID&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="google-drive-authentication">Google Drive authentication&lt;/h3>
&lt;p>Medic-conf leverages Google authentication to access Google Drive. You will need to create a client_secrets file named &lt;code>.gdrive.secrets.json&lt;/code> and place it in your working directory, and &lt;a href="https://developers.google.com/identity/protocols/OAuth2InstalledApp">create a token&lt;/a>.&lt;/p>
&lt;p>Create the &lt;code>.gdrive.secrets.json&lt;/code> file by downloading the &lt;code>client_secrets.json&lt;/code> from Google. You will need a &lt;code>CLIENT_ID&lt;/code>, &lt;code>CLIENT_SECRET&lt;/code> and &lt;code>REDIRECT_URL&lt;/code>. You can find these pieces of information by going to the Developer Console, clicking your project &amp;ndash;&amp;gt; APIs &amp;amp; auth &amp;ndash;&amp;gt; credentials &amp;ndash;&amp;gt; Download JSON. This will download the credentials but will need modified to be in this structure.&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;client_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;&amp;lt;client_id&amp;gt;.apps.googleusercontent.com&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;project_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;proj_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;auth_uri&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;https://accounts.google.com/o/oauth2/auth&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;token_uri&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;https://accounts.google.com/o/oauth2/token&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;auth_provider_x509_cert_url&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;https://www.googleapis.com/oauth2/v1/certs&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;client_secret&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;client_secret&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;redirect_uris&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;urn:ietf:wg:oauth:2.0:oob&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>&lt;span style="color:#4e9a06">&amp;#34;http://localhost&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>See Google&amp;rsquo;s docs &lt;a href="https://github.com/googleapis/google-api-nodejs-client#oauth2-client">here&lt;/a> on Oauth2&lt;/p></description></item><item><title>Apps: Database Conflicts</title><link>https://docs.communityhealthtoolkit.org/beta/apps/guides/database/database-conflicts/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/guides/database/database-conflicts/</guid><description>
&lt;p>Conflicts are a natural and unavoidable part of working in a distributed system.&lt;/p>
&lt;p>Conflicts occur when one client (eg PouchDB) attempts to replicate to another (eg CouchDB), and the document that the first has does not have the same tree of changes that the second one has.&lt;/p>
&lt;h2 id="an-example">An example&lt;/h2>
&lt;p>To make it clear what&amp;rsquo;s happening, let&amp;rsquo;s walk through an example. If you already understand conflicts feel free to skip this section.&lt;/p>
&lt;p>Let&amp;rsquo;s say you register a pregnancy in the UI. And then you notice that you got the LMP wrong, so you hit edit and quickly make the change.&lt;/p>
&lt;p>Meanwhile, sentinel notices that you registers a pregnancy, and before you have a chance to change the LMP, sets up a bunch of recurring messages, editing the document.&lt;/p>
&lt;p>Sentinel has now made a change to the first version of your document, and you&amp;rsquo;re trying to also make a change to the first version. These conflict.&lt;/p>
&lt;h2 id="how-to-manage-conflicts">How to manage conflicts&lt;/h2>
&lt;p>Conflicts will appear on the #downtime Slack channel, along with the other alerts. If a server you manage has a conflict, you should do the following:&lt;/p>
&lt;h3 id="identify-why-conflicts-are-occuring">Identify why conflicts are occuring&lt;/h3>
&lt;p>Take a look at the conflicts view, at &lt;code>https://yourserver/medic/_design/medic-conflicts/_view/conflicts&lt;/code>. Each entry in that view looks like this:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;1B7922A6-A6D6-C956-BBAE-DE5EB5A2E6C8&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;key&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#4e9a06">&amp;#34;1-82d9a42305a79e403d9eca6a9a9daae9&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;value&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">null&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>&lt;span style="color:#a40000">,&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>The &lt;code>id&lt;/code> is the &lt;code>_id&lt;/code> of the conflicting document, and the &lt;code>key&lt;/code> is a list of conflicting &lt;code>_rev&lt;/code>s.&lt;/p>
&lt;p>For each conflicting document, download that document, as well as all the &lt;code>_rev&lt;/code>s indicated in the &lt;code>key&lt;/code> above. To download a document with a specific &lt;code>_rev&lt;/code>, pass the &lt;code>rev&lt;/code> parameter.&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-sh" data-lang="sh">curl &lt;span style="color:#4e9a06">&amp;#39;https://yourserver/medic/1B7922A6-A6D6-C956-BBAE-DE5EB5A2E6C8&amp;#39;&lt;/span> &amp;gt; doc.json
curl &lt;span style="color:#4e9a06">&amp;#39;https://yourserver/medic/1B7922A6-A6D6-C956-BBAE-DE5EB5A2E6C8?rev=1-82d9a42305a79e403d9eca6a9a9daae9&amp;#39;&lt;/span> &amp;gt; doc-conflict1.json
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Now you have all versions of the document, you can diff them and try to determine what went wrong.&lt;/p>
&lt;p>A common problem, for example, might be sentinel hitting a document really quickly between you creating it and editing it.&lt;/p>
&lt;p>A less common problem that requires some special attention, is UUID collisions (see below).&lt;/p>
&lt;p>If you get stuck feel free to escalate to a developer, who can take a look.&lt;/p>
&lt;h3 id="if-appropriate-raise-a-bug">If appropriate, raise a bug&lt;/h3>
&lt;p>If you determine (or just suspect) that the problem could be in our code or data structures, feel free to raise a bug to development. For example, historically read status has been stored against the document, which can easily cause conflicts if you create a document and then instantly view it with sentinel processing in the background.&lt;/p>
&lt;p>While some conflicts are inevitable, we want to architect away from them as much as possible. Ideally tech leads would never have to resolve conflicts.&lt;/p>
&lt;h3 id="regardless-resolve-the-conflicts">Regardless, resolve the conflicts&lt;/h3>
&lt;p>Now that you&amp;rsquo;ve diagnosed the problem, and perhaps reported a bug, you should resolve the conflict.&lt;/p>
&lt;p>This is &lt;strong>extremely&lt;/strong> important. Conflicts cause saved changes to not appear against documents silently, and could cause important document changes (eg fixing someone&amp;rsquo;s EDD) to not occur.&lt;/p>
&lt;p>For a document to no longer be conflicted, there must only be one active &lt;code>_rev&lt;/code>. You would do this by picking one rev and updating it with the changes you want to make, and then updating the others with the &lt;code>_deleted: true&lt;/code> property.&lt;/p>
&lt;p>You can tell that a document is no longer conflicted if they don&amp;rsquo;t appear in the view, or if when you request the document with &lt;code>?conflicts=true&lt;/code> the &lt;code>_conflicts&lt;/code> property either doesn&amp;rsquo;t appear or is empty:&lt;/p>
&lt;pre>&lt;code>https://yourserver/medic/yourdocid?conflicts=true
{
&amp;quot;_id&amp;quot;: &amp;quot;yourdocid&amp;quot;,
&amp;quot;_rev&amp;quot;: &amp;quot;2-the-current-rev&amp;quot;
&amp;quot;_conflicts&amp;quot;: [
&amp;quot;2-a-conflicting-rev&amp;quot;
]
}
&lt;/code>&lt;/pre>&lt;p>In the above example, &lt;code>yourdocid&lt;/code> has two revisions that conflict with each other. Here you would need to update one of the revs (it doesn&amp;rsquo;t matter which) with the other&amp;rsquo;s changes, then delete the other rev. You would then see:&lt;/p>
&lt;pre>&lt;code>https://yourserver/medic/yourdocid?conflicts=true
{
&amp;quot;_id&amp;quot;: &amp;quot;yourdocid&amp;quot;,
&amp;quot;_rev&amp;quot;: &amp;quot;3-the-new-rev&amp;quot;
}
&lt;/code>&lt;/pre>&lt;h4 id="a-trivial-example">A trivial example&lt;/h4>
&lt;p>Let&amp;rsquo;s say that you have two documents, and the diff between them looks something like this:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-diff" data-lang="diff">&lt;span style="color:#000080;font-weight:bold">===================================================================
&lt;/span>&lt;span style="color:#000080;font-weight:bold">&lt;/span>&lt;span style="color:#a40000">--- 277533E3-A41B-3C46-909F-BCA038197C1E___2-2fff60be1557fdfef9915aa09e1b5119.json
&lt;/span>&lt;span style="color:#a40000">&lt;/span>&lt;span style="color:#00a000">+++ 277533E3-A41B-3C46-909F-BCA038197C1E___2-d2a7186380b72306d75cd64b64402575.json
&lt;/span>&lt;span style="color:#00a000">&lt;/span>&lt;span style="color:#800080;font-weight:bold">@@ -1,7 +1,7 @@
&lt;/span>&lt;span style="color:#800080;font-weight:bold">&lt;/span> {
&amp;#34;_id&amp;#34;: &amp;#34;277533E3-A41B-3C46-909F-BCA038197C1E&amp;#34;,
&lt;span style="color:#a40000">- &amp;#34;_rev&amp;#34;: &amp;#34;2-2fff60be1557fdfef9915aa09e1b5119&amp;#34;,
&lt;/span>&lt;span style="color:#a40000">&lt;/span>&lt;span style="color:#00a000">+ &amp;#34;_rev&amp;#34;: &amp;#34;2-d2a7186380b72306d75cd64b64402575&amp;#34;,
&lt;/span>&lt;span style="color:#00a000">&lt;/span> &amp;#34;data&amp;#34;: &amp;#34;some shared data&amp;#34;,
&amp;#34;read&amp;#34;: [
&lt;span style="color:#a40000">- &amp;#34;some_user&amp;#34;
&lt;/span>&lt;span style="color:#a40000">&lt;/span>&lt;span style="color:#00a000">+ &amp;#34;admin&amp;#34;
&lt;/span>&lt;span style="color:#00a000">&lt;/span> ]
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>The problem here is clear: &lt;code>some_user&lt;/code> and &lt;code>admin&lt;/code> read the document at the same time. To solve this, we could add &lt;code>some_user&lt;/code> to the revision with &lt;code>admin&lt;/code> already in it, and then delete the &lt;code>some_user&lt;/code> revision:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json"> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;277533E3-A41B-3C46-909F-BCA038197C1E&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_rev&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;2-d2a7186380b72306d75cd64b64402575&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;data&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;some shared data&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;read&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#4e9a06">&amp;#34;admin&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#4e9a06">&amp;#34;some_user&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json"> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;277533E3-A41B-3C46-909F-BCA038197C1E&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_rev&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;2-2fff60be1557fdfef9915aa09e1b5119&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_deleted&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#204a87;font-weight:bold">true&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;data&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;some shared data&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;read&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#4e9a06">&amp;#34;some_user&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h4 id="resolving-uuid-collisions">Resolving UUID collisions&lt;/h4>
&lt;p>A UUID collision is a rare event where two clients (eg two android phones running our application) generate the same UUID ID for two completely different documents.&lt;/p>
&lt;p>You can tell when your conflict is a UUID collision as there is no common root between the two conflicting versions. For example, one might be of type person and one might of type data_record.&lt;/p>
&lt;p>These situations are more complicated, and require that you essentially recreate all conflicting versions as new documents, and fix any linkages that exist in the database.&lt;/p>
&lt;p>Let&amp;rsquo;s say you find the following situation:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-diff" data-lang="diff">{
&amp;#34;_id&amp;#34;: &amp;#34;7FADDF76-55E4-4E50-9444-5E468E61EA83&amp;#34;
&lt;span style="color:#a40000">- &amp;#34;_rev&amp;#34;: &amp;#34;1-e4da228c29dc4ebc8b156967bbf48bd1&amp;#34;,
&lt;/span>&lt;span style="color:#a40000">&lt;/span>&lt;span style="color:#00a000">+ &amp;#34;_rev&amp;#34;: &amp;#34;1-ce40d1dc470643e2b9be9368ea9ff240&amp;#34;,
&lt;/span>&lt;span style="color:#00a000">&lt;/span>&lt;span style="color:#a40000">- &amp;#34;type&amp;#34;: &amp;#34;person&amp;#34;
&lt;/span>&lt;span style="color:#a40000">&lt;/span>&lt;span style="color:#00a000">+ &amp;#34;type&amp;#34;: &amp;#34;data_record&amp;#34;
&lt;/span>&lt;span style="color:#00a000">&lt;/span>&amp;lt;snip a bunch more stuff that doesn&amp;#39;t relate to each other&amp;gt;
}
&lt;/code>&lt;/pre>&lt;/div>&lt;p>You will want to do four things:&lt;/p>
&lt;ul>
&lt;li>Download the &lt;code>_rev&lt;/code> for the &lt;code>person&lt;/code> and create a new document, with a new uuid, for that document (you can do this by uploadig the document without an &lt;code>_id&lt;/code> or &lt;code>_rev&lt;/code> parameter and let CouchDB generate them for you)&lt;/li>
&lt;li>Do the same for the &lt;code>data_record&lt;/code> version&lt;/li>
&lt;li>Delete the main conflicting document &lt;code>7FADDF76-55E4-4E50-9444-5E468E61EA83&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>And finally, find any references to &lt;code>7FADDF76-55E4-4E50-9444-5E468E61EA83&lt;/code>, work out which doc they were &lt;em>supposed&lt;/em> to point to, and then edit those UUIDs to be the correct UUID &lt;code>_id&lt;/code> from the docs you created above.&lt;/p>
&lt;p>Because this should be a rare event and a generic view would be enormous, we do not ship a view that helps you find this out.&lt;/p>
&lt;p>However, you can create your own view! You&amp;rsquo;re going to want to create a DDOC specifically for this view. You can follow the following template to create what you want:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;_design/docs-by-reference&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;views&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;docs-by-reference&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;map&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;function(doc) {\n var KEYS = [];\n\n // TODO: consider switching this around to whitelist doc types\n if (doc._id.match(/-info$/) ||\n doc._id.match(/^_local/)) {\n return;\n }\n\n var goDeeper = function(obj, path) {\n Object.keys(obj).forEach(function(key) {\n if (typeof obj[key] === &amp;#39;string&amp;#39; &amp;amp;&amp;amp;\n KEYS.indexOf(obj[key]) !== -1) {\n emit(obj[key], path + &amp;#39;.&amp;#39; + key);\n }\n\n if (obj[key] &amp;amp;&amp;amp; typeof obj[key] === &amp;#39;object&amp;#39;) {\n goDeeper(obj[key], path + &amp;#39;.&amp;#39; + key);\n }\n });\n };\n\n goDeeper(doc, doc._id);\n}&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>In this, add any IDs you want to be found in the &lt;code>KEYS&lt;/code> variable at the top of the function. So in our case, we would change &lt;code>KEYS&lt;/code> to look like this:&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-js" data-lang="js">&lt;span style="color:#204a87;font-weight:bold">var&lt;/span> &lt;span style="color:#000">KEYS&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;7FADDF76-55E4-4E50-9444-5E468E61EA83&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>Upload this document to CouchDB (do not just add the view to an existing DDOC, as you will force all views on that DDOC to regenerate) and then warm up the views by querying it once (it may take a long time to run).&lt;/p>
&lt;p>Once it is complete you can query the view again to return a list of documents that reference the ids you hard-coded above.&lt;/p>
&lt;p>This will help you to identify which documents are affected by this change. Usually the only change needed is to change the ID located to the new ones you generated.&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;total_rows&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">2&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;offset&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#0000cf;font-weight:bold">0&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;rows&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;1B7922A6-A6D6-C956-BBAE-DE5EB5A2E6C8&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;key&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#4e9a06">&amp;#34;7FADDF76-55E4-4E50-9444-5E468E61EA83&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;value&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;1B7922A6-A6D6-C956-BBAE-DE5EB5A2E6C8.fields.inputs.contact._id&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;1B7922A6-A6D6-C956-BBAE-DE5EB5A2E6C8&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;key&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#4e9a06">&amp;#34;7FADDF76-55E4-4E50-9444-5E468E61EA83&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;value&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;1B7922A6-A6D6-C956-BBAE-DE5EB5A2E6C8.fields.patient_id&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">]&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;p>In this example, there are two references to &lt;code>7FADDF76-55E4-4E50-9444-5E468E61EA83&lt;/code>, both in the &lt;code>1B7922A6-A6D6-C956-BBAE-DE5EB5A2E6C8&lt;/code> document, one at &lt;code>fields.inputs.contact._id&lt;/code> and one at &lt;code>fields.patient_id&lt;/code>.&lt;/p>
&lt;p>If you get stuck, feel free to contact a developer (either a specific one, or just post in &lt;code>#development&lt;/code>) and they can help you out.&lt;/p></description></item><item><title>Apps: DHIS2 Aggregate</title><link>https://docs.communityhealthtoolkit.org/beta/apps/guides/integrations/dhis2-aggregate/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/guides/integrations/dhis2-aggregate/</guid><description>
&lt;p>One of the first things you’ll need to do is identify the specific &lt;a href="https://docs.dhis2.org/2.34/en/dhis2_implementation_guide/data-sets-and-forms.html#what-is-a-data-set">DHIS2 data set&lt;/a> that you plan to implement. You’ll need a list of all the &lt;a href="https://docs.dhis2.org/2.34/en/dhis2_implementation_guide/data-elements-and-custom-dimensions.html#data-elements">data elements&lt;/a> on that data set, a detailed understanding of how each is calculated, the frequency in which the data set is submitted (weekly, monthly, etc…), and for which &lt;a href="https://docs.dhis2.org/2.34/en/dhis2_implementation_guide/organisation-units.html">organisation units&lt;/a> the data set applies. You’ll also want to identify and engage the appropriate DHIS2 stakeholders to get access to DHIS2 metadata, test environments, and discuss workflows. The DHIS2 documentation site provides additional background and advice &lt;a href="https://docs.dhis2.org/2.34/en/dhis2_implementation_guide/integration-concepts.html#integration-concepts">here&lt;/a>.&lt;/p>
&lt;h2 id="design-considerations">Design Considerations&lt;/h2>
&lt;p>There are a few very important considerations related to how you design workflows and set up your CHT application to make sure you will be able to integrate with DHIS2. The main areas are:&lt;/p>
&lt;ol>
&lt;li>Hierarchies&lt;/li>
&lt;li>Fields and calculations&lt;/li>
&lt;li>Workflows and user access.&lt;/li>
&lt;/ol>
&lt;p>These considerations are summarized below.&lt;/p>
&lt;h3 id="hierarchies">Hierarchies&lt;/h3>
&lt;p>The CHT relies on your Place hierarchy to determine how data should be aggregated for DHIS2. As such, it’s important that you consider how organization units are configured in the DHIS2 instance that you need to integrate data into. If your CHT Place hierarchy does not align with the DHIS2 organisation unit structure, the CHT will not be able to aggregate data in the way DHIS2 needs it.&lt;/p>
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">Note&lt;/h4>
There should be a one-to-one relationship between DHIS2 organistion units and CHT places.
&lt;/div>
&lt;p>&lt;em>See Also:&lt;/em> &lt;a href=https://docs.communityhealthtoolkit.org/beta/apps/concepts/hierarchy/#>Hierarchies&lt;/a>&lt;/p>
&lt;h3 id="fields-and-calculations">Fields and calculations&lt;/h3>
&lt;p>It’s important to understand each data element on the DHIS2 data set you want to integrate data into and how each data element is calculated. When you are designing your forms in the CHT, you will need to make sure you are capturing information in your forms so that every data element on the chosen DHIS2 data set can be calculated within the CHT.&lt;/p>
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">Note&lt;/h4>
Once you obtain the list of data elements on the data set, be sure to go through them one by one and figure out how to calculate each one using information available in your CHT forms.
&lt;/div>
&lt;p>&lt;em>See Also:&lt;/em> &lt;a href=https://docs.communityhealthtoolkit.org/beta/apps/concepts/forms/#>Forms&lt;/a>&lt;/p>
&lt;h3 id="workflows-and-user-access">Workflows and User Access&lt;/h3>
&lt;p>The aggregate data workflow is really designed around 3 key user personas. You’ll need to make sure that your context can support those assumptions and will be able to have access to the appropriate features in the CHT and DHIS2.&lt;/p>
&lt;p>Moving data from the CHT to DHIS2 can be done in three main ways.&lt;/p>
&lt;ol>
&lt;li>Manually downloading from the CHT&lt;/li>
&lt;li>Building an app in DHIS2 and calling an API in the CHT&lt;/li>
&lt;li>Orchestrating the steps using an interoperability layer such as &lt;a href="http://openhim.org/">OpenHIM&lt;/a>, &lt;a href="https://www.openfn.org/">OpenFn&lt;/a>, etc&amp;hellip;&lt;/li>
&lt;/ol>
&lt;h2 id="configuration">Configuration&lt;/h2>
&lt;p>Once you have designed your hierarchies, forms, calculations, and workflows, there are a few key configurations that need to be made.&lt;/p>
&lt;h3 id="data-sets">Data sets&lt;/h3>
&lt;p>For the CHT to be able to export the file for DHIS2, it needs to know the specific name and ID of the data set in DHIS2. You will need to obtain the ID from the test or production DHIS2 environment.&lt;/p>
&lt;p>Configure the data set in &lt;code>app_settings.json&lt;/code>.&lt;/p>
&lt;h3 id="organisation-units">Organisation units&lt;/h3>
&lt;p>Aggregation in the CHT is based on your Place hierarchy. As mentioned in the Hierarchies Design Considerations above, your Places must align with DHIS2 organisation units. You will need to specify the DHIS2 organisation unit&amp;rsquo;s ID on the Place document in the CHT.&lt;/p>
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">Note&lt;/h4>
Update the contact document of each place you wish to map to an organisation unit. Add a &lt;code>dhis.orgUnit&lt;/code> attribute.
&lt;/div>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-json" data-lang="json">&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;_id&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;my_place&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;type&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;health_center&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;dhis&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#204a87;font-weight:bold">&amp;#34;orgUnit&amp;#34;&lt;/span>&lt;span style="color:#000;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#34;HJiPOcmziQA&amp;#34;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="data-elements">Data elements&lt;/h3>
&lt;p>Calculations for DHIS2 indicators are done using CHT Target functionality. For each DHIS2 data element, you will need to configure a corresponding CHT Target and specify the ID of the DHIS2 data set and data element. If you do not include the data set, this data element will be included in every data set.&lt;/p>
&lt;div class="alert alert-primary" role="alert">
&lt;h4 class="alert-heading">Note&lt;/h4>
In &lt;code>targets.js&lt;/code>, configure one or more data elements by setting the &lt;code>dhis.dataSet&lt;/code> and &lt;code>dhis.dataElement&lt;/code> attributes in the target schema.
&lt;/div>
&lt;p>&lt;em>See Also:&lt;/em> &lt;a href=https://docs.communityhealthtoolkit.org/beta/apps/reference/targets/#>Targets&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;code class="language-javascript" data-lang="javascript">&lt;span style="color:#000">module&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#204a87;font-weight:bold">export&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">=&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>
&lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">id&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;births-this-month&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">type&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;count&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">icon&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;icon-infant&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">translation_key&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;targets.births.title&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">subtitle_translation_key&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;targets.this_month.subtitle&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">goal&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">-&lt;/span>&lt;span style="color:#0000cf;font-weight:bold">1&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">appliesTo&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;contacts&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">appliesToType&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">[&lt;/span>&lt;span style="color:#4e9a06">&amp;#39;person&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">],&lt;/span>
&lt;span style="color:#000">appliesIf&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000">contact&lt;/span> &lt;span style="color:#000;font-weight:bold">=&amp;gt;&lt;/span> &lt;span style="color:#ce5c00;font-weight:bold">!!&lt;/span>&lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">date&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">(&lt;/span>&lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">)&lt;/span> &lt;span style="color:#000;font-weight:bold">=&amp;gt;&lt;/span> &lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">contact&lt;/span>&lt;span style="color:#000;font-weight:bold">.&lt;/span>&lt;span style="color:#000">date_of_birth&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">dhis&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#000;font-weight:bold">{&lt;/span>
&lt;span style="color:#000">dataSet&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;VMuFODsyWaO&amp;#39;&lt;/span>&lt;span style="color:#000;font-weight:bold">,&lt;/span>
&lt;span style="color:#000">dataElement&lt;/span>&lt;span style="color:#ce5c00;font-weight:bold">:&lt;/span> &lt;span style="color:#4e9a06">&amp;#39;kB0ZBFisE0e&amp;#39;&lt;/span>
&lt;span style="color:#000;font-weight:bold">}&lt;/span>
&lt;span style="color:#000;font-weight:bold">},&lt;/span>
&lt;span style="color:#000;font-weight:bold">];&lt;/span>
&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="users">Users&lt;/h3>
&lt;p>For the HRIO role, create a new user role and a new user with that role; or update an existing user role. To export DHIS2 metrics, users need to have the following permissions: &lt;code>can_configure&lt;/code>, &lt;code>can_export_all&lt;/code>, and &lt;code>can_export_dhis&lt;/code>.&lt;/p>
&lt;p>&lt;em>See Also:&lt;/em> &lt;a href=https://docs.communityhealthtoolkit.org/beta/apps/concepts/users/#>Users&lt;/a>&lt;/p>
&lt;h2 id="user-experience">User experience&lt;/h2>
&lt;p>Once your CHT project is configured to integrate with DHIS2, follow these steps to export the data from CHT and import it into DHIS:&lt;/p>
&lt;h3 id="export-data">Export data&lt;/h3>
&lt;ol>
&lt;li>Login to the CHT instance using a user account with the required permissions. You should be automatically navigated to the Admin Console.&lt;/li>
&lt;li>Select &amp;ldquo;Import &amp;amp; export data&amp;rdquo; from the side&lt;/li>
&lt;li>Select &amp;ldquo;DHIS2&amp;rdquo; from the header along the top&lt;/li>
&lt;li>Select the data set, org unit, and time period that you&amp;rsquo;d like to send to DHIS2. Click &amp;ldquo;Export&amp;rdquo;&lt;/li>
&lt;li>A file should download in your browser. This file contains a &lt;a href="https://docs.dhis2.org/master/en/developer/html/webapi_data_values.html">dataValueSet&lt;/a> with aggregated user&amp;rsquo;s data.&lt;/li>
&lt;/ol>
&lt;h3 id="import-data">Import data&lt;/h3>
&lt;ol>
&lt;li>Login to DHIS2 using a user account with permission to manage the relevant dataset and organisation units.&lt;/li>
&lt;li>Select the &amp;ldquo;import/export&amp;rdquo; application inside DHIS2. Select &amp;ldquo;import data&amp;rdquo;.&lt;/li>
&lt;li>Upload the file you downloaded in Step 5.&lt;/li>
&lt;li>Click &amp;ldquo;Import&amp;rdquo;&lt;/li>
&lt;/ol>
&lt;p>Check the UI for any errors. If you get errors you don&amp;rsquo;t understand or are unable to resolve an error, you can always ask for assistance on the &lt;a href="https://forum.communityhealthtoolkit.org/c/support/18">CHT Forum&lt;/a>. If there are no errors, you can review the numbers that resulted by reviewing the data set in DHIS2.&lt;/p>
&lt;h2 id="known-limitations">Known limitations&lt;/h2>
&lt;ul>
&lt;li>Data for each user is aggregated based on the contents of the user&amp;rsquo;s target document. Note that if your users don&amp;rsquo;t login and synchronize, their data won&amp;rsquo;t be represented in the exported data.&lt;/li>
&lt;li>Integrations are limited to &lt;em>monthly&lt;/em> DHIS2 data sets.&lt;/li>
&lt;li>Integrations are limited to numeric data-types. To support other data types, consider making a &lt;a href="https://docs.dhis2.org/master/en/developer/html/apps_creating_apps.html">DHIS2 App&lt;/a> for your project.&lt;/li>
&lt;/ul></description></item><item><title>Apps: EC2 Setup</title><link>https://docs.communityhealthtoolkit.org/beta/apps/guides/hosting/ec2-setup-guide/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://docs.communityhealthtoolkit.org/beta/apps/guides/hosting/ec2-setup-guide/</guid><description>
&lt;h2 id="configure-self-hosting">Configure self-hosting&lt;/h2>
&lt;h4 id="1-create-ec2-use-security-best-practices">1. Create EC2 (use security best practices)&lt;/h4>
&lt;pre>&lt;code>Be sure to change the file permissions to 0600 or lower
for the .pem file:
sudo chmod 0600 ~/Downloads/name_of_file.pem
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/elastic-ip-addresses-eip.html">Create Elastic IP and Associate EIP to EC2&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>&lt;code>Goal&lt;/code>: SSH into instance&lt;/p>
&lt;h4 id="2-create-or-restore-ebs-volume">2. Create or Restore EBS Volume&lt;/h4>
&lt;ul>
&lt;li>
&lt;p>Create EBS Volume&lt;/p>
&lt;ul>
&lt;li>Be sure to tag appropriately&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="https://docs.aws.amazon.com/AWSEC2/latest/WindowsGuide/ebs-restoring-volume.html">Restore EBS Volume&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Attach volume to EC2 instance&lt;/p>
&lt;/li>
&lt;li>
&lt;p>(Optional): &lt;a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/recognize-expanded-volume-linux.html">Increase disk size&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>If you are using a newly created EBS Volume, you will have to format the disk approriately:&lt;/p>
&lt;ol>
&lt;li>SSH into instance&lt;/li>
&lt;li>Follow the instructions here: &lt;a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ebs-using-volumes.html">Using EBS Volumes&lt;/a>&lt;/li>
&lt;li>Use &lt;code>sudo mkfs -t ext4 &amp;lt;location&amp;gt;&lt;/code> in step 4&lt;/li>
&lt;li>Mount disk to /srv&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ul>
&lt;p>&lt;code>Goal&lt;/code>: Mount EBS volume to /srv&lt;/p>
&lt;h4 id="3-provision-docker-server">3. Provision Docker server&lt;/h4>
&lt;ul>
&lt;li>Follow README &amp;amp; Run scripts: &lt;a href="https://github.com/medic/medic-infrastructure/tree/master/self-hosting/prepare-system">Prepare Self-Hosting System&lt;/a>&lt;/li>
&lt;li>A zip will be shared via Slack until the scripts are moved to a public repo&lt;/li>
&lt;/ul>
&lt;p>&lt;code>Goal&lt;/code>: CHT Application bootstraps and comes online&lt;/p>
&lt;h4 id="4-dns-configuration">4. DNS configuration&lt;/h4>
&lt;ul>
&lt;li>Point A records to Elastic IP given to Docker server&lt;/li>
&lt;/ul>
&lt;h4 id="5-review-ssl-certs">5. Review SSL certs&lt;/h4>
&lt;ul>
&lt;li>Location of certs is &lt;code>/srv/settings/medic-core/nginx/private/&lt;/code>&lt;/li>
&lt;li>Name the key file as &lt;code>default.key&lt;/code> and the certificate file as &lt;code>default.crt&lt;/code>&lt;/li>
&lt;li>Restarting nginx with new certs: &lt;code>svc-restart medic-core nginx&lt;/code>&lt;/li>
&lt;/ul>
&lt;h4 id="6-configure-couch2pg">6. Configure couch2pg&lt;/h4>
&lt;ul>
&lt;li>Basic configuration: &lt;a href="https://github.com/medic/medic-couch2pg/blob/master/README.md">https://github.com/medic/medic-couch2pg/blob/master/README.md&lt;/a>&lt;/li>
&lt;li>Supervision/monitoring/notification&lt;/li>
&lt;/ul>
&lt;h4 id="7-setup-postgres-to-work-with-couch2pg">7. Setup postgres to work with couch2pg&lt;/h4>
&lt;ul>
&lt;li>Creating the database, setting up permissions, exploring the tables and what they store&lt;/li>
&lt;/ul>
&lt;h4 id="8debugging-couch2pgpostgres">8.Debugging couch2pg/postgres&lt;/h4>
&lt;ul>
&lt;li>Understanding the log and what the entries mean&lt;/li>
&lt;/ul>
&lt;h2 id="troubleshooting">Troubleshooting&lt;/h2>
&lt;h4 id="1-restarting-processes">1. Restarting processes&lt;/h4>
&lt;ul>
&lt;li>&lt;a href="https://docs.communityhealthtoolkit.org/beta/apps/guides/hosting/self-hosting/#how-to-access-container-retrieve-logs-isolate-security-groups">How to access container, retrieve logs, isolate security groups&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/medic/medic-os#service-management-scripts">MedicOS service management scripts&lt;/a>&lt;/li>
&lt;/ul>
&lt;h4 id="2-investigating-logs">2. Investigating logs&lt;/h4>
&lt;ul>
&lt;li>&lt;a href="https://docs.docker.com/engine/reference/commandline/exec/">Log into container&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.communityhealthtoolkit.org/beta/core/guides/docker-setup/#helpful-docker-commands">Helpful docker commands&lt;/a>&lt;/li>
&lt;li>Inside container, all appropriate logs can be found in: &lt;code>/srv/storage/&amp;lt;service_name&amp;gt;/logs/*.log&lt;/code>&lt;/li>
&lt;/ul>
&lt;h4 id="3upgrading-the-container">3.Upgrading the container&lt;/h4>
&lt;ul>
&lt;li>Backup all data (EBS)&lt;/li>
&lt;li>Log into container and stop all services&lt;/li>
&lt;li>DO NOT REMOVE &lt;code>/srv/storage/medic-core/&lt;/code>, &lt;code>/srv/settings/medic-core/couchdb/local.ini&lt;/code>, wipe all other files in /srv [Note: Make script publicly accessibile]&lt;/li>
&lt;li>&lt;a href="https://docs.communityhealthtoolkit.org/beta/core/guides/docker-setup/#use-docker-compose">Change the image tag to the newest image release version&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://docs.communityhealthtoolkit.org/beta/core/guides/docker-setup/#use-docker-compose">Change image tag in docker-compose file&lt;/a>&lt;/li>
&lt;li>Launch new containers with appropriate COUCHDB_ADMIN_PASSWORD &amp;amp; HA_PASSWORD environment variables&lt;/li>
&lt;/ul>
&lt;h4 id="4upgrading-the-webapp">4.Upgrading the webapp&lt;/h4>
&lt;ul>
&lt;li>Use Admin GUI page&lt;/li>
&lt;li>&lt;a href="https://docs.communityhealthtoolkit.org/beta/apps/guides/hosting/self-hosting/#links-to-medic-documentation-for-horticulturalist-for-upgrades">CLI via horticulturalist&lt;/a>&lt;/li>
&lt;/ul>
&lt;h4 id="4a-rds-help">4a. RDS help&lt;/h4>
&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Welcome.html">https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Welcome.html&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="restore-from-backup-and-monitoring">Restore from backup and monitoring&lt;/h2>
&lt;h4 id="1-configure-backups">1. Configure backups&lt;/h4>
&lt;ul>
&lt;li>EBS Snapshot Lifecycle Manager: &lt;a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/snapshot-lifecycle.html">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/snapshot-lifecycle.html&lt;/a>&lt;/li>
&lt;/ul>
&lt;h4 id="2-restoring-from-backup">2. Restoring from backup&lt;/h4>
&lt;ul>
&lt;li>Create volume from snapshot&lt;/li>
&lt;li>Tag appropriately for backups&lt;/li>
&lt;li>Mount volume to docker server&lt;/li>
&lt;/ul>
&lt;h4 id="3-process-supervison">3. Process supervison&lt;/h4>
&lt;ul>
&lt;li>supvisorctl&lt;/li>
&lt;li>/boot/supervisor-inspect&lt;/li>
&lt;/ul>
&lt;h4 id="4-monitoring">4. Monitoring&lt;/h4>
&lt;ul>
&lt;li>&lt;a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-cloudwatch.html">https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using-cloudwatch.html&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="own-infrastructure-setup">Own Infrastructure Setup&lt;/h2>
&lt;h4 id="1-team-to-set-up-own-infrastructure-based-on-best-practices-and-recommendations-above">1. Team to set up own infrastructure based on best-practices and recommendations above&lt;/h4></description></item></channel></rss>